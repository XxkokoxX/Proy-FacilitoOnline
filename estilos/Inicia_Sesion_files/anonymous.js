var Prototype={Version:"1.6.1",Browser:function(){var a=navigator.userAgent,b=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!b,Opera:b,WebKit:a.indexOf("AppleWebKit/")>-1,Gecko:a.indexOf("Gecko")>-1&&a.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile.*Safari/.test(a)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var a=window.Element||window.HTMLElement;return!!(a&&a.prototype)}(),
SpecificElementExtensions:function(){if(typeof window.HTMLDivElement!=="undefined")return true;var a=document.createElement("div"),b=document.createElement("form"),c=false;if(a.__proto__&&a.__proto__!==b.__proto__)c=true;return c}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=false;
var Abstract={},Try={these:function(){for(var a,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a}},Class=function(){function a(){}function b(){function d(){this.initialize.apply(this,arguments)}var e=null,f=$A(arguments);if(Object.isFunction(f[0]))e=f.shift();Object.extend(d,Class.Methods);d.superclass=e;d.subclasses=[];if(e){a.prototype=e.prototype;d.prototype=new a;e.subclasses.push(d)}for(e=0;e<f.length;e++)d.addMethods(f[e]);if(!d.prototype.initialize)d.prototype.initialize=
Prototype.emptyFunction;return d.prototype.constructor=d}function c(d){var e=this.superclass&&this.superclass.prototype,f=Object.keys(d);if(!Object.keys({toString:true}).length){d.toString!=Object.prototype.toString&&f.push("toString");d.valueOf!=Object.prototype.valueOf&&f.push("valueOf")}for(var g=0,k=f.length;g<k;g++){var o=f[g],v=d[o];if(e&&Object.isFunction(v)&&v.argumentNames().first()=="$super"){var r=v;v=function(q){return function(){return e[q].apply(this,arguments)}}(o).wrap(r);v.valueOf=
r.valueOf.bind(r);v.toString=r.toString.bind(r)}this.prototype[o]=v}return this}return{create:b,Methods:{addMethods:c}}}();
(function(){function a(t,x){for(var H in x)t[H]=x[H];return t}function b(t){try{if(E(t))return"undefined";if(t===null)return"null";return t.inspect?t.inspect():String(t)}catch(x){if(x instanceof RangeError)return"...";throw x;}}function c(t){switch(typeof t){case "undefined":case "function":case "unknown":return;case "boolean":return t.toString()}if(t===null)return"null";if(t.toJSON)return t.toJSON();if(!o(t)){var x=[];for(var H in t){var R=c(t[H]);E(R)||x.push(H.toJSON()+": "+R)}return"{"+x.join(", ")+
"}"}}function d(t){return $H(t).toQueryString()}function e(t){return t&&t.toHTML?t.toHTML():String.interpret(t)}function f(t){var x=[];for(var H in t)x.push(H);return x}function g(t){var x=[];for(var H in t)x.push(t[H]);return x}function k(t){return a({},t)}function o(t){return!!(t&&t.nodeType==1)}function v(t){return U.call(t)=="[object Array]"}function r(t){return t instanceof Hash}function q(t){return typeof t==="function"}function B(t){return U.call(t)=="[object String]"}function I(t){return U.call(t)==
"[object Number]"}function E(t){return typeof t==="undefined"}var U=Object.prototype.toString;a(Object,{extend:a,inspect:b,toJSON:c,toQueryString:d,toHTML:e,keys:f,values:g,clone:k,isElement:o,isArray:v,isHash:r,isFunction:q,isString:B,isNumber:I,isUndefined:E})})();
Object.extend(Function.prototype,function(){function a(q,B){for(var I=q.length,E=B.length;E--;)q[I+E]=B[E];return q}function b(q,B){q=r.call(q,0);return a(q,B)}function c(){var q=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return q.length==1&&!q[0]?[]:q}function d(q){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var B=this,I=r.call(arguments,1);return function(){var E=b(I,arguments);
return B.apply(q,E)}}function e(q){var B=this,I=r.call(arguments,1);return function(E){E=a([E||window.event],I);return B.apply(q,E)}}function f(){if(!arguments.length)return this;var q=this,B=r.call(arguments,0);return function(){var I=b(B,arguments);return q.apply(this,I)}}function g(q){var B=this,I=r.call(arguments,1);q*=1E3;return window.setTimeout(function(){return B.apply(B,I)},q)}function k(){return this.delay.apply(this,a([0.01],arguments))}function o(q){var B=this;return function(){var I=
a([B.bind(this)],arguments);return q.apply(this,I)}}function v(){if(this._methodized)return this._methodized;var q=this;return this._methodized=function(){var B=a([this],arguments);return q.apply(null,B)}}var r=Array.prototype.slice;return{argumentNames:c,bind:d,bindAsEventListener:e,curry:f,delay:g,defer:k,wrap:o,methodize:v}}());
Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+'Z"'};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(a,b){this.callback=a;this.frequency=b;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1E3)},execute:function(){this.callback(this)},stop:function(){if(this.timer){clearInterval(this.timer);this.timer=null}},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(a){this.currentlyExecuting=
false;throw a;}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function a(z){if(Object.isFunction(z))return z;var G=new Template(z);return function(K){return G.evaluate(K)}}function b(z,G){var K="",L=this,W;G=a(G);if(Object.isString(z))z=RegExp.escape(z);if(!(z.length||z.source)){G=G("");return G+L.split("").join(G)+G}for(;L.length>0;)if(W=L.match(z)){K+=L.slice(0,W.index);K+=String.interpret(G(W));L=L.slice(W.index+W[0].length)}else{K+=L;L=""}return K}function c(z,G,K){G=a(G);K=Object.isUndefined(K)?1:K;return this.gsub(z,
function(L){if(--K<0)return L[0];return G(L)})}function d(z,G){this.gsub(z,G);return String(this)}function e(z,G){z=z||30;G=Object.isUndefined(G)?"...":G;return this.length>z?this.slice(0,z-G.length)+G:String(this)}function f(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function g(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function k(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function o(){var z=new RegExp(Prototype.ScriptFragment,"img"),
G=new RegExp(Prototype.ScriptFragment,"im");return(this.match(z)||[]).map(function(K){return(K.match(G)||["",""])[1]})}function v(){return this.extractScripts().map(function(z){return eval(z)})}function r(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function q(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function B(z){var G=this.strip().match(/([^?#]*)(#.*)?$/);if(!G)return{};return G[1].split(z||"&").inject({},function(K,
L){if((L=L.split("="))[0]){var W=decodeURIComponent(L.shift());L=L.length>1?L.join("="):L[0];if(L!=undefined)L=decodeURIComponent(L);if(W in K){Object.isArray(K[W])||(K[W]=[K[W]]);K[W].push(L)}else K[W]=L}return K})}function I(){return this.split("")}function E(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function U(z){return z<1?"":(new Array(z+1)).join(this)}function t(){var z=this.split("-"),G=z.length;if(G==1)return z[0];for(var K=this.charAt(0)==
"-"?z[0].charAt(0).toUpperCase()+z[0].substring(1):z[0],L=1;L<G;L++)K+=z[L].charAt(0).toUpperCase()+z[L].substring(1);return K}function x(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function H(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function R(){return this.replace(/_/g,"-")}function D(z){var G=this.replace(/[\x00-\x1f\\]/g,function(K){if(K in String.specialChar)return String.specialChar[K];
return"\\u00"+K.charCodeAt().toPaddedString(2,16)});if(z)return'"'+G.replace(/"/g,'\\"')+'"';return"'"+G.replace(/'/g,"\\'")+"'"}function y(){return this.inspect(true)}function u(z){return this.replace(z||Prototype.JSONFilter,"$1")}function h(){var z=this;if(z.blank())return false;z=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(z)}function m(z){var G=this.unfilterJSON();try{if(!z||G.isJSON())return eval("("+G+")")}catch(K){}throw new SyntaxError("Badly formed JSON string: "+
this.inspect());}function p(z){return this.indexOf(z)>-1}function C(z){return this.indexOf(z)===0}function J(z){var G=this.length-z.length;return G>=0&&this.lastIndexOf(z)===G}function N(){return this==""}function S(){return/^\s*$/.test(this)}function Q(z,G){return(new Template(this,G)).evaluate(z)}return{gsub:b,sub:c,scan:d,truncate:e,strip:String.prototype.trim?String.prototype.trim:f,stripTags:g,stripScripts:k,extractScripts:o,evalScripts:v,escapeHTML:r,unescapeHTML:q,toQueryParams:B,parseQuery:B,
toArray:I,succ:E,times:U,camelize:t,capitalize:x,underscore:H,dasherize:R,inspect:D,toJSON:y,unfilterJSON:u,isJSON:h,evalJSON:m,include:p,startsWith:C,endsWith:J,empty:N,blank:S,interpolate:Q}}());
var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){if(a&&Object.isFunction(a.toTemplateReplacements))a=a.toTemplateReplacements();return this.template.gsub(this.pattern,function(b){if(a==null)return b[1]+"";var c=b[1]||"";if(c=="\\")return b[2];var d=a,e=b[3],f=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;b=f.exec(e);if(b==null)return c;for(;b!=null;){var g=b[1].startsWith("[")?b[2].replace(/\\\\]/g,"]"):b[1];d=d[g];if(null==
d||""==b[3])break;e=e.substring("["==b[3]?b[1].length:b[0].length);b=f.exec(e)}return c+String.interpret(d)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function a(u,h){var m=0;try{this._each(function(C){u.call(h,C,m++)})}catch(p){if(p!=$break)throw p;}return this}function b(u,h,m){var p=-u,C=[],J=this.toArray();if(u<1)return J;for(;(p+=u)<J.length;)C.push(J.slice(p,p+u));return C.collect(h,m)}function c(u,h){u=u||Prototype.K;var m=true;this.each(function(p,C){m=m&&!!u.call(h,p,C);if(!m)throw $break;});return m}function d(u,h){u=u||Prototype.K;var m=false;this.each(function(p,C){if(m=!!u.call(h,p,C))throw $break;
});return m}function e(u,h){u=u||Prototype.K;var m=[];this.each(function(p,C){m.push(u.call(h,p,C))});return m}function f(u,h){var m;this.each(function(p,C){if(u.call(h,p,C)){m=p;throw $break;}});return m}function g(u,h){var m=[];this.each(function(p,C){u.call(h,p,C)&&m.push(p)});return m}function k(u,h,m){h=h||Prototype.K;var p=[];if(Object.isString(u))u=new RegExp(RegExp.escape(u));this.each(function(C,J){u.match(C)&&p.push(h.call(m,C,J))});return p}function o(u){if(Object.isFunction(this.indexOf))if(this.indexOf(u)!=
-1)return true;var h=false;this.each(function(m){if(m==u){h=true;throw $break;}});return h}function v(u,h){h=Object.isUndefined(h)?null:h;return this.eachSlice(u,function(m){for(;m.length<u;)m.push(h);return m})}function r(u,h,m){this.each(function(p,C){u=h.call(m,u,p,C)});return u}function q(u){var h=$A(arguments).slice(1);return this.map(function(m){return m[u].apply(m,h)})}function B(u,h){u=u||Prototype.K;var m;this.each(function(p,C){p=u.call(h,p,C);if(m==null||p>=m)m=p});return m}function I(u,
h){u=u||Prototype.K;var m;this.each(function(p,C){p=u.call(h,p,C);if(m==null||p<m)m=p});return m}function E(u,h){u=u||Prototype.K;var m=[],p=[];this.each(function(C,J){(u.call(h,C,J)?m:p).push(C)});return[m,p]}function U(u){var h=[];this.each(function(m){h.push(m[u])});return h}function t(u,h){var m=[];this.each(function(p,C){u.call(h,p,C)||m.push(p)});return m}function x(u,h){return this.map(function(m,p){return{value:m,criteria:u.call(h,m,p)}}).sort(function(m,p){m=m.criteria;p=p.criteria;return m<
p?-1:m>p?1:0}).pluck("value")}function H(){return this.map()}function R(){var u=Prototype.K,h=$A(arguments);if(Object.isFunction(h.last()))u=h.pop();var m=[this].concat(h).map($A);return this.map(function(p,C){return u(m.pluck(C))})}function D(){return this.toArray().length}function y(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:a,eachSlice:b,all:c,every:c,any:d,some:d,collect:e,map:e,detect:f,findAll:g,select:g,filter:g,grep:k,include:o,member:o,inGroupsOf:v,inject:r,invoke:q,
max:B,min:I,partition:E,pluck:U,reject:t,sortBy:x,toArray:H,entries:H,zip:R,size:D,inspect:y,find:f}}();function $A(a){if(!a)return[];if("toArray"in Object(a))return a.toArray();for(var b=a.length||0,c=new Array(b);b--;)c[b]=a[b];return c}function $w(a){if(!Object.isString(a))return[];return(a=a.strip())?a.split(/\s+/):[]}Array.from=$A;
(function(){function a(D){for(var y=0,u=this.length;y<u;y++)D(this[y])}function b(){this.length=0;return this}function c(){return this[0]}function d(){return this[this.length-1]}function e(){return this.select(function(D){return D!=null})}function f(){return this.inject([],function(D,y){if(Object.isArray(y))return D.concat(y.flatten());D.push(y);return D})}function g(){var D=H.call(arguments,0);return this.select(function(y){return!D.include(y)})}function k(D){return(D!==false?this:this.toArray())._reverse()}
function o(D){return this.inject([],function(y,u,h){if(0==h||(D?y.last()!=u:!y.include(u)))y.push(u);return y})}function v(D){return this.uniq().findAll(function(y){return D.detect(function(u){return y===u})})}function r(){return H.call(this,0)}function q(){return this.length}function B(){return"["+this.map(Object.inspect).join(", ")+"]"}function I(){var D=[];this.each(function(y){y=Object.toJSON(y);Object.isUndefined(y)||D.push(y)});return"["+D.join(", ")+"]"}function E(D,y){y||(y=0);var u=this.length;
if(y<0)y=u+y;for(;y<u;y++)if(this[y]===D)return y;return-1}function U(D,y){y=isNaN(y)?this.length:(y<0?this.length+y:y)+1;D=this.slice(0,y).reverse().indexOf(D);return D<0?D:y-D-1}function t(){for(var D=H.call(this,0),y,u=0,h=arguments.length;u<h;u++){y=arguments[u];if(Object.isArray(y)&&!("callee"in y))for(var m=0,p=y.length;m<p;m++)D.push(y[m]);else D.push(y)}return D}var x=Array.prototype,H=x.slice,R=x.forEach;R||(R=a);Object.extend(x,Enumerable);if(!x._reverse)x._reverse=x.reverse;Object.extend(x,
{_each:R,clear:b,first:c,last:d,compact:e,flatten:f,without:g,reverse:k,uniq:o,intersect:v,clone:r,toArray:r,size:q,inspect:B,toJSON:I});if(function(){return[].concat(arguments)[0][0]!==1}(1,2))x.concat=t;if(!x.indexOf)x.indexOf=E;if(!x.lastIndexOf)x.lastIndexOf=U})();function $H(a){return new Hash(a)}
var Hash=Class.create(Enumerable,function(){function a(t){this._object=Object.isHash(t)?t.toObject():Object.clone(t)}function b(t){for(var x in this._object){var H=this._object[x],R=[x,H];R.key=x;R.value=H;t(R)}}function c(t,x){return this._object[t]=x}function d(t){if(this._object[t]!==Object.prototype[t])return this._object[t]}function e(t){var x=this._object[t];delete this._object[t];return x}function f(){return Object.clone(this._object)}function g(){return this.pluck("key")}function k(){return this.pluck("value")}
function o(t){var x=this.detect(function(H){return H.value===t});return x&&x.key}function v(t){return this.clone().update(t)}function r(t){return(new Hash(t)).inject(this,function(x,H){x.set(H.key,H.value);return x})}function q(t,x){if(Object.isUndefined(x))return t;return t+"="+encodeURIComponent(String.interpret(x))}function B(){return this.inject([],function(t,x){var H=encodeURIComponent(x.key);if((x=x.value)&&typeof x=="object"){if(Object.isArray(x))return t.concat(x.map(q.curry(H)))}else t.push(q(H,
x));return t}).join("&")}function I(){return"#<Hash:{"+this.map(function(t){return t.map(Object.inspect).join(": ")}).join(", ")+"}>"}function E(){return Object.toJSON(this.toObject())}function U(){return new Hash(this)}return{initialize:a,_each:b,set:c,get:d,unset:e,toObject:f,toTemplateReplacements:f,keys:g,values:k,index:o,merge:v,update:r,toQueryString:B,inspect:I,toJSON:E,clone:U}}());Hash.from=$H;
Object.extend(Number.prototype,function(){function a(){return this.toPaddedString(2,16)}function b(){return this+1}function c(v,r){$R(0,this,true).each(v,r);return this}function d(v,r){r=this.toString(r||10);return"0".times(v-r.length)+r}function e(){return isFinite(this)?this.toString():"null"}function f(){return Math.abs(this)}function g(){return Math.round(this)}function k(){return Math.ceil(this)}function o(){return Math.floor(this)}return{toColorPart:a,succ:b,times:c,toPaddedString:d,toJSON:e,
abs:f,round:g,ceil:k,floor:o}}());function $R(a,b,c){return new ObjectRange(a,b,c)}
var ObjectRange=Class.create(Enumerable,function(){function a(d,e,f){this.start=d;this.end=e;this.exclusive=f}function b(d){for(var e=this.start;this.include(e);){d(e);e=e.succ()}}function c(d){if(d<this.start)return false;if(this.exclusive)return d<this.end;return d<=this.end}return{initialize:a,_each:b,include:c}}()),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||
false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){this.include(a)||this.responders.push(a)},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(a,b,c,d){this.each(function(e){if(Object.isFunction(e[a]))try{e[a].apply(e,[b,c,d])}catch(f){}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});
Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))this.options.parameters=this.options.parameters.toQueryParams();else if(Object.isHash(this.options.parameters))this.options.parameters=this.options.parameters.toObject()}});
Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,b,c){$super(c);this.transport=Ajax.getTransport();this.request(b)},request:function(a){this.url=a;this.method=this.options.method;a=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){a._method=this.method;this.method="post"}this.parameters=a;if(a=Object.toQueryString(a))if(this.method=="get")this.url+=(this.url.include("?")?"&":"?")+a;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))a+=
"&_=";try{var b=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(b);Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||a:null;this.transport.send(this.body);!this.options.asynchronous&&this.transport.overrideMimeType&&
this.onStateChange()}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;a>1&&!(a==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var a={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){a["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:
"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)a.Connection="close"}if(typeof this.options.requestHeaders=="object"){var b=this.options.requestHeaders;if(Object.isFunction(b.push))for(var c=0,d=b.length;c<d;c+=2)a[b[c]]=b[c+1];else $H(b).each(function(f){a[f.key]=f.value})}for(var e in a)this.transport.setRequestHeader(e,a[e])},success:function(){var a=this.getStatus();return!a||a>=200&&a<300},getStatus:function(){try{return this.transport.status||
0}catch(a){return 0}},respondToReadyState:function(a){a=Ajax.Request.Events[a];var b=new Ajax.Response(this);if(a=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(c){this.dispatchException(c)}var d=b.getHeader("Content-type");if(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&d&&d.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))this.evalResponse()}try{(this.options["on"+
a]||Prototype.emptyFunction)(b,b.headerJSON);Ajax.Responders.dispatch("on"+a,this,b,b.headerJSON)}catch(e){this.dispatchException(e)}if(a=="Complete")this.transport.onreadystatechange=Prototype.emptyFunction},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return!a||a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(a){try{return this.transport.getResponseHeader(a)||
null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(a){this.dispatchException(a)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(a){this.request=a;a=this.transport=a.transport;var b=this.readyState=a.readyState;if(b>2&&!Prototype.Browser.IE||b==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(a.responseText);this.headerJSON=this._getHeaderJSON()}if(b==4){a=a.responseXML;this.responseXML=Object.isUndefined(a)?null:a;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,
getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a)return null;a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||
!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,b,c,d){this.container={success:b.success||b,failure:b.failure||(b.success?null:b)};d=Object.clone(d);var e=d.onComplete;d.onComplete=function(f,g){this.updateContent(f.responseText);Object.isFunction(e)&&e(f,g)}.bind(this);$super(c,d)},updateContent:function(a){var b=this.container[this.success()?"success":"failure"],c=this.options;c.evalScripts||(a=a.stripScripts());if(b=$(b))if(c.insertion)if(Object.isString(c.insertion)){var d=
{};d[c.insertion]=a;b.insert(d)}else c.insertion(b,a);else b.update(a)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,b,c,d){$super(d);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=b;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(a){if(this.options.decay){this.decay=a.responseText==this.lastText?this.decay*this.options.decay:1;this.lastText=a.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(a){if(arguments.length>1){for(var b=0,c=[],d=arguments.length;b<d;b++)c.push($(arguments[b]));return c}if(Object.isString(a))a=document.getElementById(a);return Element.extend(a)}if(Prototype.BrowserFeatures.XPath)document._getElementsByXPath=function(a,b){var c=[];a=document.evaluate(a,$(b)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);b=0;for(var d=a.snapshotLength;b<d;b++)c.push(Element.extend(a.snapshotItem(b)));return c};if(!window.Node)var Node={};
Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});
(function(a){var b=function(){var d=document.createElement("form"),e=document.createElement("input"),f=document.documentElement;e.setAttribute("name","test");d.appendChild(e);f.appendChild(d);e=d.elements?typeof d.elements.test=="undefined":null;f.removeChild(d);return e}(),c=a.Element;a.Element=function(d,e){e=e||{};d=d.toLowerCase();var f=Element.cache;if(b&&e.name){d="<"+d+' name="'+e.name+'">';delete e.name;return Element.writeAttribute(document.createElement(d),e)}f[d]||(f[d]=Element.extend(document.createElement(d)));
return Element.writeAttribute(f[d].cloneNode(false),e)};Object.extend(a.Element,c||{});if(c)a.Element.prototype=c.prototype})(this);Element.cache={};Element.idCounter=1;
Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:function(){function a(e,f){e=$(e);if(f&&f.toElement)f=f.toElement();if(Object.isElement(f))return e.update().insert(f);f=Object.toHTML(f);var g=e.tagName.toUpperCase();
if(g==="SCRIPT"&&d){e.text=f;return e}if(b||c)if(g in Element._insertionTranslations.tags){for(;e.firstChild;)e.removeChild(e.firstChild);Element._getContentFromAnonymousElement(g,f.stripScripts()).each(function(k){e.appendChild(k)})}else e.innerHTML=f.stripScripts();else e.innerHTML=f.stripScripts();f.evalScripts.bind(f).defer();return e}var b=function(){var e=document.createElement("select"),f=true;e.innerHTML='<option value="test">test</option>';if(e.options&&e.options[0])f=e.options[0].nodeName.toUpperCase()!==
"OPTION";return f}(),c=function(){try{var e=document.createElement("table");if(e&&e.tBodies){e.innerHTML="<tbody><tr><td>test</td></tr></tbody>";return typeof e.tBodies[0]=="undefined"}}catch(f){return true}}(),d=function(){var e=document.createElement("script"),f=false;try{e.appendChild(document.createTextNode(""));f=!e.firstChild||e.firstChild&&e.firstChild.nodeType!==3}catch(g){f=true}return f}();return a}(),replace:function(a,b){a=$(a);if(b&&b.toElement)b=b.toElement();else if(!Object.isElement(b)){b=
Object.toHTML(b);var c=a.ownerDocument.createRange();c.selectNode(a);b.evalScripts.bind(b).defer();b=c.createContextualFragment(b.stripScripts())}a.parentNode.replaceChild(b,a);return a},insert:function(a,b){a=$(a);if(Object.isString(b)||Object.isNumber(b)||Object.isElement(b)||b&&(b.toElement||b.toHTML))b={bottom:b};var c,d,e;for(var f in b){c=b[f];f=f.toLowerCase();d=Element._insertionTranslations[f];if(c&&c.toElement)c=c.toElement();if(Object.isElement(c))d(a,c);else{c=Object.toHTML(c);e=(f=="before"||
f=="after"?a.parentNode:a).tagName.toUpperCase();e=Element._getContentFromAnonymousElement(e,c.stripScripts());if(f=="top"||f=="after")e.reverse();e.each(d.curry(a));c.evalScripts.bind(c).defer()}}return a},wrap:function(a,b,c){a=$(a);if(Object.isElement(b))$(b).writeAttribute(c||{});else b=Object.isString(b)?new Element(b,c):new Element("div",b);a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b},inspect:function(a){a=$(a);var b="<"+a.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(c){var d=
c.first();c=c.last();if(d=(a[d]||"").toString())b+=" "+c+"="+d.inspect(true)});return b+">"},recursivelyCollect:function(a,b){a=$(a);for(var c=[];a=a[b];)a.nodeType==1&&c.push(Element.extend(a));return c},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){for(a=$(a).firstChild;a&&a.nodeType!=1;)a=a.nextSibling;return $(a)},immediateDescendants:function(a){if(!(a=$(a).firstChild))return[];for(;a&&
a.nodeType!=1;)a=a.nextSibling;if(a)return[a].concat($(a).nextSiblings());return[]},previousSiblings:function(a){return Element.recursivelyCollect(a,"previousSibling")},nextSiblings:function(a){return Element.recursivelyCollect(a,"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(a,b){if(Object.isString(b))b=new Selector(b);return b.match($(a))},up:function(a,b,c){a=$(a);if(arguments.length==1)return $(a.parentNode);
var d=Element.ancestors(a);return Object.isNumber(b)?d[b]:Selector.findElement(d,b,c)},down:function(a,b,c){a=$(a);if(arguments.length==1)return Element.firstDescendant(a);return Object.isNumber(b)?Element.descendants(a)[b]:Element.select(a,b)[c||0]},previous:function(a,b,c){a=$(a);if(arguments.length==1)return $(Selector.handlers.previousElementSibling(a));var d=Element.previousSiblings(a);return Object.isNumber(b)?d[b]:Selector.findElement(d,b,c)},next:function(a,b,c){a=$(a);if(arguments.length==
1)return $(Selector.handlers.nextElementSibling(a));var d=Element.nextSiblings(a);return Object.isNumber(b)?d[b]:Selector.findElement(d,b,c)},select:function(a){var b=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(a,b)},adjacent:function(a){var b=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(a.parentNode,b).without(a)},identify:function(a){a=$(a);var b=Element.readAttribute(a,"id");if(b)return b;do b="anonymous_element_"+Element.idCounter++;while($(b));
Element.writeAttribute(a,"id",b);return b},readAttribute:function(a,b){a=$(a);if(Prototype.Browser.IE){var c=Element._attributeTranslations.read;if(c.values[b])return c.values[b](a,b);if(c.names[b])b=c.names[b];if(b.include(":"))return!a.attributes||!a.attributes[b]?null:a.attributes[b].value}return a.getAttribute(b)},writeAttribute:function(a,b,c){a=$(a);var d={},e=Element._attributeTranslations.write;if(typeof b=="object")d=b;else d[b]=Object.isUndefined(c)?true:c;for(var f in d){b=e.names[f]||
f;c=d[f];if(e.values[f])b=e.values[f](a,c);if(c===false||c===null)a.removeAttribute(b);else c===true?a.setAttribute(b,b):a.setAttribute(b,c)}return a},getHeight:function(a){return Element.getDimensions(a).height},getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(a=$(a)){a=a.className;return a.length>0&&(a==b||(new RegExp("(^|\\s)"+b+"(\\s|$)")).test(a))}},addClassName:function(a,b){if(a=$(a)){Element.hasClassName(a,
b)||(a.className+=(a.className?" ":"")+b);return a}},removeClassName:function(a,b){if(a=$(a)){a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip();return a}},toggleClassName:function(a,b){if(a=$(a))return Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(a){a=$(a);for(var b=a.firstChild;b;){var c=b.nextSibling;b.nodeType==3&&!/\S/.test(b.nodeValue)&&a.removeChild(b);b=c}return a},empty:function(a){return $(a).innerHTML.blank()},
descendantOf:function(a,b){a=$(a);b=$(b);if(a.compareDocumentPosition)return(a.compareDocumentPosition(b)&8)===8;if(b.contains)return b.contains(a)&&b!==a;for(;a=a.parentNode;)if(a==b)return true;return false},scrollTo:function(a){a=$(a);var b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(a,b){a=$(a);b=b=="float"?"cssFloat":b.camelize();var c=a.style[b];if(!c||c=="auto")c=(a=document.defaultView.getComputedStyle(a,null))?a[b]:null;if(b=="opacity")return c?parseFloat(c):
1;return c=="auto"?null:c},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(a,b){a=$(a);var c=a.style;if(Object.isString(b)){a.style.cssText+=";"+b;return b.include("opacity")?a.setOpacity(b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a}for(var d in b)if(d=="opacity")a.setOpacity(b[d]);else c[d=="float"||d=="cssFloat"?Object.isUndefined(c.styleFloat)?"cssFloat":"styleFloat":d]=b[d];return a},setOpacity:function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;return a},getDimensions:function(a){a=
$(a);var b=Element.getStyle(a,"display");if(b!="none"&&b!=null)return{width:a.offsetWidth,height:a.offsetHeight};b=a.style;var c=b.visibility,d=b.position,e=b.display;b.visibility="hidden";if(d!="fixed")b.position="absolute";b.display="block";var f=a.clientWidth;a=a.clientHeight;b.display=e;b.position=d;b.visibility=c;return{width:f,height:a}},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b){a._madePositioned=true;a.style.position="relative";if(Prototype.Browser.Opera){a.style.top=
0;a.style.left=0}}return a},undoPositioned:function(a){a=$(a);if(a._madePositioned){a._madePositioned=undefined;a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""}return a},makeClipping:function(a){a=$(a);if(a._overflow)return a;a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden")a.style.overflow="hidden";return a},undoClipping:function(a){a=$(a);if(!a._overflow)return a;a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a},
cumulativeOffset:function(a){var b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||0;a=a.offsetParent}while(a);return Element._returnOffset(c,b)},positionedOffset:function(a){var b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||0;if(a=a.offsetParent){if(a.tagName.toUpperCase()=="BODY")break;if(Element.getStyle(a,"position")!=="static")break}}while(a);return Element._returnOffset(c,b)},absolutize:function(a){a=$(a);if(Element.getStyle(a,"position")=="absolute")return a;var b=Element.positionedOffset(a),c=
b[1];b=b[0];var d=a.clientWidth,e=a.clientHeight;a._originalLeft=b-parseFloat(a.style.left||0);a._originalTop=c-parseFloat(a.style.top||0);a._originalWidth=a.style.width;a._originalHeight=a.style.height;a.style.position="absolute";a.style.top=c+"px";a.style.left=b+"px";a.style.width=d+"px";a.style.height=e+"px";return a},relativize:function(a){a=$(a);if(Element.getStyle(a,"position")=="relative")return a;a.style.position="relative";var b=parseFloat(a.style.top||0)-(a._originalTop||0),c=parseFloat(a.style.left||
0)-(a._originalLeft||0);a.style.top=b+"px";a.style.left=c+"px";a.style.height=a._originalHeight;a.style.width=a._originalWidth;return a},cumulativeScrollOffset:function(a){var b=0,c=0;do{b+=a.scrollTop||0;c+=a.scrollLeft||0;a=a.parentNode}while(a);return Element._returnOffset(c,b)},getOffsetParent:function(a){if(a.offsetParent)return $(a.offsetParent);if(a==document.body)return $(a);for(;(a=a.parentNode)&&a!=document.body;)if(Element.getStyle(a,"position")!="static")return $(a);return $(document.body)},
viewportOffset:function(a){var b=0,c=0,d=a;do{b+=d.offsetTop||0;c+=d.offsetLeft||0;if(d.offsetParent==document.body&&Element.getStyle(d,"position")=="absolute")break}while(d=d.offsetParent);d=a;do if(!Prototype.Browser.Opera||d.tagName&&d.tagName.toUpperCase()=="BODY"){b-=d.scrollTop||0;c-=d.scrollLeft||0}while(d=d.parentNode);return Element._returnOffset(c,b)},clonePosition:function(a,b,c){c=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},c||{});b=$(b);
var d=Element.viewportOffset(b);a=$(a);var e=[0,0],f=null;if(Element.getStyle(a,"position")=="absolute"){f=Element.getOffsetParent(a);e=Element.viewportOffset(f)}if(f==document.body){e[0]-=document.body.offsetLeft;e[1]-=document.body.offsetTop}if(c.setLeft)a.style.left=d[0]-e[0]+c.offsetLeft+"px";if(c.setTop)a.style.top=d[1]-e[1]+c.offsetTop+"px";if(c.setWidth)a.style.width=b.offsetWidth+"px";if(c.setHeight)a.style.height=b.offsetHeight+"px";return a}};
Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};
if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(a,b,c){switch(c){case "left":case "top":case "right":case "bottom":if(a(b,"position")==="static")return null;case "height":case "width":if(!Element.visible(b))return null;var d=parseInt(a(b,c),10);if(d!==b["offset"+c.capitalize()])return d+"px";return(c==="height"?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(d,
function(e,f){f=a(b,f);return f===null?e:e-parseInt(f,10)})+"px";default:return a(b,c)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(a,b,c){if(c==="title")return b.title;return a(b,c)})}else if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(a,b){b=$(b);var c=b.getStyle("position");if(c!=="static")return a(b);b.setStyle({position:"relative"});a=a(b);b.setStyle({position:c});return a});$w("positionedOffset viewportOffset").each(function(a){Element.Methods[a]=
Element.Methods[a].wrap(function(b,c){c=$(c);var d=c.getStyle("position");if(d!=="static")return b(c);var e=c.getOffsetParent();e&&e.getStyle("position")==="fixed"&&e.setStyle({zoom:1});c.setStyle({position:"relative"});b=b(c);c.setStyle({position:d});return b})});Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(a,b){return a(b)});Element.Methods.getStyle=function(a,b){a=$(a);b=b=="float"||b=="cssFloat"?"styleFloat":b.camelize();var c=a.style[b];if(!c&&a.currentStyle)c=
a.currentStyle[b];if(b=="opacity"){if(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))if(c[1])return parseFloat(c[1])/100;return 1}if(c=="auto"){if((b=="width"||b=="height")&&a.getStyle("display")!="none")return a["offset"+b.capitalize()]+"px";return null}return c};Element.Methods.setOpacity=function(a,b){function c(f){return f.replace(/alpha\([^\)]*\)/gi,"")}a=$(a);var d=a.currentStyle;if(d&&!d.hasLayout||!d&&a.style.zoom=="normal")a.style.zoom=1;d=a.getStyle("filter");var e=a.style;
if(b==1||b===""){(d=c(d))?(e.filter=d):e.removeAttribute("filter");return a}else if(b<1.0E-5)b=0;e.filter=c(d)+"alpha(opacity="+b*100+")";return a};Element._attributeTranslations=function(){var a="className",b="for",c=document.createElement("div");c.setAttribute(a,"x");if(c.className!=="x"){c.setAttribute("class","x");if(c.className==="x")a="class"}c=null;c=document.createElement("label");c.setAttribute(b,"x");if(c.htmlFor!=="x"){c.setAttribute("htmlFor","x");if(c.htmlFor==="x")b="htmlFor"}c=null;
return{read:{names:{"class":a,className:a,"for":b,htmlFor:b},values:{_getAttr:function(d,e){return d.getAttribute(e)},_getAttr2:function(d,e){return d.getAttribute(e,2)},_getAttrNode:function(d,e){return(d=d.getAttributeNode(e))?d.value:""},_getEv:function(){var d=document.createElement("div");d.onclick=Prototype.emptyFunction;d=d.getAttribute("onclick");var e;if(String(d).indexOf("{")>-1)e=function(f,g){g=f.getAttribute(g);if(!g)return null;g=g.toString();g=g.split("{")[1];g=g.split("}")[0];return g.strip()};
else if(d==="")e=function(f,g){g=f.getAttribute(g);if(!g)return null;return g.strip()};d=null;return e}(),_flag:function(d,e){return $(d).hasAttribute(e)?e:null},style:function(d){return d.style.cssText.toLowerCase()},title:function(d){return d.title}}}}}();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=b?b:""}}};
Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a});(function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,ondblclick:a._getEv,
onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})})(Element._attributeTranslations.read.values);Prototype.BrowserFeatures.ElementExtensions&&function(){function a(b){b=b.getElementsByTagName("*");for(var c=[],d=0,e;e=b[d];d++)e.tagName!=="!"&&c.push(e);return c}Element.Methods.down=function(b,
c,d){b=$(b);if(arguments.length==1)return b.firstDescendant();return Object.isNumber(c)?a(b)[c]:Element.select(b,c)[d||0]}}()}else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent))Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=b==1?0.999999:b===""?"":b<1.0E-5?0:b;return a};else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;if(b==1)if(a.tagName.toUpperCase()=="IMG"&&a.width){a.width++;a.width--}else try{var c=
document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(d){}return a};Element.Methods.cumulativeOffset=function(a){var b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||0;if(a.offsetParent==document.body)if(Element.getStyle(a,"position")=="absolute")break;a=a.offsetParent}while(a);return Element._returnOffset(c,b)}}
if("outerHTML"in document.documentElement)Element.Methods.replace=function(a,b){a=$(a);if(b&&b.toElement)b=b.toElement();if(Object.isElement(b)){a.parentNode.replaceChild(b,a);return a}b=Object.toHTML(b);var c=a.parentNode,d=c.tagName.toUpperCase();if(Element._insertionTranslations.tags[d]){var e=a.next();d=Element._getContentFromAnonymousElement(d,b.stripScripts());c.removeChild(a);e?d.each(function(f){c.insertBefore(f,e)}):d.each(function(f){c.appendChild(f)})}else a.outerHTML=b.stripScripts();
b.evalScripts.bind(b).defer();return a};Element._returnOffset=function(a,b){var c=[a,b];c.left=a;c.top=b;return c};Element._getContentFromAnonymousElement=function(a,b){var c=new Element("div");if(a=Element._insertionTranslations.tags[a]){c.innerHTML=a[0]+b+a[1];a[2].times(function(){c=c.firstChild})}else c.innerHTML=b;return $A(c.childNodes)};
Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};
(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,b){b=Element._attributeTranslations.has[b]||b;a=$(a).getAttributeNode(b);return!!(a&&a.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);
(function(a){if(!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__){window.HTMLElement={};window.HTMLElement.prototype=a.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}})(document.createElement("div"));
Element.extend=function(){function a(f){if(typeof window.Element!="undefined"){var g=window.Element.prototype;if(g){var k="_"+(Math.random()+"").slice(2);f=document.createElement(f);g[k]="x";f=f[k]!=="x";delete g[k];return f}}return false}function b(f,g){for(var k in g){var o=g[k];if(Object.isFunction(o)&&!(k in f))f[k]=o.methodize()}}var c=a("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(c)return function(f){if(f&&typeof f._extendedByPrototype=="undefined"){var g=f.tagName;
if(g&&/^(?:object|applet|embed)$/i.test(g)){b(f,Element.Methods);b(f,Element.Methods.Simulated);b(f,Element.Methods.ByTag[g.toUpperCase()])}}return f};return Prototype.K}var d={},e=Element.Methods.ByTag;c=Object.extend(function(f){if(!f||typeof f._extendedByPrototype!="undefined"||f.nodeType!=1||f==window)return f;var g=Object.clone(d),k=f.tagName.toUpperCase();e[k]&&Object.extend(g,e[k]);b(f,g);f._extendedByPrototype=Prototype.emptyFunction;return f},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(d,
Element.Methods);Object.extend(d,Element.Methods.Simulated)}}});c.refresh();return c}();Element.hasAttribute=function(a,b){if(a.hasAttribute)return a.hasAttribute(b);return Element.Methods.Simulated.hasAttribute(a,b)};
Element.addMethods=function(a){function b(o){o=o.toUpperCase();Element.Methods.ByTag[o]||(Element.Methods.ByTag[o]={});Object.extend(Element.Methods.ByTag[o],a)}function c(o,v,r){r=r||false;for(var q in o){var B=o[q];if(Object.isFunction(B))if(!r||!(q in v))v[q]=B.methodize()}}function d(o){var v,r={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",
Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(r[o])v="HTML"+r[o]+"Element";if(window[v])return window[v];v="HTML"+o+"Element";if(window[v])return window[v];v="HTML"+o.capitalize()+"Element";if(window[v])return window[v];o=document.createElement(o);return o.__proto__||o.constructor.prototype}
var e=Prototype.BrowserFeatures,f=Element.Methods.ByTag;if(!a){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var g=a;a=arguments[1]}if(g)Object.isArray(g)?g.each(b):b(g);else Object.extend(Element.Methods,a||{});g=window.HTMLElement?HTMLElement.prototype:
Element.prototype;if(e.ElementExtensions){c(Element.Methods,g);c(Element.Methods.Simulated,g,true)}if(e.SpecificElementExtensions)for(var k in Element.Methods.ByTag){e=d(k);Object.isUndefined(e)||c(f[k],e.prototype)}Object.extend(Element,Element.Methods);delete Element.ByTag;Element.extend.refresh&&Element.extend.refresh();Element.cache={}};
document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};
(function(a){function b(){if(d.WebKit&&!e.evaluate)return document;if(d.Opera&&window.parseFloat(window.opera.version())<9.5)return document.body;return document.documentElement}function c(k){f||(f=b());g[k]="client"+k;a["get"+k]=function(){return f[g[k]]};return a["get"+k]()}var d=Prototype.Browser,e=document,f,g={};a.getWidth=c.curry("Width");a.getHeight=c.curry("Height")})(document.viewport);Element.Storage={UID:1};
Element.addMethods({getStorage:function(a){if(a=$(a)){if(a===window)a=0;else{if(typeof a._prototypeUID==="undefined")a._prototypeUID=[Element.Storage.UID++];a=a._prototypeUID[0]}Element.Storage[a]||(Element.Storage[a]=$H());return Element.Storage[a]}},store:function(a,b,c){if(a=$(a)){arguments.length===2?Element.getStorage(a).update(b):Element.getStorage(a).set(b,c);return a}},retrieve:function(a,b,c){if(a=$(a)){a=Element.getStorage(a);var d=a.get(b);if(Object.isUndefined(d)){a.set(b,c);d=c}return d}},
clone:function(a,b){if(a=$(a)){a=a.cloneNode(b);a._prototypeUID=void 0;if(b){b=Element.select(a,"*");for(var c=b.length;c--;)b[c]._prototypeUID=void 0}return Element.extend(a)}}});
var Selector=Class.create({initialize:function(a){this.expression=a.strip();if(this.shouldUseSelectorsAPI())this.mode="selectorsAPI";else if(this.shouldUseXPath()){this.mode="xpath";this.compileXPathMatcher()}else{this.mode="normal";this.compileMatcher()}},shouldUseXPath:function(){var a=function(){var b=false;if(document.evaluate&&window.XPathResult){b=document.createElement("div");b.innerHTML="<ul><li></li></ul><div><ul><li></li></ul></div>";b=document.evaluate(".//*[local-name()='ul' or local-name()='UL']//*[local-name()='li' or local-name()='LI']",
b,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotLength!==2}return b}();return function(){if(!Prototype.BrowserFeatures.XPath)return false;var b=this.expression;if(Prototype.Browser.WebKit&&(b.include("-of-type")||b.include(":empty")))return false;if(/(\[[\w-]*?:|:checked)/.test(b))return false;if(a)return false;return true}}(),shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI)return false;if(Selector.CASE_INSENSITIVE_CLASS_NAMES)return false;if(!Selector._div)Selector._div=
new Element("div");try{Selector._div.querySelector(this.expression)}catch(a){return false}return true},compileMatcher:function(){var a=this.expression,b=Selector.patterns,c=Selector.criteria,d,e,f=b.length,g;if(Selector._cache[a])this.matcher=Selector._cache[a];else{for(this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];a&&d!=a&&/\S/.test(a);){d=a;for(var k=0;k<f;k++){e=b[k].re;g=b[k].name;if(e=a.match(e)){this.matcher.push(Object.isFunction(c[g])?
c[g](e):(new Template(c[g])).evaluate(e));a=a.replace(e[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher}},compileXPathMatcher:function(){var a=this.expression,b=Selector.patterns,c=Selector.xpath,d,e,f=b.length,g;if(Selector._cache[a])this.xpath=Selector._cache[a];else{for(this.matcher=[".//*"];a&&d!=a&&/\S/.test(a);){d=a;for(var k=0;k<f;k++){g=b[k].name;if(e=a.match(b[k].re)){this.matcher.push(Object.isFunction(c[g])?
c[g](e):(new Template(c[g])).evaluate(e));a=a.replace(e[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath}},findElements:function(a){a=a||document;var b=this.expression;switch(this.mode){case "selectorsAPI":if(a!==document){var c=a.id,d=$(a).identify();d=d.replace(/([\.:])/g,"\\$1");b="#"+d+" "+b}b=$A(a.querySelectorAll(b)).map(Element.extend);a.id=c;return b;case "xpath":return document._getElementsByXPath(this.xpath,a);default:return this.matcher(a)}},match:function(a){this.tokens=
[];for(var b=this.expression,c=Selector.patterns,d=Selector.assertions,e,f,g=c.length,k;b&&e!==b&&/\S/.test(b);){e=b;for(var o=0;o<g;o++){f=c[o].re;k=c[o].name;if(f=b.match(f))if(d[k]){this.tokens.push([k,Object.clone(f)]);b=b.replace(f[0],"")}else return this.findElements(document).include(a)}}b=true;for(o=0;c=this.tokens[o];o++){k=c[0];c=c[1];if(!Selector.assertions[k](a,c)){b=false;break}}return b},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+
">"}});if(Prototype.BrowserFeatures.SelectorsAPI&&document.compatMode==="BackCompat")Selector.CASE_INSENSITIVE_CLASS_NAMES=function(){var a=document.createElement("div"),b=document.createElement("span");a.id="prototype_test_id";b.className="Test";a.appendChild(b);return a.querySelector("#prototype_test_id .test")!==null}();
Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(a){if(a[1]=="*")return"";return"[local-name()='"+a[1].toLowerCase()+"' or local-name()='"+a[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(a){a[1]=a[1].toLowerCase();return(new Template("[@#{1}]")).evaluate(a)},attr:function(a){a[1]=a[1].toLowerCase();a[3]=a[5]||a[6];
return(new Template(Selector.xpath.operators[a[2]])).evaluate(a)},pseudo:function(a){var b=Selector.xpath.pseudos[a[1]];if(!b)return"";if(Object.isFunction(b))return b(a);return(new Template(Selector.xpath.pseudos[a[1]])).evaluate(a)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},
pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0)]",checked:"[@checked]",disabled:"[(@disabled) and (@type!='hidden')]",enabled:"[not(@disabled) and (@type!='hidden')]",not:function(a){for(var b=a[6],c=Selector.patterns,d=Selector.xpath,e,f,g=c.length,k=[];b&&e!=b&&/\S/.test(b);){e=b;for(var o=0;o<g;o++){f=c[o].name;if(a=b.match(c[o].re)){f=
Object.isFunction(d[f])?d[f](a):(new Template(d[f])).evaluate(a);k.push("("+f.substring(1,f.length-1)+")");b=b.replace(a[0],"");break}}}return"[not("+k.join(" and ")+")]"},"nth-child":function(a){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",a)},"nth-last-child":function(a){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",a)},"nth-of-type":function(a){return Selector.xpath.pseudos.nth("position() ",a)},"nth-last-of-type":function(a){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",
a)},"first-of-type":function(a){a[6]="1";return Selector.xpath.pseudos["nth-of-type"](a)},"last-of-type":function(a){a[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](a)},"only-of-type":function(a){var b=Selector.xpath.pseudos;return b["first-of-type"](a)+b["last-of-type"](a)},nth:function(a,b){var c=b[6];if(c=="even")c="2n+0";if(c=="odd")c="2n+1";if(b=c.match(/^(\d+)$/))return"["+a+"= "+b[1]+"]";if(b=c.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(b[1]=="-")b[1]=-1;c=b[1]?Number(b[1]):1;b=b[2]?
Number(b[2]):0;return(new Template("[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]")).evaluate({fragment:a,a:c,b:b})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(a){a[3]=a[5]||a[6];return(new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;')).evaluate(a)},
pseudo:function(a){if(a[6])a[6]=a[6].replace(/"/g,'\\"');return(new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;')).evaluate(a)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:[{name:"laterSibling",re:/^\s*~\s*/},{name:"child",re:/^\s*>\s*/},{name:"adjacent",re:/^\s*\+\s*/},{name:"descendant",re:/^\s/},{name:"tagName",re:/^\s*(\*|[\w\-]+)(\b|$)?/},{name:"id",re:/^#([\w\-\*]+)(\b|$)/},{name:"className",re:/^\.([\w\-\*]+)(\b|$)/},
{name:"pseudo",re:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/},{name:"attrPresence",re:/^\[((?:[\w-]+:)?[\w-]+)\]/},{name:"attr",re:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/}],assertions:{tagName:function(a,b){return b[1].toUpperCase()==a.tagName.toUpperCase()},className:function(a,b){return Element.hasClassName(a,b[1])},id:function(a,b){return a.id===b[1]},attrPresence:function(a,b){return Element.hasAttribute(a,
b[1])},attr:function(a,b){return(a=Element.readAttribute(a,b[1]))&&Selector.operators[b[2]](a,b[5]||b[6])}},handlers:{concat:function(a,b){for(var c=0,d;d=b[c];c++)a.push(d);return a},mark:function(a){for(var b=Prototype.emptyFunction,c=0,d;d=a[c];c++)d._countedByPrototype=b;return a},unmark:function(){return function(){var a=document.createElement("div"),b=false;a._countedByPrototype="x";return b=a.getAttribute("_countedByPrototype")==="x"}()?function(a){for(var b=0,c;c=a[b];b++)c.removeAttribute("_countedByPrototype");
return a}:function(a){for(var b=0,c;c=a[b];b++)c._countedByPrototype=void 0;return a}}(),index:function(a,b,c){a._countedByPrototype=Prototype.emptyFunction;if(b){a=a.childNodes;b=a.length-1;for(var d=1;b>=0;b--){var e=a[b];if(e.nodeType==1&&(!c||e._countedByPrototype))e.nodeIndex=d++}}else{b=0;d=1;for(a=a.childNodes;e=a[b];b++)if(e.nodeType==1&&(!c||e._countedByPrototype))e.nodeIndex=d++}},unique:function(a){if(a.length==0)return a;for(var b=[],c,d=0,e=a.length;d<e;d++)if(typeof(c=a[d])._countedByPrototype==
"undefined"){c._countedByPrototype=Prototype.emptyFunction;b.push(Element.extend(c))}return Selector.handlers.unmark(b)},descendant:function(a){for(var b=Selector.handlers,c=0,d=[],e;e=a[c];c++)b.concat(d,e.getElementsByTagName("*"));return d},child:function(a){for(var b=0,c=[],d;d=a[b];b++)for(var e=0,f;f=d.childNodes[e];e++)f.nodeType==1&&f.tagName!="!"&&c.push(f);return c},adjacent:function(a){for(var b=0,c=[],d;d=a[b];b++)(d=this.nextElementSibling(d))&&c.push(d);return c},laterSibling:function(a){for(var b=
Selector.handlers,c=0,d=[],e;e=a[c];c++)b.concat(d,Element.nextSiblings(e));return d},nextElementSibling:function(a){for(;a=a.nextSibling;)if(a.nodeType==1)return a;return null},previousElementSibling:function(a){for(;a=a.previousSibling;)if(a.nodeType==1)return a;return null},tagName:function(a,b,c,d){var e=c.toUpperCase(),f=[],g=Selector.handlers;if(a){if(d){if(d=="descendant"){for(b=0;d=a[b];b++)g.concat(f,d.getElementsByTagName(c));return f}else a=this[d](a);if(c=="*")return a}for(b=0;d=a[b];b++)d.tagName.toUpperCase()===
e&&f.push(d);return f}else return b.getElementsByTagName(c)},id:function(a,b,c,d){var e=$(c),f=Selector.handlers;if(b==document){if(!e)return[];if(!a)return[e]}else if(!b.sourceIndex||b.sourceIndex<1){a=b.getElementsByTagName("*");for(var g=0,k;k=a[g];g++)if(k.id===c)return[k]}if(a){if(d)if(d=="child")for(b=0;k=a[b];b++){if(e.parentNode==k)return[e]}else if(d=="descendant")for(b=0;k=a[b];b++){if(Element.descendantOf(e,k))return[e]}else if(d=="adjacent")for(b=0;k=a[b];b++){if(Selector.handlers.previousElementSibling(e)==
k)return[e]}else a=f[d](a);for(b=0;k=a[b];b++)if(k==e)return[e];return[]}return e&&Element.descendantOf(e,b)?[e]:[]},className:function(a,b,c,d){if(a&&d)a=this[d](a);return Selector.handlers.byClassName(a,b,c)},byClassName:function(a,b,c){a||(a=Selector.handlers.descendant([b]));b=" "+c+" ";for(var d=0,e=[],f,g;f=a[d];d++){g=f.className;if(g.length!=0)if(g==c||(" "+g+" ").include(b))e.push(f)}return e},attrPresence:function(a,b,c,d){a||(a=b.getElementsByTagName("*"));if(a&&d)a=this[d](a);b=[];d=0;
for(var e;e=a[d];d++)Element.hasAttribute(e,c)&&b.push(e);return b},attr:function(a,b,c,d,e,f){a||(a=b.getElementsByTagName("*"));if(a&&f)a=this[f](a);b=Selector.operators[e];e=[];f=0;for(var g;g=a[f];f++){var k=Element.readAttribute(g,c);k!==null&&b(k,d)&&e.push(g)}return e},pseudo:function(a,b,c,d,e){if(a&&e)a=this[e](a);a||(a=d.getElementsByTagName("*"));return Selector.pseudos[b](a,c,d)}},pseudos:{"first-child":function(a){for(var b=0,c=[],d;d=a[b];b++)Selector.handlers.previousElementSibling(d)||
c.push(d);return c},"last-child":function(a){for(var b=0,c=[],d;d=a[b];b++)Selector.handlers.nextElementSibling(d)||c.push(d);return c},"only-child":function(a){for(var b=Selector.handlers,c=0,d=[],e;e=a[c];c++)!b.previousElementSibling(e)&&!b.nextElementSibling(e)&&d.push(e);return d},"nth-child":function(a,b,c){return Selector.pseudos.nth(a,b,c)},"nth-last-child":function(a,b,c){return Selector.pseudos.nth(a,b,c,true)},"nth-of-type":function(a,b,c){return Selector.pseudos.nth(a,b,c,false,true)},
"nth-last-of-type":function(a,b,c){return Selector.pseudos.nth(a,b,c,true,true)},"first-of-type":function(a,b,c){return Selector.pseudos.nth(a,"1",c,false,true)},"last-of-type":function(a,b,c){return Selector.pseudos.nth(a,"1",c,true,true)},"only-of-type":function(a,b,c){var d=Selector.pseudos;return d["last-of-type"](d["first-of-type"](a,b,c),b,c)},getIndices:function(a,b,c){if(a==0)return b>0?[b]:[];return $R(1,c).inject([],function(d,e){0==(e-b)%a&&(e-b)/a>=0&&d.push(e);return d})},nth:function(a,
b,c,d,e){if(a.length==0)return[];if(b=="even")b="2n+0";if(b=="odd")b="2n+1";c=Selector.handlers;var f=[],g=[],k;c.mark(a);for(var o=0;k=a[o];o++)if(!k.parentNode._countedByPrototype){c.index(k.parentNode,d,e);g.push(k.parentNode)}if(b.match(/^\d+$/)){b=Number(b);for(o=0;k=a[o];o++)k.nodeIndex==b&&f.push(k)}else if(k=b.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(k[1]=="-")k[1]=-1;o=k[1]?Number(k[1]):1;k=k[2]?Number(k[2]):0;b=Selector.pseudos.getIndices(o,k,a.length);o=0;for(d=b.length;k=a[o];o++)for(e=0;e<
d;e++)k.nodeIndex==b[e]&&f.push(k)}c.unmark(a);c.unmark(g);return f},empty:function(a){for(var b=0,c=[],d;d=a[b];b++)d.tagName=="!"||d.firstChild||c.push(d);return c},not:function(a,b,c){var d=Selector.handlers;b=(new Selector(b)).findElements(c);d.mark(b);c=0;for(var e=[],f;f=a[c];c++)f._countedByPrototype||e.push(f);d.unmark(b);return e},enabled:function(a){for(var b=0,c=[],d;d=a[b];b++)if(!d.disabled&&(!d.type||d.type!=="hidden"))c.push(d);return c},disabled:function(a){for(var b=0,c=[],d;d=a[b];b++)d.disabled&&
c.push(d);return c},checked:function(a){for(var b=0,c=[],d;d=a[b];b++)d.checked&&c.push(d);return c}},operators:{"=":function(a,b){return a==b},"!=":function(a,b){return a!=b},"^=":function(a,b){return a==b||a&&a.startsWith(b)},"$=":function(a,b){return a==b||a&&a.endsWith(b)},"*=":function(a,b){return a==b||a&&a.include(b)},"~=":function(a,b){return(" "+a+" ").include(" "+b+" ")},"|=":function(a,b){return("-"+(a||"").toUpperCase()+"-").include("-"+(b||"").toUpperCase()+"-")}},split:function(a){var b=
[];a.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(c){b.push(c[1].strip())});return b},matchElements:function(a,b){b=$$(b);var c=Selector.handlers;c.mark(b);for(var d=0,e=[],f;f=a[d];d++)f._countedByPrototype&&e.push(f);c.unmark(b);return e},findElement:function(a,b,c){if(Object.isNumber(b)){c=b;b=false}return Selector.matchElements(a,b||"*")[c||0]},findChildElements:function(a,b){b=Selector.split(b.join(","));for(var c=[],d=Selector.handlers,e=0,f=b.length,g;e<f;e++){g=new Selector(b[e].strip());
d.concat(c,g.findElements(a))}return f>1?d.unique(c):c}});Prototype.Browser.IE&&Object.extend(Selector.handlers,{concat:function(a,b){for(var c=0,d;d=b[c];c++)d.tagName!=="!"&&a.push(d);return a}});function $$(){return Selector.findChildElements(document,$A(arguments))}
var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(a,b){if(typeof b!="object")b={hash:!!b};else if(Object.isUndefined(b.hash))b.hash=true;var c,d,e=false,f=b.submit;a=a.inject({},function(g,k){if(!k.disabled&&k.name){c=k.name;d=$(k).getValue();if(d!=null&&k.type!="file"&&(k.type!="submit"||!e&&f!==false&&(!f||c==f)&&(e=true)))if(c in g){Object.isArray(g[c])||(g[c]=[g[c]]);g[c].push(d)}else g[c]=d}return g});return b.hash?a:Object.toQueryString(a)}};
Form.Methods={serialize:function(a,b){return Form.serializeElements(Form.getElements(a),b)},getElements:function(a){a=$(a).getElementsByTagName("*");for(var b,c=[],d=Form.Element.Serializers,e=0;b=a[e];e++)c.push(b);return c.inject([],function(f,g){d[g.tagName.toLowerCase()]&&f.push(Element.extend(g));return f})},getInputs:function(a,b,c){a=$(a);a=a.getElementsByTagName("input");if(!b&&!c)return $A(a).map(Element.extend);for(var d=0,e=[],f=a.length;d<f;d++){var g=a[d];b&&g.type!=b||c&&g.name!=c||
e.push(Element.extend(g))}return e},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(a){a=$(a).getElements().findAll(function(c){return"hidden"!=c.type&&!c.disabled});var b=a.findAll(function(c){return c.hasAttribute("tabIndex")&&c.tabIndex>=0}).sortBy(function(c){return c.tabIndex}).first();return b?b:a.find(function(c){return/^(?:input|select|textarea)$/i.test(c.tagName)})},
focusFirstElement:function(a){a=$(a);a.findFirstElement().activate();return a},request:function(a,b){a=$(a);b=Object.clone(b||{});var c=b.parameters,d=a.readAttribute("action")||"";if(d.blank())d=window.location.href;b.parameters=a.serialize(true);if(c){if(Object.isString(c))c=c.toQueryParams();Object.extend(b.parameters,c)}if(a.hasAttribute("method")&&!b.method)b.method=a.method;return new Ajax.Request(d,b)}};
Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};
Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus();
if(a.select&&(a.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(a.type)))a.select()}catch(b){}return a},disable:function(a){a=$(a);a.disabled=true;return a},enable:function(a){a=$(a);a.disabled=false;return a}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers={input:function(a,b){switch(a.type.toLowerCase()){case "checkbox":case "radio":return Form.Element.Serializers.inputSelector(a,b);default:return Form.Element.Serializers.textarea(a,b)}},inputSelector:function(a,b){if(Object.isUndefined(b))return a.checked?a.value:null;else a.checked=!!b},textarea:function(a,b){if(Object.isUndefined(b))return a.value;else a.value=b},select:function(a,b){if(Object.isUndefined(b))return this[a.type=="select-one"?"selectOne":"selectMany"](a);
else for(var c,d,e=!Object.isArray(b),f=0,g=a.length;f<g;f++){c=a.options[f];d=this.optionValue(c);if(e){if(d==b){c.selected=true;return}}else c.selected=b.include(d)}},selectOne:function(a){var b=a.selectedIndex;return b>=0?this.optionValue(a.options[b]):null},selectMany:function(a){var b,c=a.length;if(!c)return null;var d=0;for(b=[];d<c;d++){var e=a.options[d];e.selected&&b.push(this.optionValue(e))}return b},optionValue:function(a){return Element.extend(a).hasAttribute("value")?a.value:a.text}};
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,b,c,d){$super(d,c);this.element=$(b);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a)){this.callback(this.element,a);this.lastValue=a}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a){this.callback(this.element,a);this.lastValue=a}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type)switch(a.type.toLowerCase()){case "checkbox":case "radio":Event.observe(a,
"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this));break}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(){function a(h){return x(h,0)}function b(h){return x(h,1)}function c(h){return x(h,2)}function d(h){h=E.extend(h);var m=h.target,p=h.type;if((h=h.currentTarget)&&h.tagName)if(p==="load"||p==="error"||p==="click"&&h.tagName.toLowerCase()==="input"&&h.type==="radio")m=h;if(m.nodeType==Node.TEXT_NODE)m=m.parentNode;return Element.extend(m)}function e(h,m){h=E.element(h);if(!m)return h;h=[h].concat(h.ancestors());return Selector.findElement(h,m,0)}function f(h){return{x:g(h),y:k(h)}}function g(h){var m=
document.documentElement,p=document.body||{scrollLeft:0};return h.pageX||h.clientX+(m.scrollLeft||p.scrollLeft)-(m.clientLeft||0)}function k(h){var m=document.documentElement,p=document.body||{scrollTop:0};return h.pageY||h.clientY+(m.scrollTop||p.scrollTop)-(m.clientTop||0)}function o(h){E.extend(h);h.preventDefault();h.stopPropagation();h.stopped=true}function v(h,m,p){var C=Element.retrieve(h,"prototype_event_registry");if(Object.isUndefined(C)){y.push(h);C=Element.retrieve(h,"prototype_event_registry",
$H())}var J=C.get(m);if(Object.isUndefined(J)){J=[];C.set(m,J)}if(J.pluck("handler").include(p))return false;var N;if(m.include(":"))N=function(S){if(Object.isUndefined(S.eventName))return false;if(S.eventName!==m)return false;E.extend(S,h);p.call(h,S)};else if(!t&&(m==="mouseenter"||m==="mouseleave")){if(m==="mouseenter"||m==="mouseleave")N=function(S){E.extend(S,h);for(var Q=S.relatedTarget;Q&&Q!==h;)try{Q=Q.parentNode}catch(z){Q=h}Q!==h&&p.call(h,S)}}else N=function(S){E.extend(S,h);p.call(h,S)};
N.handler=p;J.push(N);return N}function r(){for(var h=0,m=y.length;h<m;h++){E.stopObserving(y[h]);y[h]=null}}function q(h,m,p){h=$(h);p=v(h,m,p);if(!p)return h;if(m.include(":"))if(h.addEventListener)h.addEventListener("dataavailable",p,false);else{h.attachEvent("ondataavailable",p);h.attachEvent("onfilterchange",p)}else{m=u(m);h.addEventListener?h.addEventListener(m,p,false):h.attachEvent("on"+m,p)}return h}function B(h,m,p){h=$(h);var C=Element.retrieve(h,"prototype_event_registry");if(Object.isUndefined(C))return h;
if(m&&!p){var J=C.get(m);if(Object.isUndefined(J))return h;J.each(function(Q){Element.stopObserving(h,m,Q.handler)});return h}else if(!m){C.each(function(Q){var z=Q.key;Q.value.each(function(G){Element.stopObserving(h,z,G.handler)})});return h}if(J=C.get(m)){var N=J.find(function(Q){return Q.handler===p});if(!N)return h;var S=u(m);if(m.include(":"))if(h.removeEventListener)h.removeEventListener("dataavailable",N,false);else{h.detachEvent("ondataavailable",N);h.detachEvent("onfilterchange",N)}else h.removeEventListener?
h.removeEventListener(S,N,false):h.detachEvent("on"+S,N);C.set(m,J.without(N));return h}}function I(h,m,p,C){h=$(h);if(Object.isUndefined(C))C=true;if(h==document&&document.createEvent&&!h.dispatchEvent)h=document.documentElement;var J;if(document.createEvent){J=document.createEvent("HTMLEvents");J.initEvent("dataavailable",true,true)}else{J=document.createEventObject();J.eventType=C?"ondataavailable":"onfilterchange"}J.eventName=m;J.memo=p||{};document.createEvent?h.dispatchEvent(J):h.fireEvent(J.eventType,
J);return E.extend(J)}var E={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},U=document.documentElement,t="onmouseenter"in U&&"onmouseleave"in U,x;if(Prototype.Browser.IE){var H={0:1,1:4,2:2};x=function(h,m){return h.button===H[m]}}else x=Prototype.Browser.WebKit?function(h,m){switch(m){case 0:return h.which==1&&!h.metaKey;case 1:return h.which==1&&h.metaKey;
default:return false}}:function(h,m){return h.which?h.which===m+1:h.button===m};E.Methods={isLeftClick:a,isMiddleClick:b,isRightClick:c,element:d,findElement:e,pointer:f,pointerX:g,pointerY:k,stop:o};var R=Object.keys(E.Methods).inject({},function(h,m){h[m]=E.Methods[m].methodize();return h});if(Prototype.Browser.IE){var D=function(h){switch(h.type){case "mouseover":h=h.fromElement;break;case "mouseout":h=h.toElement;break;default:return null}return Element.extend(h)};Object.extend(R,{stopPropagation:function(){this.cancelBubble=
true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});E.extend=function(h,m){if(!h)return false;if(h._extendedByPrototype)return h;h._extendedByPrototype=Prototype.emptyFunction;var p=E.pointer(h);Object.extend(h,{target:h.srcElement||m,relatedTarget:D(h),pageX:p.x,pageY:p.y});return Object.extend(h,R)}}else{E.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(E.prototype,R);E.extend=Prototype.K}var y=[];Prototype.Browser.IE&&
window.attachEvent("onunload",r);Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,false);var u=Prototype.K;t||(u=function(h){var m={mouseenter:"mouseover",mouseleave:"mouseout"};return h in m?m[h]:h});Object.extend(E,E.Methods);Object.extend(E,{fire:I,observe:q,stopObserving:B});Element.addMethods({fire:I,observe:q,stopObserving:B});Object.extend(document,{fire:I.methodize(),observe:q.methodize(),stopObserving:B.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,
E);else window.Event=E})();
(function(){function a(){if(!document.loaded){d&&window.clearTimeout(d);document.loaded=true;document.fire("dom:loaded")}}function b(){if(document.readyState==="complete"){document.stopObserving("readystatechange",b);a()}}function c(){try{document.documentElement.doScroll("left")}catch(e){d=c.defer();return}a()}var d;if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,false);else{document.observe("readystatechange",b);if(window==top)d=c.defer()}Event.observe(window,"load",
a)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||
document.documentElement.scrollTop||document.body.scrollTop||0},within:function(a,b,c){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(a,b,c);this.xcomp=b;this.ycomp=c;this.offset=Element.cumulativeOffset(a);return c>=this.offset[1]&&c<this.offset[1]+a.offsetHeight&&b>=this.offset[0]&&b<this.offset[0]+a.offsetWidth},withinIncludingScrolloffsets:function(a,b,c){var d=Element.cumulativeScrollOffset(a);this.xcomp=b+d[0]-this.deltaX;this.ycomp=c+d[1]-this.deltaY;this.offset=Element.cumulativeOffset(a);
return this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+a.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if(a=="vertical")return(this.offset[1]+b.offsetHeight-this.ycomp)/b.offsetHeight;if(a=="horizontal")return(this.offset[0]+b.offsetWidth-this.xcomp)/b.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},
relativize:function(a){Position.prepare();return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(a,b,c){c=c||{};return Element.clonePosition(b,a,c)}};
if(!document.getElementsByClassName)document.getElementsByClassName=function(a){function b(c){return c.blank()?null:"[contains(concat(' ', @class, ' '), ' "+c+" ')]"}a.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(c,d){d=d.toString().strip();return(d=/\s/.test(d)?$w(d).map(b).join(""):b(d))?document._getElementsByXPath(".//*"+d,c):[]}:function(c,d){d=d.toString().strip();var e=[],f=/\s/.test(d)?$w(d):null;if(!f&&!d)return e;c=$(c).getElementsByTagName("*");d=" "+d+" ";for(var g=
0,k,o;k=c[g];g++)if(k.className&&(o=" "+k.className+" ")&&(o.include(d)||f&&f.all(function(v){return!v.toString().blank()&&o.include(" "+v+" ")})))e.push(Element.extend(k));return e};return function(c,d){return $(d||document.body).getElementsByClassName(c)}}(Element.Methods);Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){this.include(a)||this.set($A(this).concat(a).join(" "))},remove:function(a){this.include(a)&&this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);
var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(a,b,c){a=a.toUpperCase();var d=document.createElement(this.NODEMAP[a]||"div");try{d.innerHTML="<"+a+"></"+a+">"}catch(e){}var f=d.firstChild||null;if(f&&f.tagName.toUpperCase()!=a)f=f.getElementsByTagName(a)[0];f||(f=document.createElement(a));if(f){if(b)if(this._isStringOrNumber(b)||
b instanceof Array||b.tagName)this._children(f,b);else{var g=this._attributes(b);if(g.length){try{d.innerHTML="<"+a+" "+g+"></"+a+">"}catch(k){}f=d.firstChild||null;if(!f){f=document.createElement(a);for(attr in b)f[attr=="class"?"className":attr]=b[attr]}if(f.tagName.toUpperCase()!=a)f=d.getElementsByTagName(a)[0]}}c&&this._children(f,c);return $(f)}},_text:function(a){return document.createTextNode(a)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(a){var b=[];for(attribute in a)b.push((attribute in
this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+a[attribute].toString().escapeHTML().gsub(/"/,"&quot;")+'"');return b.join(" ")},_children:function(a,b){if(b.tagName)a.appendChild(b);else if(typeof b=="object")b.flatten().each(function(c){if(typeof c=="object")a.appendChild(c);else Builder._isStringOrNumber(c)&&a.appendChild(Builder._text(c))});else Builder._isStringOrNumber(b)&&a.appendChild(Builder._text(b))},_isStringOrNumber:function(a){return typeof a=="string"||typeof a=="number"},build:function(a){var b=
this.node("div");$(b).update(a.strip());return b.down()},dump:function(a){if(typeof a!="object"&&typeof a!="function")a=window;"A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR".split(/\s+/).each(function(b){a[b]=
function(){return Builder.node.apply(Builder,[b].concat($A(arguments)))}})}};String.prototype.parseColor=function(a){var b="#";if(this.slice(0,4)=="rgb("){var c=this.slice(4,this.length-1).split(","),d=0;do b+=parseInt(c[d]).toColorPart();while(++d<3)}else if(this.slice(0,1)=="#"){if(this.length==4)for(d=1;d<4;d++)b+=(this.charAt(d)+this.charAt(d)).toLowerCase();if(this.length==7)b=this.toLowerCase()}return b.length==7?b:a||this};
Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return b.nodeType==3?b.nodeValue:b.hasChildNodes()?Element.collectTextNodes(b):""}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(c){return c.nodeType==3?c.nodeValue:c.hasChildNodes()&&!Element.hasClassName(c,b)?Element.collectTextNodesIgnoreClass(c,b):""}).flatten().join("")};
Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:b/100+"em"});Prototype.Browser.WebKit&&window.scrollBy(0,0);return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var b=document.createTextNode(" ");a.appendChild(b);a.removeChild(b)}catch(c){}};
var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return-Math.cos(a*Math.PI)/2+0.5},reverse:function(a){return 1-a},flicker:function(a){a=-Math.cos(a*Math.PI)/4+0.75+Math.random()/4;return a>1?1:a},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+0.5},pulse:function(a,b){return-Math.cos(a*((b||5)-0.5)*2*Math.PI)/2+0.5},spring:function(a){return 1-
Math.cos(a*4.5*Math.PI)*Math.exp(-a*6)},none:function(){return 0},full:function(){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE)b+=";zoom:1";a=$(a);$A(a.childNodes).each(function(c){if(c.nodeType==3){c.nodeValue.toArray().each(function(d){a.insertBefore((new Element("span",{style:b})).update(d==" "?String.fromCharCode(160):d),c)});Element.remove(c)}})},multiple:function(a,b,c){a=
(typeof a=="object"||Object.isFunction(a))&&a.length?a:$(a).childNodes;var d=Object.extend({speed:0.1,delay:0},c||{}),e=d.delay;$A(a).each(function(f,g){new b(f,Object.extend(d,{delay:g*d.speed+e}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(a,b,c){a=$(a);b=(b||"appear").toLowerCase();return Effect[Effect.PAIRS[b][a.visible()?1:0]](a,Object.extend({queue:{position:"end",scope:a.id||"global",limit:1}},c||{}))}};
Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;
Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(a){var b=(new Date).getTime();switch(Object.isString(a.options.queue)?a.options.queue:a.options.queue.position){case "front":this.effects.findAll(function(c){return c.state=="idle"}).each(function(c){c.startOn+=a.finishOn;c.finishOn+=a.finishOn});break;case "with-last":b=this.effects.pluck("startOn").max()||b;break;case "end":b=this.effects.pluck("finishOn").max()||
b;break}a.startOn+=b;a.finishOn+=b;if(!a.options.queue.limit||this.effects.length<a.options.queue.limit)this.effects.push(a);if(!this.interval)this.interval=setInterval(this.loop.bind(this),15)},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){for(var a=(new Date).getTime(),b=0,c=this.effects.length;b<c;b++)this.effects[b]&&this.effects[b].loop(a)}});
Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a))return a;return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue)}};Effect.Queue=Effect.Queues.get("global");
Effect.Base=Class.create({position:null,start:function(a){if(a&&a.transition===false)a.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1E3;this.finishOn=this.startOn+this.options.duration*1E3;this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=function(){function b(c,
d){c.options[d+"Internal"]&&c.options[d+"Internal"](c);c.options[d]&&c.options[d](c)}return function(c){if(this.state==="idle"){this.state="running";b(this,"beforeSetup");this.setup&&this.setup();b(this,"afterSetup")}if(this.state==="running"){this.position=c=this.options.transition(c)*this.fromToDelta+this.options.from;b(this,"beforeUpdate");this.update&&this.update(c);b(this,"afterUpdate")}}}();this.event("beforeStart");this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":
this.options.queue.scope).add(this)},loop:function(a){if(a>=this.startOn)if(a>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");this.finish&&this.finish();this.event("afterFinish")}else{a=(a-this.startOn)/this.totalTime;var b=(a*this.totalFrames).round();if(b>this.currentFrame){this.render(a);this.currentFrame=b}}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);this.state="finished"},
event:function(a){this.options[a+"Internal"]&&this.options[a+"Internal"](this);this.options[a]&&this.options[a](this)},inspect:function(){var a=$H();for(property in this)Object.isFunction(this[property])||a.set(property,this[property]);return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});
Effect.Parallel=Class.create(Effect.Base,{initialize:function(a,b){this.effects=a||[];this.start(b)},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");b.finish&&b.finish(a);b.event("afterFinish")})}});
Effect.Tween=Class.create(Effect.Base,{initialize:function(a,b,c){a=Object.isString(a)?$(a):a;var d=$A(arguments),e=d.last();d=d.length==5?d[3]:null;this.method=Object.isFunction(e)?e.bind(a):Object.isFunction(a[e])?a[e].bind(a):function(f){a[e]=f};this.start(Object.extend({from:b,to:c},d||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(a){this.start(Object.extend({duration:0},a||{}))},update:Prototype.emptyFunction});
Effect.Opacity=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});this.start(Object.extend({from:this.element.getOpacity()||0,to:1},b||{}))},update:function(a){this.element.setOpacity(a)}});
Effect.Move=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({x:0,y:0,mode:"relative"},b||{}))},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x-=this.originalLeft;this.options.y-=this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*
a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(a,b,c,d){return new Effect.Move(a,Object.extend({x:c,y:b},d||{}))};
Effect.Scale=Class.create(Effect.Base,{initialize:function(a,b,c){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:b},c||{}))},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=
this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box")this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))this.dims=
[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]},update:function(a){a=this.options.scaleFrom/100+this.factor*a;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*a+this.fontSizeType});this.setDimensions(this.dims[0]*a,this.dims[1]*a)},finish:function(){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(a,b){var c={};
if(this.options.scaleX)c.width=b.round()+"px";if(this.options.scaleY)c.height=a.round()+"px";if(this.options.scaleFromCenter){a=(a-this.dims[0])/2;b=(b-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY)c.top=this.originalTop-a+"px";if(this.options.scaleX)c.left=this.originalLeft-b+"px"}else{if(this.options.scaleY)c.top=-a+"px";if(this.options.scaleX)c.left=-b+"px"}}this.element.setStyle(c)}});
Effect.Highlight=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({startcolor:"#ffff99"},b||{}))},setup:function(){if(this.element.getStyle("display")=="none")this.cancel();else{this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor)this.options.endcolor=
this.element.getStyle("background-color").parseColor("#ffffff");if(!this.options.restorecolor)this.options.restorecolor=this.element.getStyle("background-color");this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))}},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+
(this._base[d]+this._delta[d]*a).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(a,b){b=b||{};var c=document.viewport.getScrollOffsets();a=$(a).cumulativeOffset();if(b.offset)a[1]+=b.offset;return new Effect.Tween(null,c.top,a[1],b,function(d){scrollTo(c.left,d.round())})};
Effect.Fade=function(a,b){a=$(a);var c=a.getInlineOpacity();b=Object.extend({from:a.getOpacity()||1,to:0,afterFinishInternal:function(d){d.options.to==0&&d.element.hide().setStyle({opacity:c})}},b||{});return new Effect.Opacity(a,b)};
Effect.Appear=function(a,b){a=$(a);b=Object.extend({from:a.getStyle("display")=="none"?0:a.getOpacity()||0,to:1,afterFinishInternal:function(c){c.element.forceRerendering()},beforeSetup:function(c){c.element.setOpacity(c.options.from).show()}},b||{});return new Effect.Opacity(a,b)};
Effect.Puff=function(a,b){a=$(a);var c={opacity:a.getInlineOpacity(),position:a.getStyle("position"),top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};return new Effect.Parallel([new Effect.Scale(a,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(a,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(d){Position.absolutize(d.effects[0].element)},afterFinishInternal:function(d){d.effects[0].element.hide().setStyle(c)}},
b||{}))};Effect.BlindUp=function(a,b){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(c){c.element.hide().undoClipping()}},b||{}))};
Effect.BlindDown=function(a,b){a=$(a);var c=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:c.height,originalWidth:c.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(d){d.element.undoClipping()}},b||{}))};
Effect.SwitchOff=function(a,b){a=$(a);var c=a.getInlineOpacity();return new Effect.Appear(a,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(d){new Effect.Scale(d.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(e){e.element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned().setStyle({opacity:c})}})}},b||{}))};
Effect.DropOut=function(a,b){a=$(a);var c={top:a.getStyle("top"),left:a.getStyle("left"),opacity:a.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(a,{x:0,y:100,sync:true}),new Effect.Opacity(a,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(d){d.effects[0].element.makePositioned()},afterFinishInternal:function(d){d.effects[0].element.hide().undoPositioned().setStyle(c)}},b||{}))};
Effect.Shake=function(a,b){a=$(a);b=Object.extend({distance:20,duration:0.5},b||{});var c=parseFloat(b.distance),d=parseFloat(b.duration)/10,e={top:a.getStyle("top"),left:a.getStyle("left")};return new Effect.Move(a,{x:c,y:0,duration:d,afterFinishInternal:function(f){new Effect.Move(f.element,{x:-c*2,y:0,duration:d*2,afterFinishInternal:function(g){new Effect.Move(g.element,{x:c*2,y:0,duration:d*2,afterFinishInternal:function(k){new Effect.Move(k.element,{x:-c*2,y:0,duration:d*2,afterFinishInternal:function(o){new Effect.Move(o.element,
{x:c*2,y:0,duration:d*2,afterFinishInternal:function(v){new Effect.Move(v.element,{x:-c,y:0,duration:d,afterFinishInternal:function(r){r.element.undoPositioned().setStyle(e)}})}})}})}})}})}})};
Effect.SlideDown=function(a,b){a=$(a).cleanWhitespace();var c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:true,afterSetup:function(e){e.element.makePositioned();e.element.down().makePositioned();window.opera&&e.element.setStyle({top:""});e.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-
e.element.clientHeight+"px"})},afterFinishInternal:function(e){e.element.undoClipping().undoPositioned();e.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};
Effect.SlideUp=function(a,b){a=$(a).cleanWhitespace();var c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:true,afterSetup:function(e){e.element.makePositioned();e.element.down().makePositioned();window.opera&&e.element.setStyle({top:""});e.element.makeClipping().show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-
e.element.clientHeight+"px"})},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned();e.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};
Effect.Grow=function(a,b){a=$(a);var c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},b||{}),d={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},e=a.getDimensions(),f,g,k,o;switch(c.direction){case "top-left":f=g=k=o=0;break;case "top-right":f=e.width;g=o=0;k=-e.width;break;case "bottom-left":f=k=0;g=e.height;o=-e.height;break;
case "bottom-right":f=e.width;g=e.height;k=-e.width;o=-e.height;break;case "center":f=e.width/2;g=e.height/2;k=-e.width/2;o=-e.height/2;break}return new Effect.Move(a,{x:f,y:g,duration:0.01,beforeSetup:function(v){v.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(v){new Effect.Parallel([new Effect.Opacity(v.element,{sync:true,to:1,from:0,transition:c.opacityTransition}),new Effect.Move(v.element,{x:k,y:o,sync:true,transition:c.moveTransition}),new Effect.Scale(v.element,
100,{scaleMode:{originalHeight:e.height,originalWidth:e.width},sync:true,scaleFrom:window.opera?1:0,transition:c.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(r){r.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(r){r.effects[0].element.undoClipping().undoPositioned().setStyle(d)}},c))}})};
Effect.Shrink=function(a,b){a=$(a);b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},b||{});var c={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},d=a.getDimensions(),e,f;switch(b.direction){case "top-left":e=f=0;break;case "top-right":e=d.width;f=0;break;case "bottom-left":e=0;f=d.height;break;case "bottom-right":e=d.width;f=
d.height;break;case "center":e=d.width/2;f=d.height/2;break}return new Effect.Parallel([new Effect.Opacity(a,{sync:true,to:0,from:1,transition:b.opacityTransition}),new Effect.Scale(a,window.opera?1:0,{sync:true,transition:b.scaleTransition,restoreAfterFinish:true}),new Effect.Move(a,{x:e,y:f,sync:true,transition:b.moveTransition})],Object.extend({beforeStartInternal:function(g){g.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(g){g.effects[0].element.hide().undoClipping().undoPositioned().setStyle(c)}},
b))};Effect.Pulsate=function(a,b){a=$(a);var c=b||{},d=a.getInlineOpacity(),e=c.transition||Effect.Transitions.linear;return new Effect.Opacity(a,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(f){f.element.setStyle({opacity:d})}},c),{transition:function(f){return 1-e(-Math.cos(f*(c.pulses||5)*2*Math.PI)/2+0.5)}}))};
Effect.Fold=function(a,b){a=$(a);var c={top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};a.makeClipping();return new Effect.Scale(a,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(){new Effect.Scale(a,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(d){d.element.hide().undoClipping().setStyle(c)}})}},b||{}))};
Effect.Morph=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;a=Object.extend({style:{}},b||{});if(Object.isString(a.style))if(a.style.include(":"))this.style=a.style.parseStyle();else{this.element.addClassName(a.style);this.style=$H(this.element.getStyles());this.element.removeClassName(a.style);var c=this.element.getStyles();this.style=this.style.reject(function(d){return d.value==c[d.key]});a.afterFinishInternal=function(d){d.element.addClassName(d.options.style);
d.transforms.each(function(e){d.element.style[e.style]=""})}}else this.style=$H(a.style);this.start(a)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b))b="#ffffff";b=b.parseColor();return $R(0,2).map(function(c){return parseInt(b.slice(c*2+1,c*2+3),16)})}this.transforms=this.style.map(function(b){var c=b[0];b=b[1];var d=null;if(b.parseColor("#zzzzzz")!="#zzzzzz"){b=b.parseColor();d="color"}else if(c=="opacity"){b=parseFloat(b);Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&
this.element.setStyle({zoom:1})}else if(Element.CSS_LENGTH.test(b)){d=b.match(/^([\+\-]?[0-9\.]+)(.*)$/);b=parseFloat(d[1]);d=d.length==3?d[2]:null}var e=this.element.getStyle(c);return{style:c.camelize(),originalValue:d=="color"?a(e):parseFloat(e||0),targetValue:d=="color"?a(b):b,unit:d}}.bind(this)).reject(function(b){return b.originalValue==b.targetValue||b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))})},update:function(a){for(var b={},c,d=this.transforms.length;d--;)b[(c=this.transforms[d]).style]=
c.unit=="color"?"#"+Math.round(c.originalValue[0]+(c.targetValue[0]-c.originalValue[0])*a).toColorPart()+Math.round(c.originalValue[1]+(c.targetValue[1]-c.originalValue[1])*a).toColorPart()+Math.round(c.originalValue[2]+(c.targetValue[2]-c.originalValue[2])*a).toColorPart():(c.originalValue+(c.targetValue-c.originalValue)*a).toFixed(3)+(c.unit===null?"":c.unit);this.element.setStyle(b,true)}});
Effect.Transform=Class.create({initialize:function(a,b){this.tracks=[];this.options=b||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var c=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var b=a.get("ids"),c=a.get("effect"),d=a.get("options");return[$(b)||$$(b)].flatten().map(function(e){return new c(e,Object.extend({sync:true},
d))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");
Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");
String.prototype.parseStyle=function(){var a,b=$H();if(Prototype.Browser.WebKit)a=(new Element("div",{style:this})).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';a=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(c){a[c]&&b.set(c,a[c])});Prototype.Browser.IE&&this.include("opacity")&&b.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return b};
Element.getStyles=document.defaultView&&document.defaultView.getComputedStyle?function(a){var b=document.defaultView.getComputedStyle($(a),null);return Element.CSS_PROPERTIES.inject({},function(c,d){c[d]=b[d];return c})}:function(a){a=$(a);var b=a.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(d,e){d[e]=b[e];return d});if(!c.opacity)c.opacity=a.getOpacity();return c};
Effect.Methods={morph:function(a,b,c){a=$(a);new Effect.Morph(a,Object.extend({style:b},c||{}));return a},visualEffect:function(a,b,c){a=$(a);b=b.dasherize().camelize();b=b.charAt(0).toUpperCase()+b.substring(1);new Effect[b](a,c);return a},highlight:function(a,b){a=$(a);new Effect.Highlight(a,b);return a}};
$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(b,c){b=$(b);Effect[a.charAt(0).toUpperCase()+a.substring(1)](b,c);return b}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);
if(Object.isUndefined(Effect))throw"dragdrop.js requires including script.aculo.us' effects.js library";
var Droppables={drops:[],remove:function(a){this.drops=this.drops.reject(function(b){return b.element==$(a)})},add:function(a,b){a=$(a);var c=Object.extend({greedy:true,hoverclass:null,tree:false},b||{});if(c.containment){c._containers=[];b=c.containment;Object.isArray(b)?b.each(function(d){c._containers.push($(d))}):c._containers.push($(b))}if(c.accept)c.accept=[c.accept].flatten();Element.makePositioned(a);c.element=a;this.drops.push(c)},findDeepestChild:function(a){deepest=a[0];for(i=1;i<a.length;++i)if(Element.isParent(a[i].element,
deepest.element))deepest=a[i];return deepest},isContained:function(a,b){var c;c=b.tree?a.treeNode:a.parentNode;return b._containers.detect(function(d){return c==d})},isAffected:function(a,b,c){return c.element!=b&&(!c._containers||this.isContained(b,c))&&(!c.accept||Element.classNames(b).detect(function(d){return c.accept.include(d)}))&&Position.within(c.element,a[0],a[1])},deactivate:function(a){a.hoverclass&&Element.removeClassName(a.element,a.hoverclass);this.last_active=null},activate:function(a){a.hoverclass&&
Element.addClassName(a.element,a.hoverclass);this.last_active=a},show:function(a,b){if(this.drops.length){var c,d=[];this.drops.each(function(e){Droppables.isAffected(a,b,e)&&d.push(e)});if(d.length>0)c=Droppables.findDeepestChild(d);this.last_active&&this.last_active!=c&&this.deactivate(this.last_active);if(c){Position.within(c.element,a[0],a[1]);c.onHover&&c.onHover(b,c.element,Position.overlap(c.overlap,c.element));c!=this.last_active&&Droppables.activate(c)}}},fire:function(a,b){if(this.last_active){Position.prepare();
if(this.isAffected([Event.pointerX(a),Event.pointerY(a)],b,this.last_active))if(this.last_active.onDrop){this.last_active.onDrop(b,this.last_active.element,a);return true}}},reset:function(){this.last_active&&this.deactivate(this.last_active)}},Draggables={drags:[],observers:[],register:function(a){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);
Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress)}this.drags.push(a)},unregister:function(a){this.drags=this.drags.reject(function(b){return b==a});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress)}},activate:function(a){if(a.options.delay)this._timeout=
setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=a}.bind(this),a.options.delay);else{window.focus();this.activeDraggable=a}},deactivate:function(){this.activeDraggable=null},updateDrag:function(a){if(this.activeDraggable){var b=[Event.pointerX(a),Event.pointerY(a)];if(!(this._lastPointer&&this._lastPointer.inspect()==b.inspect())){this._lastPointer=b;this.activeDraggable.updateDrag(a,b)}}},endDrag:function(a){if(this._timeout){clearTimeout(this._timeout);this._timeout=
null}if(this.activeDraggable){this._lastPointer=null;this.activeDraggable.endDrag(a);this.activeDraggable=null}},keyPress:function(a){this.activeDraggable&&this.activeDraggable.keyPress(a)},addObserver:function(a){this.observers.push(a);this._cacheObserverCallbacks()},removeObserver:function(a){this.observers=this.observers.reject(function(b){return b.element==a});this._cacheObserverCallbacks()},notify:function(a,b,c){this[a+"Count"]>0&&this.observers.each(function(d){d[a]&&d[a](a,b,c)});b.options[a]&&
b.options[a](b,c)},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(a){Draggables[a+"Count"]=Draggables.observers.select(function(b){return b[a]}).length})}},Draggable=Class.create({initialize:function(a,b){var c={handle:false,reverteffect:function(d,e,f){var g=Math.sqrt(Math.abs(e^2)+Math.abs(f^2))*0.02;new Effect.Move(d,{x:-f,y:-e,duration:g,queue:{scope:"_draggable",position:"end"}})},endeffect:function(d){var e=Object.isNumber(d._opacity)?d._opacity:1;new Effect.Opacity(d,
{duration:0.2,from:0.7,to:e,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[d]=false}})},zindex:1E3,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!b||Object.isUndefined(b.endeffect))Object.extend(c,{starteffect:function(d){d._opacity=Element.getOpacity(d);Draggable._dragging[d]=true;new Effect.Opacity(d,{duration:0.2,from:d._opacity,to:0.7})}});b=Object.extend(c,b||{});this.element=$(a);if(b.handle&&Object.isString(b.handle))this.handle=
this.element.down("."+b.handle,0);if(!this.handle)this.handle=$(b.handle);if(!this.handle)this.handle=this.element;if(b.scroll&&!b.scroll.scrollTo&&!b.scroll.outerHTML){b.scroll=$(b.scroll);this._isScrollChild=Element.childOf(this.element,b.scroll)}Element.makePositioned(this.element);this.options=b;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,
"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return[parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]},initDrag:function(a){if(!(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]))if(Event.isLeftClick(a))if(!((tag_name=Event.element(a).tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA"))){var b=
[Event.pointerX(a),Event.pointerY(a)],c=this.element.cumulativeOffset();this.offset=[0,1].map(function(d){return b[d]-c[d]});Draggables.activate(this);Event.stop(a)}},startDrag:function(a){this.dragging=true;if(!this.delta)this.delta=this.currentDelta();if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex}if(this.options.ghosting){this._clone=this.element.cloneNode(true);(this._originallyAbsolute=this.element.getStyle("position")==
"absolute")||Position.absolutize(this.element);this.element.parentNode.insertBefore(this._clone,this.element)}if(this.options.scroll)if(this.options.scroll==window){var b=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=b.left;this.originalScrollTop=b.top}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop}Draggables.notify("onStart",this,a);this.options.starteffect&&this.options.starteffect(this.element)},updateDrag:function(a,
b){this.dragging||this.startDrag(a);if(!this.options.quiet){Position.prepare();Droppables.show(b,this.element)}Draggables.notify("onDrag",this,a);this.draw(b);this.options.change&&this.options.change(this);if(this.options.scroll){this.stopScrolling();var c;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll))c=[left,top,left+width,top+height];else{c=Position.page(this.options.scroll);c[0]+=this.options.scroll.scrollLeft+Position.deltaX;c[1]+=this.options.scroll.scrollTop+
Position.deltaY;c.push(c[0]+this.options.scroll.offsetWidth);c.push(c[1]+this.options.scroll.offsetHeight)}var d=[0,0];if(b[0]<c[0]+this.options.scrollSensitivity)d[0]=b[0]-(c[0]+this.options.scrollSensitivity);if(b[1]<c[1]+this.options.scrollSensitivity)d[1]=b[1]-(c[1]+this.options.scrollSensitivity);if(b[0]>c[2]-this.options.scrollSensitivity)d[0]=b[0]-(c[2]-this.options.scrollSensitivity);if(b[1]>c[3]-this.options.scrollSensitivity)d[1]=b[1]-(c[3]-this.options.scrollSensitivity);this.startScrolling(d)}Prototype.Browser.WebKit&&
window.scrollBy(0,0);Event.stop(a)},finishDrag:function(a,b){this.dragging=false;if(this.options.quiet){Position.prepare();var c=[Event.pointerX(a),Event.pointerY(a)];Droppables.show(c,this.element)}if(this.options.ghosting){this._originallyAbsolute||Position.relativize(this.element);delete this._originallyAbsolute;Element.remove(this._clone);this._clone=null}c=false;if(b)(c=Droppables.fire(a,this.element))||(c=false);c&&this.options.onDropped&&this.options.onDropped(this.element);Draggables.notify("onEnd",
this,a);if((a=this.options.revert)&&Object.isFunction(a))a=a(this.element);b=this.currentDelta();if(a&&this.options.reverteffect){if(c==0||a!="failure")this.options.reverteffect(this.element,b[1]-this.delta[1],b[0]-this.delta[0])}else this.delta=b;if(this.options.zindex)this.element.style.zIndex=this.originalZ;this.options.endeffect&&this.options.endeffect(this.element);Draggables.deactivate(this);Droppables.reset()},keyPress:function(a){if(a.keyCode==Event.KEY_ESC){this.finishDrag(a,false);Event.stop(a)}},
endDrag:function(a){if(this.dragging){this.stopScrolling();this.finishDrag(a,true);Event.stop(a)}},draw:function(a){var b=this.element.cumulativeOffset();if(this.options.ghosting){var c=Position.realOffset(this.element);b[0]+=c[0]-Position.deltaX;b[1]+=c[1]-Position.deltaY}c=this.currentDelta();b[0]-=c[0];b[1]-=c[1];if(this.options.scroll&&this.options.scroll!=window&&this._isScrollChild){b[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;b[1]-=this.options.scroll.scrollTop-this.originalScrollTop}c=
[0,1].map(function(e){return a[e]-b[e]-this.offset[e]}.bind(this));if(this.options.snap)c=Object.isFunction(this.options.snap)?this.options.snap(c[0],c[1],this):Object.isArray(this.options.snap)?c.map(function(e,f){return(e/this.options.snap[f]).round()*this.options.snap[f]}.bind(this)):c.map(function(e){return(e/this.options.snap).round()*this.options.snap}.bind(this));var d=this.element.style;if(!this.options.constraint||this.options.constraint=="horizontal")d.left=c[0]+"px";if(!this.options.constraint||
this.options.constraint=="vertical")d.top=c[1]+"px";if(d.visibility=="hidden")d.visibility=""},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null}},startScrolling:function(a){if(a[0]||a[1]){this.scrollSpeed=[a[0]*this.options.scrollSpeed,a[1]*this.options.scrollSpeed];this.lastScrolled=new Date;this.scrollInterval=setInterval(this.scroll.bind(this),10)}},scroll:function(){var a=new Date,b=a-this.lastScrolled;
this.lastScrolled=a;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){a=b/1E3;this.options.scroll.scrollTo(left+a*this.scrollSpeed[0],top+a*this.scrollSpeed[1])}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*b/1E3;this.options.scroll.scrollTop+=this.scrollSpeed[1]*b/1E3}Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=
Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*b/1E3;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*b/1E3;if(Draggables._lastScrollPointer[0]<0)Draggables._lastScrollPointer[0]=0;if(Draggables._lastScrollPointer[1]<0)Draggables._lastScrollPointer[1]=0;this.draw(Draggables._lastScrollPointer)}this.options.change&&this.options.change(this)},_getWindowScroll:function(a){var b,c,d;with(a.document){if(a.document.documentElement&&
documentElement.scrollTop){b=documentElement.scrollTop;c=documentElement.scrollLeft}else if(a.document.body){b=body.scrollTop;c=body.scrollLeft}if(a.innerWidth){d=a.innerWidth;a=a.innerHeight}else if(a.document.documentElement&&documentElement.clientWidth){d=documentElement.clientWidth;a=documentElement.clientHeight}else{d=body.offsetWidth;a=body.offsetHeight}}return{top:b,left:c,width:d,height:a}}});Draggable._dragging={};
var SortableObserver=Class.create({initialize:function(a,b){this.element=$(a);this.observer=b;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark();this.lastValue!=Sortable.serialize(this.element)&&this.observer(this.element)}}),Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(a){for(;a.tagName.toUpperCase()!="BODY";){if(a.id&&Sortable.sortables[a.id])return a;
a=a.parentNode}},options:function(a){if(a=Sortable._findRootElement($(a)))return Sortable.sortables[a.id]},destroy:function(a){a=$(a);if(a=Sortable.sortables[a.id]){Draggables.removeObserver(a.element);a.droppables.each(function(b){Droppables.remove(b)});a.draggables.invoke("destroy");delete Sortable.sortables[a.element.id]}},create:function(a,b){a=$(a);var c=Object.extend({element:a,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:a,handle:false,
only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},b||{});this.destroy(a);var d={revert:true,quiet:c.quiet,scroll:c.scroll,scrollSpeed:c.scrollSpeed,scrollSensitivity:c.scrollSensitivity,delay:c.delay,ghosting:c.ghosting,constraint:c.constraint,handle:c.handle};if(c.starteffect)d.starteffect=c.starteffect;if(c.reverteffect)d.reverteffect=
c.reverteffect;else if(c.ghosting)d.reverteffect=function(g){g.style.top=0;g.style.left=0};if(c.endeffect)d.endeffect=c.endeffect;if(c.zindex)d.zindex=c.zindex;var e={overlap:c.overlap,containment:c.containment,tree:c.tree,hoverclass:c.hoverclass,onHover:Sortable.onHover},f={onHover:Sortable.onEmptyHover,overlap:c.overlap,containment:c.containment,hoverclass:c.hoverclass};Element.cleanWhitespace(a);c.draggables=[];c.droppables=[];if(c.dropOnEmpty||c.tree){Droppables.add(a,f);c.droppables.push(a)}(c.elements||
this.findElements(a,c)||[]).each(function(g,k){k=c.handles?$(c.handles[k]):c.handle?$(g).select("."+c.handle)[0]:g;c.draggables.push(new Draggable(g,Object.extend(d,{handle:k})));Droppables.add(g,e);if(c.tree)g.treeNode=a;c.droppables.push(g)});if(c.tree)(Sortable.findTreeElements(a,c)||[]).each(function(g){Droppables.add(g,f);g.treeNode=a;c.droppables.push(g)});this.sortables[a.identify()]=c;Draggables.addObserver(new SortableObserver(a,c.onUpdate))},findElements:function(a,b){return Element.findChildren(a,
b.only,b.tree?true:false,b.tag)},findTreeElements:function(a,b){return Element.findChildren(a,b.only,b.tree?true:false,b.treeTag)},onHover:function(a,b,c){if(!Element.isParent(b,a))if(!(c>0.33&&c<0.66&&Sortable.options(b).tree))if(c>0.5){Sortable.mark(b,"before");if(b.previousSibling!=a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,b);b.parentNode!=c&&Sortable.options(c).onChange(a);Sortable.options(b.parentNode).onChange(a)}}else{Sortable.mark(b,"after");var d=b.nextSibling||
null;if(d!=a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,d);b.parentNode!=c&&Sortable.options(c).onChange(a);Sortable.options(b.parentNode).onChange(a)}}},onEmptyHover:function(a,b,c){var d=a.parentNode,e=Sortable.options(b);if(!Element.isParent(b,a)){var f=Sortable.findElements(b,{tag:e.tag,only:e.only}),g=null;if(f){var k=Element.offsetSize(b,e.overlap)*(1-c);for(c=0;c<f.length;c+=1)if(k-Element.offsetSize(f[c],e.overlap)>=0)k-=Element.offsetSize(f[c],e.overlap);else{g=
k-Element.offsetSize(f[c],e.overlap)/2>=0?c+1<f.length?f[c+1]:null:f[c];break}}b.insertBefore(a,g);Sortable.options(d).onChange(a);e.onChange(a)}},unmark:function(){Sortable._marker&&Sortable._marker.hide()},mark:function(a,b){var c=Sortable.options(a.parentNode);if(!(c&&!c.ghosting)){if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker)}var d=
a.cumulativeOffset();Sortable._marker.setStyle({left:d[0]+"px",top:d[1]+"px"});if(b=="after")c.overlap=="horizontal"?Sortable._marker.setStyle({left:d[0]+a.clientWidth+"px"}):Sortable._marker.setStyle({top:d[1]+a.clientHeight+"px"});Sortable._marker.show()}},_tree:function(a,b,c){for(var d=Sortable.findElements(a,b)||[],e=0;e<d.length;++e){var f=d[e].id.match(b.format);if(f){f={id:encodeURIComponent(f?f[1]:null),element:a,parent:c,children:[],position:c.children.length,container:$(d[e]).down(b.treeTag)};
f.container&&this._tree(f.container,b,f);c.children.push(f)}}return c},tree:function(a,b){a=$(a);var c=this.options(a);b=Object.extend({tag:c.tag,treeTag:c.treeTag,only:c.only,name:a.id,format:c.format},b||{});return Sortable._tree(a,b,{id:null,parent:null,children:[],container:a,position:0})},_constructIndex:function(a){var b="";do if(a.id)b="["+a.position+"]"+b;while((a=a.parent)!=null);return b},sequence:function(a,b){a=$(a);var c=Object.extend(this.options(a),b||{});return $(this.findElements(a,
c)||[]).map(function(d){return d.id.match(c.format)?d.id.match(c.format)[1]:""})},setSequence:function(a,b,c){a=$(a);var d=Object.extend(this.options(a),c||{}),e={};this.findElements(a,d).each(function(f){if(f.id.match(d.format))e[f.id.match(d.format)[1]]=[f,f.parentNode];f.parentNode.removeChild(f)});b.each(function(f){var g=e[f];if(g){g[1].appendChild(g[0]);delete e[f]}})},serialize:function(a,b){a=$(a);var c=Object.extend(Sortable.options(a),b||{}),d=encodeURIComponent(b&&b.name?b.name:a.id);return c.tree?
Sortable.tree(a,b).children.map(function(e){return[d+Sortable._constructIndex(e)+"[id]="+encodeURIComponent(e.id)].concat(e.children.map(arguments.callee))}).flatten().join("&"):Sortable.sequence(a,b).map(function(e){return d+"[]="+encodeURIComponent(e)}).join("&")}};Element.isParent=function(a,b){if(!a.parentNode||a==b)return false;if(a.parentNode==b)return true;return Element.isParent(a.parentNode,b)};
Element.findChildren=function(a,b,c,d){if(!a.hasChildNodes())return null;d=d.toUpperCase();if(b)b=[b].flatten();var e=[];$A(a.childNodes).each(function(f){if(f.tagName&&f.tagName.toUpperCase()==d&&(!b||Element.classNames(f).detect(function(g){return b.include(g)})))e.push(f);if(c)(f=Element.findChildren(f,b,c,d))&&e.push(f)});return e.length>0?e.flatten():[]};Element.offsetSize=function(a,b){return a["offset"+(b=="vertical"||b=="height"?"Height":"Width")]};
if(typeof Effect=="undefined")throw"controls.js requires including script.aculo.us' effects.js library";var Autocompleter={};
Autocompleter.Base=Class.create({baseInitialize:function(a,b,c){this.element=a=$(a);this.update=$(b);this.active=this.changed=this.hasFocus=false;this.entryCount=this.index=0;this.oldElementValue=this.element.value;if(this.setOptions)this.setOptions(c);else this.options=c||{};this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=
this.options.onShow||function(d,e){if(!e.style.position||e.style.position=="absolute"){e.style.position="absolute";Position.clone(d,e,{setHeight:false,offsetTop:d.offsetHeight})}Effect.Appear(e,{duration:0.15})};this.options.onHide=this.options.onHide||function(d,e){new Effect.Fade(e,{duration:0.15})};if(typeof this.options.tokens=="string")this.options.tokens=new Array(this.options.tokens);this.options.tokens.include("\n")||this.options.tokens.push("\n");this.observer=null;this.element.setAttribute("autocomplete",
"off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){Element.getStyle(this.update,"display")=="none"&&this.options.onShow(this.element,this.update);if(!this.iefix&&Prototype.Browser.IE&&Element.getStyle(this.update,"position")=="absolute"){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');
this.iefix=$(this.update.id+"_iefix")}this.iefix&&setTimeout(this.fixIEOverlapping.bind(this),50)},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:!this.update.style.height});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();Element.getStyle(this.update,"display")!="none"&&this.options.onHide(this.element,this.update);this.iefix&&Element.hide(this.iefix)},startIndicator:function(){this.options.indicator&&Element.show(this.options.indicator)},
stopIndicator:function(){this.options.indicator&&Element.hide(this.options.indicator)},onKeyPress:function(a){if(this.active)switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);return}else if(a.keyCode==Event.KEY_TAB||
a.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&a.keyCode==0)return;this.hasFocus=this.changed=true;this.observer&&clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1E3)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(a){var b=Event.findElement(a,"LI");if(this.index!=b.autocompleteIndex){this.index=b.autocompleteIndex;this.render()}Event.stop(a)},onClick:function(a){this.index=
Event.findElement(a,"LI").autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(){setTimeout(this.hide.bind(this),250);this.active=this.hasFocus=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++)this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected");if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0)this.index--;else this.index=
this.entryCount-1;this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1)this.index++;else this.index=0;this.getEntry(this.index).scrollIntoView(false)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(a){if(this.options.updateElement)this.options.updateElement(a);else{var b=
"";if(this.options.select){var c=$(a).select("."+this.options.select)||[];if(c.length>0)b=Element.collectTextNodes(c[0],this.options.select)}else b=Element.collectTextNodesIgnoreClass(a,"informal");c=this.getTokenBounds();if(c[0]!=-1){var d=this.element.value.substr(0,c[0]),e=this.element.value.substr(c[0]).match(/^\s+/);if(e)d+=e[0];this.element.value=d+b+this.element.value.substr(c[1])}else this.element.value=b;this.oldElementValue=this.element.value;this.element.focus();this.options.afterUpdateElement&&
this.options.afterUpdateElement(this.element,a)}},updateChoices:function(a){if(!this.changed&&this.hasFocus){this.update.innerHTML=a;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else this.entryCount=0;this.stopIndicator();this.index=0;if(this.entryCount==1&&
this.options.autoSelect){this.selectEntry();this.hide()}else this.render()}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars)this.getUpdatedChoices();else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();
return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var a=this.element.value;if(a.strip().empty())return[-1,0];for(var b=arguments.callee.getFirstDifferencePos(a,this.oldElementValue),c=b==this.oldElementValue.length?1:0,d=-1,e=a.length,f,g=0,k=this.options.tokens.length;g<k;++g){f=a.lastIndexOf(this.options.tokens[g],b+c-1);if(f>d)d=f;f=a.indexOf(this.options.tokens[g],b+c);if(-1!=f&&f<e)e=f}return this.tokenBounds=[d+
1,e]}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;++d)if(a[d]!=b[d])return d;return c};
Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=c},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams)this.options.parameters+=
"&"+this.options.defaultParams;new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});
Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){for(var c=[],d=[],e=b.getToken(),f=0;f<b.options.array.length&&c.length<b.options.choices;f++)for(var g=b.options.array[f],k=b.options.ignoreCase?
g.toLowerCase().indexOf(e.toLowerCase()):g.indexOf(e);k!=-1;){if(k==0&&g.length!=e.length){c.push("<li><strong>"+g.substr(0,e.length)+"</strong>"+g.substr(e.length)+"</li>");break}else if(e.length>=b.options.partialChars&&b.options.partialSearch&&k!=-1)if(b.options.fullSearch||/\s/.test(g.substr(k-1,1))){d.push("<li>"+g.substr(0,k)+"<strong>"+g.substr(k,e.length)+"</strong>"+g.substr(k+e.length)+"</li>");break}k=b.options.ignoreCase?g.toLowerCase().indexOf(e.toLowerCase(),k+1):g.indexOf(e,k+1)}if(d.length)c=
c.concat(d.slice(0,b.options.choices-c.length));return"<ul>"+c.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};
Ajax.InPlaceEditor=Class.create({initialize:function(a,b,c){this.url=b;this.element=a=$(a);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(c);Object.extend(this.options,c||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId))this.options.formId=""}if(this.options.externalControl)this.options.externalControl=$(this.options.externalControl);if(!this.options.externalControl)this.options.externalControlOnly=
false;this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(a){if(!(!this._editing||
a.ctrlKey||a.altKey||a.shiftKey))if(Event.KEY_ESC==a.keyCode)this.handleFormCancellation(a);else Event.KEY_RETURN==a.keyCode&&this.handleFormSubmission(a)},createControl:function(a,b,c){var d=this.options[a+"Control"];b=this.options[a+"Text"];if("button"==d){c=document.createElement("input");c.type="submit";c.value=b;c.className="editor_"+a+"_button";if("cancel"==a)c.onclick=this._boundCancelHandler;this._form.appendChild(c);this._controls[a]=c}else if("link"==d){d=document.createElement("a");d.href=
"#";d.appendChild(document.createTextNode(b));d.onclick="cancel"==a?this._boundCancelHandler:this._boundSubmitHandler;d.className="editor_"+a+"_link";if(c)d.className+=" "+c;this._form.appendChild(d);this._controls[a]=d}},createEditField:function(){var a=this.options.loadTextURL?this.options.loadingText:this.getText(),b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var c=this.options.size||this.options.cols||0;if(0<c)b.size=c}else{b=document.createElement("textarea");
b.rows=1>=this.options.rows?this.options.autoRows:this.options.rows;b.cols=this.options.cols||40}b.name=this.options.paramName;b.value=a;b.className="editor_field";if(this.options.submitOnBlur)b.onblur=this._boundSubmitHandler;this._controls.editor=b;this.options.loadTextURL&&this.loadExternalText();this._form.appendChild(this._controls.editor)},createForm:function(){function a(c,d){c=b.options["text"+c+"Controls"];!c||d===false||b._form.appendChild(document.createTextNode(c))}var b=this;this._form=
$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();"textarea"==this._controls.editor.tagName.toLowerCase()&&this._form.appendChild(document.createElement("br"));this.options.onFormCustomization&&this.options.onFormCustomization(this,this._form);a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",
this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML)this.element.innerHTML=this._oldInnerHTML;this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(!(this._saving||this._editing)){this._editing=true;this.triggerCallback("onEnterEditMode");this.options.externalControl&&this.options.externalControl.hide();
this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);this.options.loadTextURL||this.postProcessEditField();a&&Event.stop(a)}},enterHover:function(){this.options.hoverClassName&&this.element.addClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=
this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){this.wrapUp();a&&Event.stop(a)},handleFormSubmission:function(a){var b=this._form,c=$F(this._controls.editor);this.prepareSubmission();b=this.options.callback(b,c)||"";if(Object.isString(b))b=b.toQueryParams();b.editorId=this.element.id;if(this.options.htmlResponse){c=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});
new Ajax.Updater({success:this.element},this.url,c)}else{c=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,c)}a&&Event.stop(a)},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();this.options.externalControl&&this.options.externalControl.show();
this._editing=this._saving=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(){this.options.hoverClassName&&this.element.removeClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),
onComplete:Prototype.emptyFunction,onSuccess:function(b){this._form.removeClassName(this.options.loadingClassName);b=b.responseText;if(this.options.stripLoadedTextTags)b=b.stripTags();this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a)$(this._controls.editor)["focus"==a?"focus":"activate"]()},
prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=
a;this.options.externalControlOnly||this.element.observe(b.key,a);this.options.externalControl&&this.options.externalControl.observe(b.key,a)}.bind(this))},removeForm:function(){if(this._form){this._form.remove();this._form=null;this._controls={}}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(a,
b){"function"==typeof this.options[a]&&this.options[a](this,b)},unregisterListeners:function(){$H(this._listeners).each(function(a){this.options.externalControlOnly||this.element.stopObserving(a.key,a.value);this.options.externalControl&&this.options.externalControl.stopObserving(a.key,a.value)}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});
Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,b,c,d){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(b,c,d)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];this.options.loadCollectionURL?this.loadCollection():this.checkForExternalText();this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);
this.showLoadingText(this.options.loadingCollectionText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){b=b.responseText.strip();if(!/^\[.*\]$/.test(b))throw"Server returned an invalid collection representation.";this._collection=eval(b);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,a)},
showLoadingText:function(a){this._controls.editor.disabled=true;var b=this._controls.editor.firstChild;if(!b){b=document.createElement("option");b.value="";this._controls.editor.appendChild(b);b.selected=true}b.update((a||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();this.options.loadTextURL?this.loadExternalText():this.buildOptionList()},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);
Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(d){return 2===d.length?d:[d,d].flatten()});var a="value"in this.options?this.options.value:this._text,
b=this._collection.any(function(d){return d[0]==a}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(d,e){c=document.createElement("option");c.value=d[0];c.selected=b?d[0]==a:0==e;c.appendChild(document.createTextNode(d[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});
Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){function b(c,d){c in a||d===undefined||(a[c]=d)}if(a){b("cancelControl",a.cancelLink?"link":a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined);b("okControl",a.okLink?"link":a.okButton?"button":a.okLink==a.okButton==false?false:undefined);b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)}};
Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",
savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(a,b){new Effect.Highlight(b,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;a._effect&&a._effect.cancel()},onFailure:function(a){alert("Error communication with the server: "+
a.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};
Form.Element.DelayedObserver=Class.create({initialize:function(a,b,c){this.delay=b||0.5;this.element=$(a);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(){if(this.lastValue!=$F(this.element)){this.timer&&clearTimeout(this.timer);this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1E3);this.lastValue=$F(this.element)}},onTimerEvent:function(){this.timer=null;this.callback(this.element,
$F(this.element))}});if(!Control)var Control={};
Control.Slider=Class.create({initialize:function(a,b,c){var d=this;this.handles=Object.isArray(a)?a.collect(function(e){return $(e)}):[$(a)];this.track=$(b);this.options=c||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(e){return $(e)}):false;this.options.startSpan=
$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,
""):this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,"");this.disabled=this.dragging=this.active=false;this.options.disabled&&this.setDisabled();if(this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);
this.handles.each(function(e,f){f=d.handles.length-1-f;d.setValue(parseFloat((Object.isArray(d.options.sliderValue)?d.options.sliderValue[f]:d.options.sliderValue)||d.range.start),f);e.makePositioned().observe("mousedown",d.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true},dispose:function(){var a=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);
Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(b){Event.stopObserving(b,"mousedown",a.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(a){if(this.allowedValues){if(a>=this.allowedValues.max())return this.allowedValues.max();if(a<=this.allowedValues.min())return this.allowedValues.min();var b=Math.abs(this.allowedValues[0]-
a),c=this.allowedValues[0];this.allowedValues.each(function(d){var e=Math.abs(d-a);if(e<=b){c=d;b=e}});return c}if(a>this.range.end)return this.range.end;if(a<this.range.start)return this.range.start;return a},setValue:function(a,b){if(!this.active){this.activeHandleIdx=b||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles()}b=b||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if(b>0&&a<this.values[b-1])a=this.values[b-1];if(b<this.handles.length-1&&a>this.values[b+
1])a=this.values[b+1]}a=this.getNearestValue(a);this.values[b]=a;this.value=this.values[0];this.handles[b].style[this.isVertical()?"top":"left"]=this.translateToPx(a);this.drawSpans();if(!this.dragging||!this.event)this.updateFinished()},setValueBy:function(a,b){this.setValue(this.values[b||this.activeHandleIdx||0]+a,b||this.activeHandleIdx||0)},translateToPx:function(a){return Math.round((this.trackLength-this.handleLength)/(this.range.end-this.range.start)*(a-this.range.start))+"px"},translateToValue:function(a){return a/
(this.trackLength-this.handleLength)*(this.range.end-this.range.start)+this.range.start},getRange:function(a){var b=this.values.sortBy(Prototype.K);a=a||0;return $R(b[a],b[a+1])},minimumOffset:function(){return this.isVertical()?this.alignY:this.alignX},maximumOffset:function(){return this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-
this.alignX},isVertical:function(){return this.axis=="vertical"},drawSpans:function(){var a=this;this.spans&&$R(0,this.spans.length-1).each(function(b){a.setSpan(a.spans[b],a.getRange(b))});if(this.options.startSpan)this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value));if(this.options.endSpan)this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))},setSpan:function(a,b){if(this.isVertical()){a.style.top=
this.translateToPx(b.start);a.style.height=this.translateToPx(b.end-b.start+this.range.start)}else{a.style.left=this.translateToPx(b.start);a.style.width=this.translateToPx(b.end-b.start+this.range.start)}},updateStyles:function(){this.handles.each(function(a){Element.removeClassName(a,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(a){if(Event.isLeftClick(a)){if(!this.disabled){this.active=true;var b=Event.element(a),c=[Event.pointerX(a),Event.pointerY(a)];if(b==
this.track){b=this.track.cumulativeOffset();this.event=a;this.setValue(this.translateToValue((this.isVertical()?c[1]-b[1]:c[0]-b[0])-this.handleLength/2));b=this.activeHandle.cumulativeOffset();this.offsetX=c[0]-b[0];this.offsetY=c[1]-b[1]}else{for(;this.handles.indexOf(b)==-1&&b.parentNode;)b=b.parentNode;if(this.handles.indexOf(b)!=-1){this.activeHandle=b;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();b=this.activeHandle.cumulativeOffset();this.offsetX=c[0]-b[0];
this.offsetY=c[1]-b[1]}}}Event.stop(a)}},update:function(a){if(this.active){if(!this.dragging)this.dragging=true;this.draw(a);Prototype.Browser.WebKit&&window.scrollBy(0,0);Event.stop(a)}},draw:function(a){var b=[Event.pointerX(a),Event.pointerY(a)],c=this.track.cumulativeOffset();b[0]-=this.offsetX+c[0];b[1]-=this.offsetY+c[1];this.event=a;this.setValue(this.translateToValue(this.isVertical()?b[1]:b[0]));if(this.initialized&&this.options.onSlide)this.options.onSlide(this.values.length>1?this.values:
this.value,this)},endDrag:function(a){if(this.active&&this.dragging){this.finishDrag(a,true);Event.stop(a)}this.dragging=this.active=false},finishDrag:function(){this.dragging=this.active=false;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange)this.options.onChange(this.values.length>1?this.values:this.value,this);this.event=null}});
Sound={tracks:{},_enabled:true,template:new Template('<embed style="height:0" id="sound_#{track}_#{id}" src="#{url}" loop="false" autostart="true" hidden="true"/>'),enable:function(){Sound._enabled=true},disable:function(){Sound._enabled=false},play:function(a,b){if(Sound._enabled){var c=Object.extend({track:"global",url:a,replace:false},b||{});if(c.replace&&this.tracks[c.track]){$R(0,this.tracks[c.track].id).each(function(d){d=$("sound_"+c.track+"_"+d);d.Stop&&d.Stop();d.remove()});this.tracks[c.track]=
null}if(this.tracks[c.track])this.tracks[c.track].id++;else this.tracks[c.track]={id:0};c.id=this.tracks[c.track].id;$$("body")[0].insert(Prototype.Browser.IE?new Element("bgsound",{id:"sound_"+c.track+"_"+c.id,src:c.url,loop:1,autostart:true}):Sound.template.evaluate(c))}}};
if(Prototype.Browser.Gecko&&navigator.userAgent.indexOf("Win")>0)if(navigator.plugins&&$A(navigator.plugins).detect(function(a){return a.name.indexOf("QuickTime")!=-1}))Sound.template=new Template('<object id="sound_#{track}_#{id}" width="0" height="0" type="audio/mpeg" data="#{url}"/>');else if(navigator.plugins&&$A(navigator.plugins).detect(function(a){return a.name.indexOf("Windows Media")!=-1}))Sound.template=new Template('<object id="sound_#{track}_#{id}" type="application/x-mplayer2" data="#{url}"></object>');
else if(navigator.plugins&&$A(navigator.plugins).detect(function(a){return a.name.indexOf("RealPlayer")!=-1}))Sound.template=new Template('<embed type="audio/x-pn-realaudio-plugin" style="height:0" id="sound_#{track}_#{id}" src="#{url}" loop="false" autostart="true" hidden="true"/>');else Sound.play=function(){};var CropDraggable=Class.create();
Object.extend(Object.extend(CropDraggable.prototype,Draggable.prototype),{initialize:function(a,b){this.options=Object.extend({drawMethod:function(){}},b||{});this.handle=this.element=$(a);this.delta=this.currentDelta();this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},draw:function(a){var b=Position.cumulativeOffset(this.element),c=this.currentDelta();b[0]-=c[0];b[1]-=c[1];this.options.drawMethod([0,
1].map(function(d){return a[d]-b[d]-this.offset[d]}.bind(this)))}});var Cropper={};Cropper.Img=Class.create();
Cropper.Img.prototype={initialize:function(a,b,c,d){this.imageWidth=c;this.imageHeight=d;this.options=Object.extend({ratioDim:{x:0,y:0},minWidth:0,minHeight:0,displayOnInit:false,onEndCrop:Prototype.emptyFunction,captureKeys:true,onloadCoords:null,maxWidth:0,maxHeight:0},b||{});this.img=$(a);this.clickCoords={x:0,y:0};this.resizing=this.dragging=false;this.isWebKit=/Konqueror|Safari|KHTML/.test(navigator.userAgent);this.isIE=/MSIE/.test(navigator.userAgent);this.isOpera8=/Opera\s[1-8]/.test(navigator.userAgent);
this.ratioY=this.ratioX=0;this.attached=false;this.fixedWidth=this.options.maxWidth>0&&this.options.minWidth>=this.options.maxWidth;this.fixedHeight=this.options.maxHeight>0&&this.options.minHeight>=this.options.maxHeight;this.postOnLoad=this.options.postOnLoad;if(typeof this.img!="undefined"){$A(document.getElementsByTagName("script")).each(function(e){if(e.src.match(/cropper\.js/)){e=e.src.replace(/cropper\.js(.*)?/,"");var f=document.createElement("link");f.rel="stylesheet";f.type="text/css";f.href=
e+"cropper.css";f.media="screen";document.getElementsByTagName("head")[0].appendChild(f)}});if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){a=this.getGCD(this.options.ratioDim.x,this.options.ratioDim.y);this.ratioX=this.options.ratioDim.x/a;this.ratioY=this.options.ratioDim.y/a}this.subInitialize();this.img.onload=this.onLoad.bindAsEventListener(this)}},getGCD:function(a,b){if(b==0)return a;return this.getGCD(b,a%b)},onLoad:function(){var a=this.img.parentNode,b="";if(this.isOpera8)b=" opera8";
this.imgWrap=Builder.node("div",{"class":"imgCrop_wrap"+b});this.north=Builder.node("div",{"class":"imgCrop_overlay imgCrop_north"},[Builder.node("span")]);this.east=Builder.node("div",{"class":"imgCrop_overlay imgCrop_east"},[Builder.node("span")]);this.south=Builder.node("div",{"class":"imgCrop_overlay imgCrop_south"},[Builder.node("span")]);this.west=Builder.node("div",{"class":"imgCrop_overlay imgCrop_west"},[Builder.node("span")]);this.dragArea=Builder.node("div",{"class":"imgCrop_dragArea"},
[this.north,this.east,this.south,this.west]);this.handleN=Builder.node("div",{"class":"imgCrop_handle imgCrop_handleN"});this.handleNE=Builder.node("div",{"class":"imgCrop_handle imgCrop_handleNE"});this.handleE=Builder.node("div",{"class":"imgCrop_handle imgCrop_handleE"});this.handleSE=Builder.node("div",{"class":"imgCrop_handle imgCrop_handleSE"});this.handleS=Builder.node("div",{"class":"imgCrop_handle imgCrop_handleS"});this.handleSW=Builder.node("div",{"class":"imgCrop_handle imgCrop_handleSW"});
this.handleW=Builder.node("div",{"class":"imgCrop_handle imgCrop_handleW"});this.handleNW=Builder.node("div",{"class":"imgCrop_handle imgCrop_handleNW"});this.selArea=Builder.node("div",{"class":"imgCrop_selArea"},[Builder.node("div",{"class":"imgCrop_marqueeHoriz imgCrop_marqueeNorth"},[Builder.node("span")]),Builder.node("div",{"class":"imgCrop_marqueeVert imgCrop_marqueeEast"},[Builder.node("span")]),Builder.node("div",{"class":"imgCrop_marqueeHoriz imgCrop_marqueeSouth"},[Builder.node("span")]),
Builder.node("div",{"class":"imgCrop_marqueeVert imgCrop_marqueeWest"},[Builder.node("span")]),this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW,Builder.node("div",{"class":"imgCrop_clickArea"})]);this.imgWrap.appendChild(this.img);this.imgWrap.appendChild(this.dragArea);this.dragArea.appendChild(this.selArea);this.dragArea.appendChild(Builder.node("div",{"class":"imgCrop_clickArea"}));a.appendChild(this.imgWrap);this.startDragBind=this.startDrag.bindAsEventListener(this);
Event.observe(document,"mousedown",this.startDragBind);this.onDragBind=this.onDrag.bindAsEventListener(this);Event.observe(document,"mousemove",this.onDragBind);this.endCropBind=this.endCrop.bindAsEventListener(this);Event.observe(document,"mouseup",this.endCropBind);this.resizeBind=this.startResize.bindAsEventListener(this);this.handles=[this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW];this.registerHandles(true);if(this.options.captureKeys){this.keysBind=
this.handleKeys.bindAsEventListener(this);Event.observe(document,"keypress",this.keysBind)}new CropDraggable(this.selArea,{drawMethod:this.moveArea.bindAsEventListener(this)});this.setParams();this.dimWindow=Builder.node("div",{"class":"cropper-dim-window",style:"width: auto;height: auto; background: #000; color: #fff;position: absolute;"});this.dimWindow.hide();$(document.body).appendChild(this.dimWindow);this.postOnLoad()},registerHandles:function(a){for(var b=0;b<this.handles.length;b++){var c=
$(this.handles[b]);if(a){var d=false;if(this.fixedWidth&&this.fixedHeight)d=true;else if(this.fixedWidth||this.fixedHeight){var e=c.className.match(/([S|N][E|W])$/),f=c.className.match(/(E|W)$/),g=c.className.match(/(N|S)$/);if(e)d=true;else if(this.fixedWidth&&f)d=true;else if(this.fixedHeight&&g)d=true}d?c.hide():Event.observe(c,"mousedown",this.resizeBind)}else{c.show();Event.stopObserving(c,"mousedown",this.resizeBind)}}},setParams:function(){this.imgW=this.imageWidth;this.imgH=this.imageHeight;
$(this.north).setStyle({height:0});$(this.east).setStyle({width:0,height:0});$(this.south).setStyle({height:0});$(this.west).setStyle({width:0,height:0});$(this.imgWrap).setStyle({width:this.imgW+"px",height:this.imgH+"px"});$(this.selArea).hide();var a={x1:0,y1:0,x2:0,y2:0},b=false;if(this.options.onloadCoords!=null){a=this.cloneCoords(this.options.onloadCoords);b=true}else if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){a.x1=Math.ceil((this.imgW-this.options.ratioDim.x)/2);a.y1=Math.ceil((this.imgH-
this.options.ratioDim.y)/2);a.x2=a.x1+this.options.ratioDim.x;a.y2=a.y1+this.options.ratioDim.y;b=true}this.setAreaCoords(a,false,false,1);if(this.options.displayOnInit&&b){this.selArea.show();this.drawArea();this.endCrop()}this.attached=true},remove:function(){if(this.attached){this.attached=false;if(this.imgWrap.parentNode){this.imgWrap.parentNode.insertBefore(this.img,this.imgWrap);this.imgWrap.parentNode.removeChild(this.imgWrap)}Event.stopObserving(document,"mousedown",this.startDragBind);Event.stopObserving(document,
"mousemove",this.onDragBind);Event.stopObserving(document,"mouseup",this.endCropBind);this.registerHandles(false);this.options.captureKeys&&Event.stopObserving(document,"keypress",this.keysBind)}},reset:function(){this.attached?this.setParams():this.onLoad();this.endCrop()},handleKeys:function(a){var b={x:0,y:0};if(!this.dragging){switch(a.keyCode){case 37:b.x=-1;break;case 38:b.y=-1;break;case 39:b.x=1;break;case 40:b.y=1;break}if(b.x!=0||b.y!=0){if(a.shiftKey){b.x*=10;b.y*=10}this.moveArea([this.areaCoords.x1+
b.x,this.areaCoords.y1+b.y]);Event.stop(a)}}},calcW:function(){return this.areaCoords.x2-this.areaCoords.x1},calcH:function(){return this.areaCoords.y2-this.areaCoords.y1},moveArea:function(a){this.setAreaCoords({x1:a[0],y1:a[1],x2:a[0]+this.calcW(),y2:a[1]+this.calcH()},true,false);this.drawArea()},cloneCoords:function(a){return{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2}},setAreaCoords:function(a,b,c,d,e){if(b){c=a.x2-a.x1;d=a.y2-a.y1;if(a.x1<0){a.x1=0;a.x2=c}if(a.y1<0){a.y1=0;a.y2=d}if(a.x2>this.imgW){a.x2=
this.imgW;a.x1=this.imgW-c}if(a.y2>this.imgH){a.y2=this.imgH;a.y1=this.imgH-d}}else{if(a.x1<0)a.x1=0;if(a.y1<0)a.y1=0;if(a.x2>this.imgW)a.x2=this.imgW;if(a.y2>this.imgH)a.y2=this.imgH;if(d!=null){if(this.ratioX>0)this.applyRatio(a,{x:this.ratioX,y:this.ratioY},d,e);else c&&this.applyRatio(a,{x:1,y:1},d,e);b=[this.options.minWidth,this.options.minHeight];e=[this.options.maxWidth,this.options.maxHeight];if(b[0]>0||b[1]>0||e[0]>0||e[1]>0){var f={a1:a.x1,a2:a.x2};a={a1:a.y1,a2:a.y2};var g={min:0,max:this.imgW},
k={min:0,max:this.imgH};if((b[0]!=0||b[1]!=0)&&c)if(b[0]>0)b[1]=b[0];else if(b[1]>0)b[0]=b[1];if((e[0]!=0||e[0]!=0)&&c)if(e[0]>0&&e[0]<=e[1])e[1]=e[0];else if(e[1]>0&&e[1]<=e[0])e[0]=e[1];b[0]>0&&this.applyDimRestriction(f,b[0],d.x,g,"min");b[1]>1&&this.applyDimRestriction(a,b[1],d.y,k,"min");e[0]>0&&this.applyDimRestriction(f,e[0],d.x,g,"max");e[1]>1&&this.applyDimRestriction(a,e[1],d.y,k,"max");a={x1:f.a1,y1:a.a1,x2:f.a2,y2:a.a2}}}}this.areaCoords=a},applyDimRestriction:function(a,b,c,d,e){if(e==
"min"?a.a2-a.a1<b:a.a2-a.a1>b){if(c==1)a.a2=a.a1+b;else a.a1=a.a2-b;if(a.a1<d.min){a.a1=d.min;a.a2=b}else if(a.a2>d.max){a.a1=d.max-b;a.a2=d.max}}},applyRatio:function(a,b,c,d){if(d=="N"||d=="S"){b=this.applyRatioToAxis({a1:a.y1,b1:a.x1,a2:a.y2,b2:a.x2},{a:b.y,b:b.x},{a:c.y,b:c.x},{min:0,max:this.imgW});a.x1=b.b1;a.y1=b.a1;a.x2=b.b2;a.y2=b.a2}else{b=this.applyRatioToAxis({a1:a.x1,b1:a.y1,a2:a.x2,b2:a.y2},{a:b.x,b:b.y},{a:c.x,b:c.y},{min:0,max:this.imgH});a.x1=b.a1;a.y1=b.b1;a.x2=b.a2;a.y2=b.b2}},
applyRatioToAxis:function(a,b,c,d){a=Object.extend(a,{});var e=Math.floor((a.a2-a.a1)*b.b/b.a),f=null;if(c.b==1){e=a.b1+e;if(e>d.max){e=d.max;f=e-a.b1}a.b2=e}else{e=a.b2-e;if(e<d.min){e=d.min;f=e+a.b2}a.b1=e}if(f!=null){b=Math.floor(f*b.a/b.b);if(c.a==1)a.a2=a.a1+b;else a.a1=a.a1=a.a2-b}return a},setImageSize:function(a,b){var c=this.areaCoords.x1,d=this.areaCoords.x2,e=this.areaCoords.y1,f=this.areaCoords.y2;if(a<this.areaCoords.x2){c=this.areaCoords.x1-(this.areaCoords.x2-a);d=a}if(b<this.areaCoords.y2){e=
this.areaCoords.y1-(this.areaCoords.y2-b);f=b}this.imageWidth=a;this.imageHeight=b;this.imgW=a;this.imgH=b;this.setAreaCoords({x1:c,y1:e,x2:d,y2:f},false,false,null);this.imgWrap.setStyle("width: "+a+"px;height: "+b+"px;");this.drawArea()},drawArea:function(){var a=this.calcW(),b=this.calcH(),c=[this.areaCoords.x1+"px",this.areaCoords.y1+"px",a+"px",b+"px",this.areaCoords.x2+"px",this.areaCoords.y2+"px",this.imageWidth-this.areaCoords.x2+"px",this.imageHeight-this.areaCoords.y2+"px"],d=this.selArea.style;
d.left=c[0];d.top=c[1];d.width=c[2];d.height=c[3];a=Math.ceil((a-6)/2)+"px";b=Math.ceil((b-6)/2)+"px";this.handleN.style.left=a;this.handleE.style.top=b;this.handleS.style.left=a;this.handleW.style.top=b;this.north.style.height=c[1];b=this.east.style;b.top=c[1];b.height=c[3];b.left=c[4];b.width=c[6];b=this.south.style;b.top=c[5];b.height=c[7];b=this.west.style;b.top=c[1];b.height=c[3];b.width=c[0];this.subDrawArea();this.forceReRender()},forceReRender:function(){if(this.isIE||this.isWebKit){var a=
document.createTextNode(" "),b,c,d;if(this.isIE)fixEl=this.selArea;else if(this.isWebKit){fixEl=document.getElementsByClassName("imgCrop_marqueeSouth",this.imgWrap)[0];b=Builder.node("div","");b.style.visibility="hidden";var e=["SE","S","SW"];for(d=0;d<e.length;d++){c=document.getElementsByClassName("imgCrop_handle"+e[d],this.selArea)[0];c.childNodes.length&&c.removeChild(c.childNodes[0]);c.appendChild(b)}}fixEl.appendChild(a);fixEl.removeChild(a)}},startResize:function(a){this.startCoords=this.cloneCoords(this.areaCoords);
this.resizing=true;this.resizeHandle=Event.element(a).classNames().toString().replace(/([^N|NE|E|SE|S|SW|W|NW])+/,"");Event.stop(a)},startDrag:function(a){if(!(a.target!=null&&(a.target.nodeName=="input"||a.target.nodeName=="INPUT"))){this.clickCoords=this.getCurPos(a);this.getOffsets();var b=this.options.scrollWrapper?this.options.scrollWrapper.getWidth()-20:0,c=this.options.scrollWrapper?this.options.scrollWrapper.getHeight()-20:0,d=this.options.scrollWrapper.cumulativeOffset(),e=Event.pointerX(a),
f=Event.pointerY(a);if(e>d.left&&e<d.left+b&&f>d.top&&f<d.top+c){this.selArea.show();this.setAreaCoords({x1:this.clickCoords.x,y1:this.clickCoords.y,x2:this.clickCoords.x,y2:this.clickCoords.y},false,false,null);this.dragging=true;this.onDrag(a);Event.stop(a)}}},getCurPos:function(a){for(var b=this.imgWrap,c=Position.cumulativeOffset(b);b!=null&&b.nodeName!="BODY";){c[1]-=b.scrollTop||0;c[0]-=b.scrollLeft||0;b=b.parentNode}return curPos={x:Event.pointerX(a)-c[0],y:Event.pointerY(a)-c[1]}},getOffsets:function(){if(this.options.scrollWrapper)return offsets=
{x:this.options.scrollWrapper.scrollLeft,y:this.options.scrollWrapper.scrollTop};return offsets={x:0,y:0}},onDrag:function(a){if(this.dragging||this.resizing){var b=null,c=this.getCurPos(a),d=this.cloneCoords(this.areaCoords),e={x:1,y:1};if(this.dragging){if(c.x<this.clickCoords.x)e.x=-1;if(c.y<this.clickCoords.y)e.y=-1;this.transformCoords(c.x,this.clickCoords.x,d,"x");this.transformCoords(c.y,this.clickCoords.y,d,"y")}else if(this.resizing){b=this.resizeHandle;if(b.match(/E/)){this.transformCoords(c.x,
this.startCoords.x1,d,"x");if(c.x<this.startCoords.x1)e.x=-1}else if(b.match(/W/)){this.transformCoords(c.x,this.startCoords.x2,d,"x");if(c.x<this.startCoords.x2)e.x=-1}if(b.match(/N/)){this.transformCoords(c.y,this.startCoords.y2,d,"y");if(c.y<this.startCoords.y2)e.y=-1}else if(b.match(/S/)){this.transformCoords(c.y,this.startCoords.y1,d,"y");if(c.y<this.startCoords.y1)e.y=-1}}this.dimWindow.show();this.dimWindow.innerHTML=d.x2-d.x1+"x"+(d.y2-d.y1);this.dimWindow.setStyle("top: "+(Event.pointerY(a)-
this.dimWindow.getHeight()-5)+"px;left:"+(Event.pointerX(a)+5)+"px;z-index: 100000;");this.setAreaCoords(d,false,a.shiftKey,e,b);this.drawArea();Event.stop(a)}},transformCoords:function(a,b,c,d){var e=[a,b];a>b&&e.reverse();c[d+"1"]=e[0];c[d+"2"]=e[1]},endCrop:function(){this.resizing=this.dragging=false;this.options.onEndCrop(this.areaCoords,{width:this.calcW(),height:this.calcH()});this.dimWindow&&this.dimWindow.hide()},subInitialize:function(){},subDrawArea:function(){}};
Cropper.ImgWithPreview=Class.create();
Object.extend(Object.extend(Cropper.ImgWithPreview.prototype,Cropper.Img.prototype),{subInitialize:function(){this.hasPreviewImg=false;if(typeof this.options.previewWrap!="undefined"&&this.options.minWidth>0&&this.options.minHeight>0){this.previewWrap=$(this.options.previewWrap);this.previewImg=this.img.cloneNode(false);this.previewImg.id="imgCrop_"+this.previewImg.id;this.hasPreviewImg=this.options.displayOnInit=true;this.previewWrap.addClassName("imgCrop_previewWrap");this.previewWrap.setStyle({width:this.options.minWidth+
"px",height:this.options.minHeight+"px"});this.previewWrap.appendChild(this.previewImg)}},subDrawArea:function(){if(this.hasPreviewImg){var a=this.calcW(),b=this.calcH(),c={x:this.imgW/a,y:this.imgH/b};a={x:a/this.options.minWidth,y:b/this.options.minHeight};c={w:Math.ceil(this.options.minWidth*c.x)+"px",h:Math.ceil(this.options.minHeight*c.y)+"px",x:"-"+Math.ceil(this.areaCoords.x1/a.x)+"px",y:"-"+Math.ceil(this.areaCoords.y1/a.y)+"px"};a=this.previewImg.style;a.width=c.w;a.height=c.h;a.left=c.x;
a.top=c.y}}});
Protoload={timeUntilShow:250,opacity:0.8,startWaiting:function(a,b,c){if(typeof a=="string")a=document.getElementById(a);if(b==undefined)b="waiting";if(c==undefined)c=Protoload.timeUntilShow;a._waiting=true;if(!a._loading){var d=document.createElement("div");(a.offsetParent||document.body).appendChild(a._loading=d);d.style.position="absolute";try{d.style.opacity=Protoload.opacity}catch(e){}try{d.style.MozOpacity=Protoload.opacity}catch(f){}try{d.style.filter="alpha(opacity="+Math.round(Protoload.opacity*100)+
")"}catch(g){}try{d.style.KhtmlOpacity=Protoload.opacity}catch(k){}}a._loading.className=b;window.setTimeout(function(){if(this._waiting){var o=this.positionedOffset()[0],v=this.positionedOffset()[1],r=this.offsetWidth,q=this.offsetHeight,B=this._loading;B.style.left=o+"px";B.style.top=v+"px";B.style.width=r+"px";B.style.height=q+"px";B.style.display="inline"}}.bind(a),c)},stopWaiting:function(a){if(a._waiting){a._waiting=false;a._loading.parentNode.removeChild(a._loading);a._loading=null}}};
if(Prototype){Element.addMethods(Protoload);Object.extend(Element,Protoload)}
var _gaq=_gaq||[],BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(d)return a[b].identity}},
searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b!=-1)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,
subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],
dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();function isIE6(){return BrowserDetect.browser=="Explorer"&&BrowserDetect.version=="6"}function isIE7(){return BrowserDetect.browser=="Explorer"&&BrowserDetect.version=="7"}function isIEAny(){return BrowserDetect.browser=="Explorer"}
function isSafari(){return BrowserDetect.browser=="Safari"}
var TmcePlugin=Class.create({findEditor:function(){for(var a=$$("#edit-content-form .rich-text-area"),b=0;b<a.length;b++)if(tinyMCE.get(a[b].id)!=null)return tinyMCE.activeEditor},getEncodedData:function(a,b){a=a;if(a==null)a=$(b);this.title=a.getAttribute("data-title");this.okLabel=a.getAttribute("data-txt-ok");this.cancelLabel=a.getAttribute("data-txt-cancel");this.closeLabel=a.getAttribute("data-txt-close");this.confirmText=a.getAttribute("data-txt-confirm");this.width=a.getAttribute("data-width");
this.height=a.getAttribute("data-height");this.windowDescription=a.getAttribute("data-window-description");this.windowDescriptionWidth=a.getAttribute("data-bligoo-tooltip-width")}});
function drawFieldText(a,b,c,d,e,f,g){if(f==null)f=255;if(g==null)g=4;b=Builder.node("div",{"class":"form-item "+b});var k=Builder.node("span",{"class":"label"});k.appendChild(Builder.node("label",{},e));b.appendChild(k);b.appendChild(Builder.node("br"));b.appendChild(Builder.node("input",{"class":"text-field",value:d,id:c,name:"edit["+a+"]",maxlength:f,size:g,type:"text",autocomplete:"off"}));return b}
function drawFieldDimensions(a,b,c,d,e,f){if(f==null)f=4;var g=Builder.node("div",{"class":"form-item form-item-dimensions"}),k=Builder.node("span",{"class":"label"});k.appendChild(Builder.node("label",{},e));g.appendChild(k);g.appendChild(Builder.node("br"));g.appendChild(Builder.node("input",{value:c,"class":"dimension-field dimension-width",id:b,name:"edit["+a+"-width]",size:f,type:"text",autocomplete:"off"}));c=new Element("span");c.innerHTML="x";g.appendChild(c);g.appendChild(Builder.node("input",
{value:d,"class":"dimension-field dimension-height",id:b,name:"edit["+a+"-height]",size:f,type:"text",autocomplete:"off"}));return g}function enableTinyMCE(a){toggleDisplayElements("embed","none");toggleDisplayElements("object","none");tinymce.dom.Event.domLoaded=true;tinyMCE.execCommand("mceAddControl",false,a)}function toggleDisplayElements(a,b){a=document.getElementsByTagName(a);for(i=0;i<a.length;i++)$(a[i]).setStyle("style: "+b)}var blogId=0;
function tr(a){var b;new Ajax.Request("/bligoo/ajaxproxy",{method:"t",parameters:{key:a},asynchronous:false,onComplete:function(c){b=c.responseText}});return b}function customURLConverter(a,b,c){if(a.substring(0,7)!="http://"&&a.substring(0,7)!="mailto:"&&a.substring(0,8)!="https://"&&a.substring(0,6)!="ftp://"){index=a.indexOf("/");s=index>=0?a.substring(0,index):a;if(s.indexOf(".")>0)a="http://"+a}return a}Event.observe(window,"unload",function(){$$(".spinner-submit").each(function(a){a.enable()})});
function evalJSON(a){var b=$H();a=a.substr(1,a.length-2);myRE=new RegExp('"[^"]+"',"ig");results=a.match(myRE);if(results!=undefined)for(a=0;a<results.length;a+=2){var c=results[a+1].length,d=results[a].substr(1,results[a].length-2);c=results[a+1].substr(1,c-2);b[d]=c}return b}function decodeMsg(a){return unescape(a.replace(/\+/g," "))}function decodeHTML(a){return unescape(a.replace(/\+/g," "))}
function disableTinyMCE(a){if($(a))if(tinyMCE.get(a)){tinyMCE.execCommand("mceFocus",false,a);tinyMCE.execCommand("mceRemoveControl",false,a)}}
function saveHit(a,b,c,d){var e="",f="",g="";if(d==1){d=google.loader.ClientLocation;if(d!=null){if(d.address!=null){if(d.address.country_code!=null)e+=d.address.country_code;if(d.address.country!=null){if(e!="")e+="|";e+=d.address.country}if(d.address.region!=null){if(e!="")e+="|";e+=d.address.region}if(d.address.city!=null){if(e!="")e+="|";e+=d.address.city}}f=d.longitude;g=d.latitude}}a=new Ajax.Request("/bligoo/ajaxproxy",{method:"savehit",parameters:{path:a,userAdsType:b,queryString:c,longitude:f,
latitude:g,location:e}})}var pressed=0;function newContent(a){if(pressed==0){pressed=1;document.location.href=a}}function habilitaWordLimit(){var a=$("display-type");if(a!=null)a.value==3||a.value==4?$("word-limit").ancestors().first().show():$("word-limit").ancestors().first().hide()}function isEmail(a){if(a==null||a==""||a.strip()=="")return false;return/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a.strip())}
var CrossImage=Class.create({initialize:function(a,b,c){a.observe("mouseover",function(d){d.target.src="/static/images/bligoobar/delete-active.png"});a.observe("mouseout",function(d){d.target.src="/static/images/bligoobar/delete-inactive.png"});a.setStyle("cursor: pointer");a.src="/static/images/bligoobar/delete-inactive.png";b!=null&&Event.observe(a,"click",b.bindAsEventListener(this,c))}});
function urlParameter(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(window.location.href);if(a==null)return"";return a[1]}function set_cookie(a,b,c,d,e,f){var g=new Date;g.setTime(g.getTime());if(c)c=c*1E3*60*60*24;g=new Date(g.getTime()+c);document.cookie=a+"="+escape(b)+(c?";expires="+g.toGMTString():"")+(d?";path="+d:"")+(e?";domain="+e:"")+(f?";secure":"")}
function setCookie(a,b,c){var d=new Date;d.setDate(d.getDate()+c);document.cookie=a+"="+escape(b)+(c==null?"":";expires="+d.toGMTString())}function getCookie(a){if(document.cookie.length>0){c_start=document.cookie.indexOf(a+"=");if(c_start!=-1){c_start=c_start+a.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1)c_end=document.cookie.length;return unescape(document.cookie.substring(c_start,c_end))}}return""}
function get_cookie(a){var b=document.cookie.split(";"),c="",d="",e="";for(i=0;i<b.length;i++){c=b[i].split("=");d=c[0].replace(/^\s+|\s+$/g,"");if(d==a){if(c.length>1)e=unescape(c[1].replace(/^\s+|\s+$/g,""));return e}}return null}var SubmitStopperClass=new Class.create({initialize:function(a){$(a).stopObserving("keydown");$(a).observe("keydown",this.watch.bindAsEventListener(this))},watch:function(a){a.keyCode==13&&a.target.type!="textarea"&&a.stop()}});
isIE6()&&setInterval('document.fire("bligoo:updatefixed")',100);function displaySiteMessage(a,b){removeSiteMessage();var c="<div id='message-container'><div id='alerts' class='messages'><a name='alerts'/>";c+="<ul><li>"+a+"</li></ul>";c+="<div id='close-message'><a id='close-messages-link' href='javascript:void(0);'>"+b+"</a>";c+="</div></div>";$(document.body).insert({top:c});enableSiteMessageClose()}
function enableSiteMessageClose(){$("close-messages-link")!=null&&$("close-messages-link").observe("click",function(a){closeBligooMessages()})}function removeSiteMessage(){$("message-container")!=null&&$("message-container").remove()}function jsredirect(a){location.href=a}function callJSApi(a,b){var c;new Ajax.Request("/bligoo/apiproxy",{method:"jsAPI",parameters:$H({callback:a}).merge(b),asynchronous:false,onComplete:function(d){c=d.responseText}});return c}
function getTinyMCEConfig(a){var b={pagebreak_separator:"<!--break--\>",urlconverter_callback:"customURLConverter",relative_urls:false,theme:"advanced",theme_advanced_toolbar_location:"top",convert_urls:true,remove_linebreaks:false,valid_elements:"*[*]",font_size_style_values:"8pt,10pt,12pt,14pt,18pt,24pt,36pt",editor_selector:"bligoo-nb-rich-textarea",plugins:"safari,bligooimages,externalcode,youtube,vimeo,bligoofiles,pagebreak,flash,paste,fileupload",invalid_elements:"script,iframe",accessibility_focus:false,
strict_loading_mode:1,theme:"advanced",mode:"none",language:userLanguage};b=$H(b);if(a=="genericBar")return b.merge({width:"600",theme_advanced_buttons1:"link,|,bold,italic,strikethrough,fontsizeselect,|,justifyleft,justifycenter,justifyright,justifyfull,|,forecolor,bullist,numlist,code",theme_advanced_buttons2:"",theme_advanced_buttons3:""}).toObject();else if(a=="blidgets")return b.merge({width:"360",theme_advanced_buttons1:"link,|,bold,italic,strikethrough,fontsizeselect,|,bullist,numlist,code",
theme_advanced_buttons2:"justifyleft,justifycenter,justifyright,justifyfull,forecolor"+(mediaEnabled?",bligooimages,youtube,vimeo,flash,fileupload,externalcode":""),theme_advanced_buttons3:""}).toObject();else if(a=="headerAndFooter")return b.merge({width:"600",theme_advanced_buttons1:"link,|,bold,italic,strikethrough,fontsizeselect,|,bullist,numlist,code",theme_advanced_buttons2:"justifyleft,justifycenter,justifyright,justifyfull,forecolor"+(mediaEnabled?",bligooimages,youtube,vimeo,flash,externalcode":
""),theme_advanced_buttons3:"",handle_event_callback:"funcionHeaderFooterOnChange"}).toObject();else if(a=="genericWindow")return b.merge({width:"440",theme_advanced_buttons1:"link,|,bold,italic,strikethrough,fontsizeselect,|,justifyleft,justifycenter,justifyright,justifyfull,|,forecolor,bullist,numlist,code",theme_advanced_buttons2:"",theme_advanced_buttons3:""}).toObject();else if(a=="simple")return b.merge({width:"440",theme_advanced_buttons1:"link,|,bold,italic,strikethrough",theme_advanced_buttons2:"",
theme_advanced_toolbar_align:"left",theme_advanced_buttons3:""}).toObject()}function processFacebookResponse(){var a=window.location;a=a.substring(a.indexOf("code=")+5,a.indexOf("|"));alert(a)}
function preventTab(a){var b=a.target;if(a.keyCode==9||isSafari()&&a.keyCode==25){if(!a.stopPropagation){a.stopPropagation=function(){this.cancelBubble=true};a.preventDefault=function(){this.returnValue=false}}if(!a.stop)a.stop=function(){this.stopPropagation();this.preventDefault()};a.preventDefault();a.stopPropagation();a.stop();if(document.selection){b.focus();sel=document.selection.createRange();b=sel.text.length;sel.text="    ";sel.moveStart("character",-4+b)}else if(b.selectionStart||b.selectionStart==
"0"){a=b.selectionStart;var c=b.selectionEnd,d=b.scrollTop;b.value=b.value.substring(0,a)+"    "+b.value.substring(c,b.value.length);b.scrollTop=d;b.selectionStart=a+4;b.selectionEnd=a+4}else b.value+="    "}}
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b="",c,d,e,f,g,k,o=0;for(a=Base64._utf8_encode(a);o<a.length;){c=a.charCodeAt(o++);d=a.charCodeAt(o++);e=a.charCodeAt(o++);f=c>>2;c=(c&3)<<4|d>>4;g=(d&15)<<2|e>>6;k=e&63;if(isNaN(d))g=k=64;else if(isNaN(e))k=64;b=b+this._keyStr.charAt(f)+this._keyStr.charAt(c)+this._keyStr.charAt(g)+this._keyStr.charAt(k)}return b},decode:function(a){var b="",c,d,e,f,g,k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,
"");k<a.length;){c=this._keyStr.indexOf(a.charAt(k++));d=this._keyStr.indexOf(a.charAt(k++));f=this._keyStr.indexOf(a.charAt(k++));g=this._keyStr.indexOf(a.charAt(k++));c=c<<2|d>>4;d=(d&15)<<4|f>>2;e=(f&3)<<6|g;b+=String.fromCharCode(c);if(f!=64)b+=String.fromCharCode(d);if(g!=64)b+=String.fromCharCode(e)}return b=Base64._utf8_decode(b)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128)b+=String.fromCharCode(d);else{if(d>127&&d<2048)b+=
String.fromCharCode(d>>6|192);else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128)}b+=String.fromCharCode(d&63|128)}}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;){d=a.charCodeAt(c);if(d<128){b+=String.fromCharCode(d);c++}else if(d>191&&d<224){c2=a.charCodeAt(c+1);b+=String.fromCharCode((d&31)<<6|c2&63);c+=2}else{c2=a.charCodeAt(c+1);c3=a.charCodeAt(c+2);b+=String.fromCharCode((d&15)<<12|(c2&63)<<6|c3&63);c+=3}}return b}},TinyMCEEditArea=Class.create({initialize:function(a,
b,c,d,e){this.editor=a;this.parentNode=b;this.tr=e;this.editFunction=c;this.left=Event.pointerX(d);this.top=Event.pointerY(d);this.principalImageHidden=$("content-main-image");this.cleanOlderAreas();this.drawArea(e)},cleanOlderAreas:function(){var a=$$(".editor-object-edit-icon-wrapper");a!=null&&a.lenght>0&&a.each(function(b){b.remove()})},drawArea:function(a){var b=Element.cumulativeOffset(this.editor.getWin().frameElement),c=null;c=isIEAny()?Element.cumulativeScrollOffset(this.editor.getWin().frameElement):
Element.cumulativeScrollOffset(this.parentNode);this.floatingArea=Builder.node("div",{style:"position: absolute;top:"+(b.top+this.top-c.top-25)+"px; left:"+(b.left+this.left-c.left-22)+"px;","class":"editor-object-edit-icon-wrapper"});b=Builder.node("div",{"class":"editor-object-edit-icon use-editor-toolbar-sprite",title:a.edit});c=Builder.node("div",{"class":"editor-object-delete-icon use-editor-toolbar-sprite",title:a.remove});if(this.principalImageHidden!=null&&a.setmain!=null&&a.remmain!=null){var d=
this.parentNode.src;d=d.substring(d.lastIndexOf("/")+1);if(d.indexOf("?")>-1)d=d.substring(0,d.indexOf("?"));d=this.principalImageHidden.value==d?Builder.node("div",{"class":"editor-object-setprincipal-icon-used use-editor-toolbar-sprite",title:a.remmain}):Builder.node("div",{"class":"editor-object-setprincipal-icon-notused use-editor-toolbar-sprite",title:a.setmain})}this.floatingArea.appendChild(b);this.floatingArea.appendChild(c);this.principalImageHidden!=null&&d!=null&&this.floatingArea.appendChild(d);
b.observe("click",this.editNode.bindAsEventListener(this));c.observe("click",this.deleteNode.bindAsEventListener(this));this.principalImageHidden!=null&&d!=null&&d.observe("click",this.setPrincipalImage.bindAsEventListener(this,d));document.body.appendChild(this.floatingArea);this.iframe=null;this.iframe=this.editor.getWin().frameElement.contentDocument==null?this.editor.getWin().frameElement.contentWindow:this.editor.getWin().frameElement.contentDocument;Element.observe(this.iframe,"scroll",this.destroy.bind(this))},
setPrincipalImage:function(a,b){a=this.parentNode.src;a=a.substring(a.lastIndexOf("/")+1);if(a.indexOf("?")>-1)a=a.substring(0,a.indexOf("?"));if($("content-main-image").value==a){b.addClassName("editor-object-setprincipal-icon-notused");b.removeClassName("editor-object-setprincipal-icon-used");b.writeAttribute("title",this.tr.setmain);$("content-main-image").value=""}else{b.removeClassName("editor-object-setprincipal-icon-notused");b.addClassName("editor-object-setprincipal-icon-used");b.writeAttribute("title",
this.tr.remmain);$("content-main-image").value=a}},editNode:function(a){a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();this.editor.selection.select(this.parentNode);this.editFunction()},deleteNode:function(a){a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();this.editor.dom.remove(this.parentNode);this.editor.editorCommands.mceCleanup();this.remove()},destroy:function(){if(this.floatingArea!=null){this.remove();this.editor.editorCommands.mceCleanup()}},remove:function(){if(this.floatingArea!=
null){Element.stopObserving(this.iframe,"scroll");this.floatingArea.remove();this.floatingArea=null}}});
function formatTimeAgo(a){var b="",c="",d="",e="",f="",g="",k="",o="",v="",r="";if(userLanguage=="en"){b="";c="ago";d="seconds";e="second";f="minutes";g="minute";k="hours";o="hour";v="days";r="day"}else if(userLanguage=="pt"){b="";c="atras";e=d="segundo";f="minutos";g="minuto";k="horas";o="hora";v="dias";r="dia"}else{b=" hace";c="";d="segundos";e="segundo";f="minutos";g="minuto";k="horas";o="hora";v="dias";r="d&iacute;a"}a=(new Date).getTime()-a;b=b;if(a<6E4){a=parseInt(a/1E3);b+=" "+a+" "+(a>1?d:
e)}else if(a<36E5){a=parseInt(a/6E4);b+=" "+a+" "+(a>1?f:g)}else if(a<864E5){a=parseInt(a/36E5);b+=" "+a+" "+(a>1?k:o)}else{a=parseInt(a/864E5);b+=" "+a+" "+(a>1?v:r)}b+=" "+c;return b}var monthToNumbers=[];monthToNumbers.Jan=0;monthToNumbers.Feb=1;monthToNumbers.Mar=2;monthToNumbers.Apr=3;monthToNumbers.May=4;monthToNumbers.Jun=5;monthToNumbers.Jul=6;monthToNumbers.Aug=7;monthToNumbers.Sep=8;monthToNumbers.Oct=9;monthToNumbers.Nov=10;monthToNumbers.Dec=11;
var BligooPluginClass=Class.create({initialize:function(){}}),PluginManagerClass=Class.create({initialize:function(){this.plugins=[];document.observe("bligoobar:initialized",function(a){this.plugins.each(function(b){b.onBarInit&&b.onBarInit.bind(b)(a)})}.bind(this));document.observe("bligoobar:leaf-replaced",function(a){this.plugins.each(function(b){b.onBarLeafReplaced&&b.onBarLeafReplaced.bind(b)(a)})}.bind(this));document.observe("page:loaded",function(a){this.plugins.each(function(b){b.onPageLoaded&&
b.onPageLoaded.bind(b)(a)})}.bind(this));document.observe("dashboard:loaded",function(a){this.plugins.each(function(b){b.onDashboardLoaded&&b.onDashboardLoaded.bind(b)(a)})}.bind(this));document.observe("dashboard:page-changed",function(a){this.plugins.each(function(b){b.onDashboardPageChanged&&b.onDashboardPageChanged.bind(b)(a)})}.bind(this));document.observe("bligoowindow:content-replaced",function(a){this.plugins.each(function(b){b.onWindowContentReplaced&&b.onWindowContentReplaced.bind(b)(a)})}.bind(this));
document.observe("bligoowindow:content-setted",function(a){this.plugins.each(function(b){b.onWindowContentSetted&&b.onWindowContentSetted.bind(b)(a)})}.bind(this));document.observe("bligoo:file-uploaded",function(a){this.plugins.each(function(b){b.onFileUpload&&b.onFileUpload.bind(b)(a)})}.bind(this));document.observe("wizard-step:loaded",function(a){this.plugins.each(function(b){try{b.onWizardStepLoaded&&b.onWizardStepLoaded.bind(b)(a)}catch(c){console&&console.log(c)}})}.bind(this))},add:function(a){this.plugins[this.plugins.length]=
a},init:function(){this.plugins.each(function(a){a.init&&a.init()})}}),PluginManager=new PluginManagerClass;function closeBligooMessages(){Effect.BlindUp("message-container",{duration:0.5})}
function google_ad_request_done(a){var b="";if(a.length!=0){if(a[0].type=="flash")b+='<a href="'+google_info.feedback_url+'" class=google-ad-feedback>Ads by Google</a><br><object classid="clsid27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" WIDTH="'+google_ad.image_width+'" HEIGHT="'+google_ad.image_height+'"> <PARAM NAME="movie" VALUE="'+google_ad.image_url+'"><param name="wmode" value="transparent"><PARAM NAME="quality" VALUE="high"><PARAM NAME="AllowScriptAccess" VALUE="never"><EMBED wmode="transparent" src="'+
google_ad.image_url+'" WIDTH="'+google_ad.image_width+'" HEIGHT="'+google_ad.image_height+'" TYPE="application/x-shockwave-flash" AllowScriptAccess="never"  PLUGINSPAGE="http://www.macromedia.com/go/getflashplayer"></EMBED></OBJECT>';else if(a[0].type=="image")b+='<a href="'+google_info.feedback_url+'" class=google-ad-feedback>Ads by Google</a><br> <a href="'+a[0].url+'" target="_top" title="go to '+a[0].visible_url+'" onmouseout="window.status=\'\'" onmouseover="window.status=\'go to '+a[0].visible_url+
'\';return true"><img border="0" src="'+a[0].image_url+'"width="'+a[0].image_width+'"height="'+a[0].image_height+'"></a>';else if(a[0].type=="html")b+='<a href="'+google_info.feedback_url+'" class=google-ad-feedback>Ads by Google</a><br>'+a[0].snippet;else{for(b+='<a href="'+google_info.feedback_url+'" class=google-ad-feedback>Ads by Google</a><ul>';0<a.length;){b+='<li id=google-ad-link-item-0><a class=google-ad-link href="'+a[0].url+'" onmouseout="window.status=\'\'" onmouseover="window.status=\'ir a '+
a[0].visible_url+"';return true\"> <span class=google-ad-line1> "+a[0].line1+"</span></a> <span class=google-ad-line2>"+a[0].line2+""+a[0].line3+'</span> <a class=google-ad-line3 href="'+a[0].url+'" onmouseout="window.status=\'\'" onmouseover="window.status=\'ir a '+a[0].visible_url+"';return true\"><span>"+a[0].visible_url+"</span></a></li>";break}b+="</ul>"}document.write(b)}}
var SubmitSpinnerButton=Class.create({initialize:function(a){this.button=a;a.observe("click",this.click.bindAsEventListener(this))},click:function(){this.button.startWaiting("waiting",0)}}),CorePluginClass=Class.create(BligooPluginClass,{onWindowContentReplaced:function(a){this.initToggleCheckBoxes();var b=a.memo.window.select("input#bligoo-window-step-id")[0];if(b!=null){_gaq.push(["bligooTracker._trackEvent","bligoo-window","open:"+b.value]);_gaq.push(["bligooTracker._trackPageview","/window/"+
b.value])}else _gaq.push(["bligooTracker._trackEvent","bligoo-window","open:"+a.memo.name])},onWindowContentSetted:function(a){var b=a.memo.window.select("input#bligoo-window-step-id")[0];b!=null?_gaq.push(["bligooTracker._trackEvent","bligoo-window","open:"+b.value]):_gaq.push(["bligooTracker._trackEvent","bligoo-window","open:"+a.memo.name])},onBarLeafReplaced:function(a){_gaq.push(["bligooTracker._trackEvent","bligoo-bar","open:"+a.memo])},onPageLoaded:function(){$$(".spinner-button").each(function(b){b.observe("click",
b.startWaiting())});var a=$$(".bligoo-hint").first();a!=null&&new BligooTooltipClass($(a),a.getAttribute("bligooHintText"),{direction:BligooTooltipClass.VERTICAL,width:200});$("close-messages-link")!=null&&$("close-messages-link").observe("click",function(){closeBligooMessages()});$$(".spinner-submit").each(function(b){new SubmitSpinnerButton(b)});$("facebook-login")&&$("facebook-login").observe("click",function(){window.open("https://graph.facebook.com/oauth/authorize?client_id=135961833086048&redirect_uri=http://www.bligoo.com/user/fbcallback&type=user_agent&display=popup&scope=publish_stream,email,user_about_me,user_birthday,user_interests,user_location,user_photos,read_friendlists",
"facebook coonect","width=400,height=300")});this.positionAds()},positionAds:function(){if($("bligoo-ad-upper")&&$("bligoo-ad-image-1")){var a=$("bligoo-ad-image-1").getWidth(),b=$("bligoo-ad-upper").getWidth();if(a>0){b=$("bligoo-ad-upper").getWidth()-$("bligoo-ad-image-1").getWidth()-10;$("bligoo-ad-text-1").setStyle("margin-left: 10px; width: "+b+"px")}else{$("bligoo-ad-text-1").addClassName("bligoo-ad-text-full-size");$("bligoo-ad-text-1").select("#google-ad-link-item-4")[0]&&$("bligoo-ad-text-1").select("#google-ad-link-item-4")[0].remove();
$("bligoo-ad-text-1").select("#google-ad-link-item-3")[0]&&$("bligoo-ad-text-1").select("#google-ad-link-item-3")[0].remove()}if(b>90){b<235&&$("bligoo-ad-text-1").select("#google-ad-link-item-4")[0]&&$("bligoo-ad-text-1").select("#google-ad-link-item-4")[0].remove();b<190&&$("bligoo-ad-text-1").select("#google-ad-link-item-3")[0]&&$("bligoo-ad-text-1").select("#google-ad-link-item-3")[0].remove();b<135&&$("bligoo-ad-text-1").select("#google-ad-link-item-2")[0]&&$("bligoo-ad-text-1").select("#google-ad-link-item-2")[0].remove()}$("bligoo-ad-text-1").setStyle("display: block;")}},
initToggleCheckBoxes:function(){$$(".toggle-check").each(function(a){if(a.hasClassName("toggle-check-enable")){var b=a.id.substring(13),c="#"+b+" input";a.observe("click",function(){$$(c).each(function(d){d.checked=true})})}else if(a.hasClassName("toggle-check-disable")){b=a.id.substring(16);c="#"+b+" input";a.observe("click",function(){$$(c).each(function(d){d.checked=false})})}})},onWizardStepLoaded:function(){$("close-messages-link")!=null&&$("close-messages-link").observe("click",closeBligooMessages.bindAsEventListener(this))}});
PluginManager.add(new CorePluginClass);
var windowsZIndex=200,BligooWindow=Class.create({initialize:function(a,b){if(isIE6()){this.selects=[];var c=0;$$("select").each(function(d){if(d.visible()){this.selects[c]=d;c++;d.hide()}}.bind(this))}this.zIndex=windowsZIndex;windowsZIndex+=2;this.name=a;this.updateConfig(b);this.createWindow(a);this.setSize(b.width,b.height);this.callFirst();isIE6()&&Event.observe(window,"scroll",this.updatePosition.bindAsEventListener(this))},updateConfig:function(a){this.config=a;this.width=a.width;this.height=
a.height;this.encType=a.encType;this.target=a.target;this.action=a.action;this.showLogo=a.showLogo;this.help=a.help;this.cancelMessage=a.cancelMessage;if(this.config.parameters!=null)this.extraParameters=this.config.parameters},createWindow:function(){var a='<div class="bligoo-fixed-element glass-layer" id="glass-layer-'+this.name+'"></div><div class="bligoo-fixed-element bligoo-window-wrapper" id="bligoo-window-wrapper-'+this.name+'"><div class="bligoo-window" id="bligoo-window-'+this.name+'" style="-moz-border-radius: 8px; -webkit-border-radius: 8px;"><form id="bligoo-window-form-'+
this.name+'"'+(this.encType!=null?' enctype="'+this.encType+'"':"")+(this.target!=null?' target="'+this.target+'"':"")+(this.action!=null?' action="'+this.action+'" method="post"':"")+'><div class="bligoo-window-content" id="bligoo-window-content-'+this.name+'"></div></form></div>';$("bligoo-wrapper")!=null?$("bligoo-wrapper").insert(a):$(document.body).insert(a);this.content=$("bligoo-window-content-"+this.name);this.window=$("bligoo-window-"+this.name);this.form=$("bligoo-window-form-"+this.name);
this.glass=$("glass-layer-"+this.name);this.wrapper=$("bligoo-window-wrapper-"+this.name);this.glass.setStyle({zIndex:this.zIndex});this.wrapper.setStyle({zIndex:this.zIndex+1});this.setSpinner()},callFirst:function(){if(this.config.module&&this.config.first){var a=$H({method:"bligooWindow",module:this.config.module,next:this.config.first});if(this.config.parameters!=null){var b=$H(this.config.parameters);a=a.merge(b)}this.lastParams=a;new Ajax.Request("/bligoo/ajaxproxy",{parameters:a,onSuccess:this.process.bind(this),
onFailure:function(){alert("Ha ocurrido un error. Por favor intente mas tarde")}})}},submit:function(){this.form!=null&&this.form.submit()},setSpinner:function(){this.setContent('<div class="bligoo-window-spinner" id="bligoo-window-spinner-'+this.name+'"></div>');var a=$("bligoo-window-spinner-"+this.name);if(a!=null){var b=this.height?this.height:this.window.getHeight();a.setStyle({width:this.width+"px",height:b+"px"})}},process:function(a){if(a.responseText.indexOf("jump-to")>-1)document.location.href=
a.responseText.substring(8);else{if(this.config.skipScripts)this.content.innerHTML=a.responseText;else this.content.update(a.responseText);this.content.select("input.get-focus").each(function(o){o.focus()});this.content.fire("bligoowindow:content-replaced",this);this.enableEditors();new SubmitStopperClass("bligoo-window-form-"+this.name);if(this.windowConfig("redirect"))document.location.href=this.windowConfig("redirect").value;if(this.windowConfig("final")){this.close();if(this.config.finalFunction!=
null){this.config.finalFunction();return}}this.buttons=$$("#bligoo-window-content-"+this.name+" div.bligoo-window-buttons").first();this.toolbar=$$("#bligoo-window-content-"+this.name+" div.bligoo-window-buttons div.bligoo-window-buttons-toolbar").first();a=$$("#"+this.content.id+" .bligoo-button-next").first();var b=$$("#"+this.content.id+" .bligoo-window-skip-link");this.next=$$("#"+this.content.id+" .bligoo-window-config-next").first();this.module=$$("#"+this.content.id+" .bligoo-window-config-module").first();
var c=$$("#"+this.content.id+" .bligoo-button-back").first(),d=$$("#"+this.content.id+" .bligoo-window-config-back").first(),e=$$("#"+this.content.id+" .bligoo-window-config-back-module").first(),f=this.content.select(".bligoo-custom-button-next"),g=$$("#"+this.content.id+" .bligoo-button-close").first();g&&g.observe("click",this.closeWrapper.bind(this));if(b!=null&&b.length>0)if(this.next&&this.module){var k=this.callNext.bind(this,this.next.value,this.module.value);b.each(function(o){o.observe("click",
k)}.bind(this))}else{k=this.callFunction.bind(this);b.each(function(o){o.observe("click",k)}.bind(this))}if(a){a.stopObserving("click");a.onclick=this.next&&this.module?this.callNext.bind(this,this.next.value,this.module.value):this.callFunction.bind(this)}f.each(function(o){var v=o.getAttribute("data-next"),r=o.getAttribute("data-module");r!=null&&r!=""?o.observe("click",this.callNext.bind(this,v,r)):o.observe("click",this.callFunction.bind(this))}.bind(this));if(c&&d&&e){c.stopObserving("click");
c.show();c.observe("click",this.callNext.bind(this,d.value,e.value))}(a=$$("#"+this.content.id+" .bligoo-window-upper").first())&&a.setStyle({height:this.height-this.getDelta()+"px"});this.config.onComplete&&this.config.onComplete();(a=this.windowConfig("height"))&&parseInt(a.value)>0&&this.setSize(this.width,a.value);if(this.windowConfig("listen-oauth")){document.stopObserving("bligoo-oauth:reload-ok");document.stopObserving("bligoo-oauth:reload-fail");document.observe("bligoo-oauth:reload-ok",this.reload.bindAsEventListener(this));
document.observe("bligoo-oauth:reload-fail",this.oauthFail.bindAsEventListener(this))}}},reload:function(){this.triggerEditorsSave();this.disableEditors();this.setSpinner();new Ajax.Request("/bligoo/ajaxproxy",{parameters:this.lastParams,onSuccess:this.process.bind(this),onFailure:function(){alert("Ha ocurrido un error. Por favor intente mas tarde")}})},oauthFail:function(){alert(" :( ")},setTitle:function(a){var b=Builder.node("div",{"class":"bligoo-window-header"});b.appendChild(Builder.node("div",
{"class":"bligoo-window-header-title"},a));a=Builder.node("div",{"class":"use-editor-toolbar-sprite form-item-help"},this.help);var c=Builder.node("div",{"class":"form-item-help-wrapper"},a),d=(new Element("div")).addClassName("bligoo-window-header-help ");d.appendChild(c);a.hide();b.appendChild(d);this.showLogo&&b.appendChild(Builder.node("div",{"class":"bligoo-window-header-logo"}));$(this.content).insert({top:b});this.header=b},setHelp:function(a,b){var c=this.header.select(".form-item-help-wrapper .form-item-help").first();
if(c){if(b=="")b=100;new BligooTooltipClass(c,a,{width:b,direction:BligooTooltipClass.VERTICAL,type:"tooltip"});c.show()}},closeWrapper:function(){if(this.cancelMessage)if(!confirm(this.cancelMessage))return;this.close()},getDelta:function(){if(this.extraParameters!=null)if(this.extraParameters.delta!=null)return parseInt(this.extraParameters.delta);return 70},goNext:function(){this.next&&this.module&&this.callNext(this.next.value,this.module.value)},windowConfig:function(a){return $$("#"+this.content.id+
" .bligoo-window-config-"+a).first()},callFunction:function(){if(this.config.endFunction!=null){this.triggerEditorsSave();this.disableEditors();this.config.endFunction()}},callNext:function(a,b){this.triggerEditorsSave();this.disableEditors();var c=$H(this.form.serialize(true));this.lastParams=c=c.merge($H({method:"bligooWindow",module:b,next:a}));this.setSpinner();new Ajax.Request("/bligoo/ajaxproxy",{parameters:c,onSuccess:this.process.bind(this),onFailure:function(){alert("Ha ocurrido un error. Por favor intente mas tarde")}})},
enableEditors:function(){for(var a=$$("#"+this.content.id+" .rich-text-area"),b=0;b<a.length;b++){tinymce.dom.Event.domLoaded=true;if(a[b].hasClassName("window-rich-text-area")){tinyMCE.settings=a[b].getAttribute("editor-bar-type")!=null&&a[b].getAttribute("editor-bar-type")!=""?getTinyMCEConfig(a[b].getAttribute("editor-bar-type")):getTinyMCEConfig("genericWindow");if(a[b].getAttribute("editor-width")!=null&&a[b].getAttribute("editor-width")!="")tinyMCE.settings.width=a[b].getAttribute("editor-width");
if(a[b].getAttribute("editor-height")!=null&&a[b].getAttribute("editor-height")!="")tinyMCE.settings.height=a[b].getAttribute("editor-height")}else tinyMCE.settings=getTinyMCEConfig("blidgets");tinyMCE.execCommand("mceAddControl",false,a[b].id)}},disableEditors:function(){for(var a=$$("#"+this.content.id+" .rich-text-area"),b=0;b<a.length;b++)tinyMCE.get(a[b].id)!=null&&tinyMCE.execCommand("mceRemoveControl",false,a[b].id)},triggerEditorsSave:function(){$$("#"+this.content.id+" .rich-text-area").length>
0&&tinyMCE.triggerSave(true,true)},setSize:function(a,b){this.width=a;this.height=parseInt(b);if(this.height>document.viewport.getHeight())this.height=document.viewport.getHeight()-this.getDelta();this.glass.setStyle({top:"0px",left:"0px",position:"fixed",width:"100%",height:"100%",background:"#000000",opacity:0.2,zIndex:this.zIndex});var c=0;this.wrapper.select("#errors").each(function(e){c+=e.getHeight()});b=this.height+this.getDelta()+c;var d=b>document.viewport.getHeight()?document.viewport.getHeight()-
b-25:(document.viewport.getHeight()-b)/2;document.viewport.getWidth();this.wrapper.setStyle({width:"100%",height:b+"px",top:d+"px",left:"0px",position:"fixed",zIndex:this.zIndex+1});this.window.setStyle({width:a+"px",height:"auto",margin:"auto"});new Effect.Morph(this.window,{style:"width: "+a+"px;",duration:0.1,transition:Effect.Transitions.sinoidal});if(a=$$("#"+this.content.id+" .bligoo-window-upper").first())a.getAttribute("data-header-enabled")=="true"?a.setStyle({height:this.height-this.getDelta()+
"px"}):a.setStyle({height:this.height+"px"});this.content.setStyle({height:"auto"});isIE6()&&this.updatePosition()},setContent:function(a){this.content.update(a);this.content.fire("bligoowindow:content-setted",this)},addButton:function(a,b,c){isIE6()&&this.content.select("select").each(function(d){d.show()});if(!this.buttons){this.buttons=Builder.node("div",{id:"input-window-buttons","class":"bligoo-window-buttons clearfix"});this.content.appendChild(this.buttons)}this.buttons.insert('<div class="form-item"><input class="bligoo-window-button '+
(c?"bligoo-window-button-"+c:"")+' form-button" id="bligoo-window-button-'+this.name+"-"+a+'" type="button" value="'+b+'"></div>');return $("bligoo-window-button-"+this.name+"-"+a)},toggleButtons:function(){this.buttons.toggle()},hideButtons:function(){this.buttons.hide()},showButtons:function(){this.buttons.show()},close:function(){this.disableEditors();this.config.onClose&&this.config.onClose();this.destroy()},show:function(){this.wrapper.show();this.glass.show()},hideSelects:function(){$$("div#bligoo-panel-wrapper select").each(function(a){this.toggleSelect(a)}.bind(this));
$$("table#main select").each(function(a){this.toggleSelect(a)}.bind(this))},toggleSelect:function(a){if(a.visible()){a.addClassName("hidden-select");a.hide()}else{a.removeClassName("hidden-select");a.show()}},showSelects:function(){$$("select.select").each(function(a){this.toggleSelect(a)}.bind(this))},destroy:function(){this.wrapper&&this.wrapper.parentNode&&this.wrapper.remove();this.glass&&this.glass.parentNode&&this.glass.remove();isIE6()&&this.selects.each(function(a){a.show()}.bind(this))},
getFormContent:function(){return this.form.serialize()},getForm:function(){return this.form},updatePosition:function(){var a=document.viewport.getScrollOffsets();this.glass.absolutize();this.glass.setStyle({top:a[1]+"px",left:a[0]+"px",width:document.viewport.getWidth()+"px",height:document.viewport.getHeight()+"px"});this.wrapper.absolutize();var b=this.wrapper.getHeight();this.wrapper.setStyle({top:(b>document.viewport.getHeight()?a[1]+document.viewport.getHeight()-b-25:a[1]+(document.viewport.getHeight()-
b)/2)+"px",left:a[0]+"px",width:"100%",height:"100%"})},getToolbarArea:function(){return this.toolbar},addToolbarButton:function(a,b){this.toolbar.insert('<div class="form-item"><input class="bligoo-window-button form-button" id="bligoo-window-button-'+this.name+"-"+a+'" type="button" value="'+b+'"></div>');return $("bligoo-window-button-"+this.name+"-"+a)},addToolbarItem:function(a){this.toolbar.insert('<div class="form-item">'+a+"</div>")},getContent:function(){return this.content},getFrame:function(){return this.window}});
BligooWindow.BUTTON_TYPE_CANCEL="cancel";BligooWindow.BUTTON_TYPE_CLOSE="close";BligooWindow.BUTTON_TYPE_OK="ok";
var BligooWindowLink=Class.create({initialize:function(a){this.button=a;this.parameters={first:a.getAttribute("data-method"),module:a.getAttribute("data-module")};this.name=this.button.getAttribute("data-name");var b=parseInt(a.getAttribute("data-width")),c=parseInt(a.getAttribute("data-height"));if(b>0)this.parameters.width=b;if(c>0)this.parameters.height=c;if(a.getAttribute("data-parameters")!=null)this.parameters.parameters=a.getAttribute("data-parameters").evalJSON();if(a.getAttribute("bligooFormTarget")!=
null)this.parameters.target=a.getAttribute("bligooFormTarget");if(a.getAttribute("bligooEncType")!=null)this.parameters.encType=a.getAttribute("bligooEncType");if(a.getAttribute("bligooFormAction")!=null)this.parameters.action=a.getAttribute("bligooFormAction");if(a.getAttribute("data-end-function")!=null)this.parameters.endFunction=eval(a.getAttribute("data-end-function")+".bind(this)");if(a.getAttribute("data-final-function")!=null)this.parameters.finalFunction=eval(a.getAttribute("data-final-function")+
".bind(this)");a.observe("click",this.click.bindAsEventListener(this))},click:function(){this.window=new BligooWindow(this.name,this.parameters);this.window.show();BligooWindowLink.lastWindow=this.window}});BligooWindowLink.lastWindow=null;
var BligooInputWindow=Class.create({initialize:function(a,b){this.window=new BligooWindow(a,{width:b.width,height:b.height});this.windowContent=this.window.getContent();var c=Builder.node("div",{"class":"bligoo-window-header"});c.appendChild(Builder.node("div",{"class":"bligoo-window-header-title"},b.title));c.appendChild(Builder.node("div",{"class":"bligoo-window-header-logo"}));a=Builder.node("div",{id:"input-window-content"});a.appendChild(c);c=Builder.node("div",{"class":"bligoo-window-upper"},
b.message);this.onOkClick=b.onOkClick;this.input=Builder.node("input",{id:"data-input",name:"data-input",type:"text"});this.input.stopObserving("keydown");this.input.setStyle({width:"97%"});this.input.observe("keydown",this.testEnter.bindAsEventListener(this));c.appendChild(this.input);if(b.defaultInputVal!=null)this.input.value=b.defaultInputVal;a.appendChild(c);c=Builder.node("input",{value:b.okLabel,type:"button","class":"form-button"});var d=Builder.node("input",{value:b.cancelLabel,type:"button",
"class":"form-button"});c.observe("click",b.onOkClick);d.observe("click",b.onCancelClick);b=Builder.node("div",{id:"input-window-buttons","class":"bligoo-window-buttons clearfix"});b.appendChild(Builder.node("div",{"class":"form-item"},d));b.appendChild(Builder.node("div",{"class":"form-item"},c));a.appendChild(b);this.windowContent.update(a)},testEnter:function(a){if(a.keyCode==13){this.onOkClick();a.stop()}},getValue:function(){return this.input.value},destroy:function(){this.input=null;this.window!=
null&&this.window.destroy();this.window=null}}),BligooTooltipClass=Class.create();BligooTooltipClass.VERTICAL="vertical";BligooTooltipClass.HORIZONTAL="horizontal";BligooTooltipClass.FLOAT="float";
BligooTooltipClass.prototype={initialize:function(a,b,c){this.element=a;this.direction=c.direction?c.direction:BligooTooltipClass.VERTICAL;this.type=c.type;c=isNaN(c.width)?120:c.width;this.tooltip=(new Element("div")).addClassName("bligoo-tooltip");this.tooltip.setStyle("width: "+c+"px;");this.body=(new Element("div")).addClassName("bligoo-tooltip-body");this.body.update(b);this.tooltip.appendChild(this.body);this.tip=(new Element("div")).addClassName("bligoo-tooltip-tip").addClassName("bligoo-tooltip-tip-"+
this.direction);this.tooltip.appendChild(this.tip);if(this.direction==BligooTooltipClass.FLOAT)this.observingMove=false;if(this.type=="tooltip"){this.element.observe("mouseover",this.mouseOver.bindAsEventListener(this));this.element.observe("mouseout",this.mouseOut.bindAsEventListener(this));this.element.observe("mousemove",this.mouseMove.bindAsEventListener(this));this.tooltip.hide()}else this.element.observe("click",this.closeHint.bindAsEventListener(this));a.insert({after:this.tooltip});this.calculatePositions()},
mouseMove:function(a){if(this.observingMove==true){mouseX=Event.pointerX(a);mouseY=Event.pointerY(a);mouseX+=5;this.tooltip.setStyle({top:mouseY+"px",left:mouseX+"px"})}},mouseOut:function(){if(this.direction==BligooTooltipClass.FLOAT)this.observingMove=false;this.tooltip.hide()},mouseOver:function(){if(this.direction==BligooTooltipClass.FLOAT)this.observingMove=true;this.tooltip.show()},calculatePositions:function(){for(var a=this.element;a.getWidth()<1;)a=a.up();var b=a.positionedOffset(),c=0,d=
0,e=0,f=0;switch(this.direction){case BligooTooltipClass.VERTICAL:c=b.left+a.getWidth()/2-this.tooltip.getWidth()/2;d=b.top-this.tooltip.getHeight()-this.tip.getHeight()-7;e=this.tooltip.getWidth()/2-5;break;case BligooTooltipClass.LEFT:c=b.left+a.getWidth()+this.tip.getWidth();d=b.top+a.getHeight()/2-this.tooltip.getHeight()/2;f=this.tooltip.getHeight()/2-5;break;case BligooTooltipClass.FLOAT:c=b.left+a.getWidth()+this.tip.getWidth();d=b.top+a.getHeight()/2-this.tooltip.getHeight()/2;f=this.tooltip.getHeight()/
2-5;break}this.tooltip.setStyle({left:c+"px",top:d+"px"});this.tip.setStyle({backgroundPosition:e+"px "+f+"px"})},closeHint:function(){this.element.hasClassName("notify-close-hint")&&new Ajax.Request("/bligoo/ajaxproxy",{method:"notifyHintClose",parameters:{key:this.element.getAttribute("bligooHintKey")}});this.tooltip.remove()}};
var BligooTooltipPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){$$(".has-bligoo-tooltip").each(function(a){new BligooTooltipClass(a,a.getAttribute("data-bligoo-tooltip-text"),{width:a.getAttribute("data-bligoo-tooltip-width"),direction:a.getAttribute("data-bligoo-tooltip-direction"),type:"tooltip"})});$$(".form-item-help").each(function(a){new BligooTooltipClass(a,a.getAttribute("data-bligoo-tooltip-text"),{width:a.getAttribute("data-bligoo-tooltip-width"),direction:a.getAttribute("data-bligoo-tooltip-direction"),
type:"tooltip"})})},onDashboardLoaded:function(){$$(".has-bligoo-tooltip").each(function(a){new BligooTooltipClass(a,a.getAttribute("data-bligoo-tooltip-text"),{width:a.getAttribute("data-bligoo-tooltip-width"),direction:a.getAttribute("data-bligoo-tooltip-direction"),type:"tooltip"})});$$(".form-item-help").each(function(a){new BligooTooltipClass(a,a.getAttribute("data-bligoo-tooltip-text"),{width:a.getAttribute("data-bligoo-tooltip-width"),direction:a.getAttribute("data-bligoo-tooltip-direction"),
type:"tooltip"})})},onWindowContentReplaced:function(a){a.memo.window.select(".form-item-help").each(function(b){new BligooTooltipClass(b,b.getAttribute("data-bligoo-tooltip-text"),{width:b.getAttribute("data-bligoo-tooltip-width"),direction:b.getAttribute("data-bligoo-tooltip-direction"),type:"tooltip"})})}});PluginManager.add(new BligooTooltipPluginClass);
var BlocksPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){initMetaBlockTabs("");$$(".bligoo-block-placeholder").each(function(a){var b;a.classNames().each(function(d){if(d.indexOf("bligoo-block-id-")>-1)b=d.split("-")[3]});if(b){a=document.location.href;a=a.substring(a.indexOf("//")+2,a.length);a=a.substring(a.indexOf("/")+1,a.length);var c="";if(a.length>0)c=a;new Ajax.Request("/bligoo/ajaxproxy",{method:"getBligooBlock",parameters:{configId:b,path:c},onComplete:function(d){var e=
$("bligoo-placeholder-id-"+b);e.update(d.responseText);new BligooBlock(e.descendants().first())}})}});$$(".bligoo-block-pager").each(function(a){new BligooBlock(a)})}});PluginManager.add(new BlocksPluginClass);
function initMetaBlockTabs(a){$$(a+" .meta-block-tab").each(function(b){new HoverClass(b,"mouse-over");var c=parseInt(b.id.split("-")[3]);b.observe("click",function(){var d=b.ancestors()[3];d.setStyle("height: "+d.getHeight()+"px;");d.startWaiting("waiting",0);var e=d.id.split("-")[4];if(e){d.update('<div class="clear"></div><div class="meta-block-spinner"></div>');new Ajax.Request("/bligoo/ajaxproxy",{method:"getBligooBlock",parameters:{configId:e,index:c},onComplete:function(f){d.update(f.responseText);
d.stopWaiting();d.fire("bligooBox:reloaded");d.setStyle("height: auto;");f=d.descendants().first();f.fire("bligooblock:content-replaced",f);new BligooBlock(f);initMetaBlockTabs("#"+d.id)}})}})})}
var BligooBlock=Class.create({initialize:function(a){this.page=1;this.element=a;this.initPager();this.hideButtons();this.startObservers();this.element.observe("mouseover",this.showPager.bindAsEventListener(this))},initPager:function(){this.index=0;this.configId=this.element.id.split("-")[2];this.buttonUp=$$("#"+this.element.id+" .bligoo-pager-up").first();this.buttonDown=$$("#"+this.element.id+" .bligoo-pager-down").first();this.buttonUpDisabled=$$("#"+this.element.id+" .bligoo-pager-up-disabled").first();
this.buttonDownDisabled=$$("#"+this.element.id+" .bligoo-pager-down-disabled").first();this.upHandler=this.moveUp.bind(this);this.downHandler=this.moveDown.bind(this);this.content=$$("#"+this.element.id+" div.bligoo-block-page").first();var a=$$("#"+this.element.id+" div.meta-block-tab-selected").first();if(a!=null)this.index=parseInt(a.id.split("-")[3]);this.page2=$$("div#"+this.element.id+" div.bligoo-block-page-2").first();this.page2.classNames().each(function(b){if(b.indexOf("bligoo-block-page-count")>
-1)this.pageCount2=parseInt(b.split("-")[4])}.bind(this));this.content.classNames().each(function(b){if(b.indexOf("bligoo-block-page-count")>-1)this.pageCount=parseInt(b.split("-")[4]);else if(b.indexOf("bligoo-block-page-total")>-1)this.itemsPerPage=parseInt(b.split("-")[4])}.bind(this));this.pages={};this.pages[1]=this.content.innerHTML;if(this.pageCount2>0)this.pages[2]=this.page2.innerHTML;this.pagesLength={};this.pagesLength[1]=this.pageCount;this.pagesLength[2]=this.pageCount2;this.donePaging=
this.pageCount2<this.itemsPerPage},startObservers:function(){if(this.page>1){this.buttonUp.observe("click",this.upHandler);this.buttonUp.show();this.buttonUpDisabled.hide()}if(this.pages[this.page+1]!=null){this.buttonDown.observe("click",this.downHandler);this.buttonDown.show();this.buttonDownDisabled.hide()}if(this.buttonUp.visible()||this.buttonDown.visible()){this.buttonUp.visible()||this.buttonUpDisabled.show();this.buttonDown.visible()||this.buttonDownDisabled.show()}},hidePager:function(){this.element.select(".bligoo-block-updown-pager").each(function(a){Effect.Fade(a,
{duration:0.1})})},showPager:function(){this.element.select(".bligoo-block-updown-pager").each(function(a){Effect.Appear(a,{duration:0.1})});this.periodical&&this.periodical.stop();this.periodical=new PeriodicalExecuter(this.hidePager.bind(this),5)},stopObservers:function(){this.buttonUp.stopObserving("click",this.upHandler);this.buttonDown.stopObserving("click",this.downHandler);this.buttonUpDisabled.show();this.buttonDownDisabled.show();this.buttonUp.hide();this.buttonDown.hide()},hideButtons:function(){this.buttonUpDisabled.hide();
this.buttonDownDisabled.hide();this.buttonUp.hide();this.buttonDown.hide()},moveUp:function(){this.stopObservers();this.page--;this.updatePage();this.startObservers()},updatePage:function(){new Effect.Opacity(this.content.id,{from:1,to:0,duration:0.1,afterFinish:function(){this.content.update(this.pages[this.page]);this.content.fire("bligooBox:reloaded");new Effect.Opacity(this.content.id,{from:0,to:1,duration:0.1})}.bind(this)})},moveDown:function(){this.stopObservers();this.page++;this.updatePage();
this.donePaging?this.startObservers():this.getNextPage()},getNextPage:function(){new Ajax.Request("/bligoo/ajaxproxy",{method:"getBligooBlock",parameters:{configId:this.configId,ajaxPage:this.page+1,index:this.index},onComplete:this.onNextPageComplete.bind(this)})},onNextPageComplete:function(a){this.page2.update(a.responseText);a=this.page2.descendants().first();if(a!=null){var b=0;a.classNames().each(function(c){if(c.indexOf("bligoo-block-page-count")>-1)b=parseInt(c.split("-")[4])});if(b>0)this.pages[this.page+
1]=a.innerHTML;if(b<this.itemsPerPage)this.donePaging=false}this.startObservers()}}),FloatingObject=Class.create({initialize:function(a){this.element=a;this.queue="floating-object-"+this.element.id;if(this.element.hasClassName("float-far")){this.factor=8;this.offset=60}else if(this.element.hasClassName("float-medium")){this.factor=4;this.offset=30}else{this.factor=2;this.offset=10}this.position=this.element.hasClassName("float-left")?"left":"right";this.parent=$("layout-wrapper");Event.observe(window,
"resize",this.updatePosition.bind(this));this.updatePosition();this.element.show();this.originalTop=this.element.cumulativeOffset()[1];Event.observe(window,"scroll",this.scroll.bindAsEventListener(this))},scroll:function(){var a=this.originalTop-this.parent.cumulativeScrollOffset()[1]/this.factor;Effect.Queues.get(this.queue).each(function(b){b.cancel()});new Effect.Morph(this.element.id,{style:"top: "+a+"px;",mode:"relative",duration:5,queue:{position:"end",scope:this.queue}})},updatePosition:function(){this.position==
"left"?this.element.setStyle({left:this.parent.cumulativeOffset()[0]-this.element.getWidth()-this.offset+"px"}):this.element.setStyle({left:this.parent.cumulativeOffset()[0]+this.parent.getWidth()+this.offset+"px"})}}),EffectsPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){isIE6()||$("layout-wrapper")!=null&&$$(".floating-object").each(function(a){a.setStyle({position:"fixed"});new FloatingObject(a)})}});PluginManager.add(new EffectsPluginClass);var iSlideShow=new Class.create;
iSlideShow.prototype={initialize:function(a){this.wait=a.wait?a.wait:4E3;this.duration=a.duration?a.duration:0.5;this.container=a.container?a.container:"websites-images";this.imgWrapper=a.imgWrapper?a.imgWrapper:"websites-images-item";this.findSlides();this.start=0;this.counter=a.counter;this.caption=a.caption;this.iImageId=this.start;this.startSlideShow();$(this.container).observe("mouseover",this.stop.bind(this));$(this.container).observe("mouseout",function(){this.startSlideShow()}.bind(this))},
findSlides:function(){var a=$(this.container).select("."+this.imgWrapper);this.slides=[];for(var b=0;b<a.length;b++)this.slides[a.length-1-b]=a[b].id;this.numOfImages=this.slides.length},swapImage:function(a,b){$(this.slides[a])&&$(this.slides[a]).appear({duration:this.duration});$(this.slides[b])&&$(this.slides[b]).fade({duration:this.duration})},startSlideShow:function(){this.play2=setInterval(this.play.bind(this),this.wait)},play:function(){var a,b;a=this.iImageId+1;b=this.iImageId;if(a==this.numOfImages){this.swapImage(0,
b);this.iImageId=0}else{this.swapImage(a,b);this.iImageId++}this.textIn=this.iImageId+1+" of "+this.numOfImages;this.updatecounter(a==this.numOfImages?1:a+1,b+1)},stop:function(){clearInterval(this.play2)},goNext:function(){clearInterval(this.play2);var a,b;a=this.iImageId+1;b=this.iImageId;if(a==this.numOfImages){this.swapImage(0,b);this.iImageId=0}else{this.swapImage(a,b);this.iImageId++}this.updatecounter()},goPrevious:function(){clearInterval(this.play);var a,b;a=this.iImageId-1;b=this.iImageId;
if(this.iImageId==0){this.swapImage(this.numOfImages-1,b);this.iImageId=this.numOfImages-1}else{this.swapImage(a,b);this.iImageId--}this.updatecounter()},updatecounter:function(a,b){if($("dot-item-"+a)){$("dot-item-"+a).removeClassName("image-dot-inactive");$("dot-item-"+a).addClassName("image-dot-active")}if($("dot-item-"+b)){$("dot-item-"+b).removeClassName("image-dot-active");$("dot-item-"+b).addClassName("image-dot-inactive")}}};
var LimitedCheckeables=Class.create({initialize:function(a){this.element=a;this.counter=0;this.limit=this.element.getAttribute("data-limit");$$("#"+a.id+' input[type="checkbox"]').each(function(b){b.observe("click",this.updateCounter.bindAsEventListener(this,b))}.bind(this))},updateCounter:function(a,b){if(b.checked)this.counter++;else this.counter--;if(this.limit>0)this.counter>=this.limit?this.disableUnchecked():this.enableAll()},enableAll:function(){$$("#"+this.element.id+' input[type="checkbox"]').each(function(a){a.disabled=
false})},disableUnchecked:function(){$$("#"+this.element.id+' input[type="checkbox"]').each(function(a){if(!a.checked)a.disabled=true})}}),BarOptionsSubmitButton=Class.create({initialize:function(a){this.container=a;this.optionsContainer=a.select("div.options-button-container-options").first();this.button=a.select("input.form-button").first();this.hiddenVal=this.container.select("input.hidden-val").first();if(this.optionsContainer!=null){this.enableButton();this.enableOptions()}},enableButton:function(){this.button.observe("click",
this.toggleOptionsVisible.bind(this))},enableOptions:function(){var a=this.submitOption.bindAsEventListener(this);this.optionsContainer.select("div.options-button-container-options-option a").each(function(b){b.observe("click",a)}.bind(this))},submitOption:function(a){a=a.target.id.split("|");if(this.hiddenVal!=null)this.hiddenVal.value=a[1];BligooBar.openCallBack(a[0],{})},toggleOptionsVisible:function(){$$("div.options-button-container-options").each(function(a){a.visible()&&a.id!=this.optionsContainer.id&&
Effect.Fade(a,{duration:0.1})}.bind(this));this.optionsContainer.setStyle({position:"absolute",top:"-"+(this.optionsContainer.getHeight()+5)+"px",left:"3px"});this.optionsContainer.visible()?Effect.Fade(this.optionsContainer,{duration:0.1}):this.optionsContainer.show()}}),DropDownMenuClass=Class.create({initialize:function(a){this.element=a;this.menu=a.select(".dropdown-menu-content")[0];this.button=a.select(".dropdown-button")[0];this.menu.setStyle({position:"absolute",top:this.button.getHeight()+
"px",left:0,width:"200px",heigth:"300px"});this.button.observe("click",this.click.bindAsEventListener(this));this.button.observe("mouseover",this.mouseOver.bindAsEventListener(this));this.button.observe("mouseout",this.mouseOut.bindAsEventListener(this));this.menu.observe("click",function(b){b.target.nodeName!="A"&&b.stop()});document.observe("click",this.close.bindAsEventListener(this))},addClass:function(a,b){a.hasClassName(b)||a.addClassName(b)},removeClass:function(a,b){a.hasClassName(b)&&a.removeClassName(b)},
mouseOver:function(){this.addClass(this.button,"dropdown-button-over")},mouseOut:function(){this.removeClass(this.button,"dropdown-button-over")},click:function(){if(this.menu.visible()){Effect.Fade(this.menu,{duration:0.2});this.button.removeClassName("menu-pushed")}else{Effect.Appear(this.menu,{duration:0.2});this.button.addClassName("menu-pushed")}},close:function(){if(this.menu.visible()){Effect.Fade(this.menu,{duration:0.2});this.button.removeClassName("menu-pushed")}}}),HoverClass=Class.create({initialize:function(a,
b){this.clazz=b;this.element=a;this.element.observe("mouseover",this.mouseOver.bindAsEventListener(this));this.element.observe("mouseout",this.mouseOut.bindAsEventListener(this))},removeClass:function(a,b){a.hasClassName(b)&&a.removeClassName(b)},addClass:function(a,b){a.hasClassName(b)||a.addClassName(b)},mouseOver:function(){this.addClass(this.element,this.clazz)},mouseOut:function(){this.removeClass(this.element,this.clazz)}}),BligooTabbedPane=Class.create({initialize:function(a){this.item=a;this.tabs=
this.item.select(".bligoo-tabbed-tab");this.items=this.item.select(".bligoo-tabbed-item-wrapper");var b=this.click.bindAsEventListener(this);this.tabs.each(function(c){c.observe("click",b);new HoverClass(c,"bligoo-tabbed-tab-over")}.bind(this))},click:function(a){this.tabs.each(function(c){c.removeClassName("bligoo-tabbed-tab-selected")});a.target.addClassName("bligoo-tabbed-tab-selected");var b=a.target.getAttribute("data-item-id");this.items.each(function(c){c.hide()});this.items.each(function(c){c.id==
"bligoo-tabbed-item-wrapper-"+b&&c.show()})}}),PasswordCheckerClass=Class.create({initialize:function(a,b){if(a!=null&&b!=null){this.password1=a;this.password2=b;this.password1.observe("keyup",this.keyUp.bindAsEventListener(this));this.password2.observe("keyup",this.keyUp.bindAsEventListener(this))}},keyUp:function(){var a=this.password1.value,b=this.password2.value;if(a!=""&&b!="")a!=b?this.setInvalid():this.setValid();else this.clean()},clean:function(){this.password1.removeClassName("notvalid");
this.password1.removeClassName("valid");this.password2.removeClassName("notvalid");this.password2.removeClassName("valid")},setValid:function(){this.password2.removeClassName("notvalid");this.password2.addClassName("valid")},setInvalid:function(){this.password2.removeClassName("valid");this.password2.addClassName("notvalid")}}),LineNumberDisplayClass=Class.create({initialize:function(a,b){this.area=a;this.display=b;this.area.observe("keyup",this.helper.bind(this));this.area.observe("click",this.helper.bind(this));
this.display.update("0")},helper:function(){this.pe!=null&&pe.stop();pe=new PeriodicalExecuter(this.update.bind(this),1)},update:function(a){a.stop();this.updateLine()},reset:function(){this.display.update(1)},updateLine:function(){var a=this.area.value;a==null&&this.reset();for(var b=this.getCaret(this.area),c=0,d=0,e;d<a.length&&d<b;d++){e=a.charAt(d);if(e=="\n"||e=="\r")c++}this.display.update(c+1)},getCaret:function(a){if(a.selectionStart)return a.selectionStart;else if(document.selection){a.focus();
var b=document.selection.createRange();if(b==null)return 0;a=a.createTextRange();var c=a.duplicate();a.moveToBookmark(b.getBookmark());c.setEndPoint("EndToStart",a);return c.text.length}return 0}});function enableColorPicker(a){$$(a).each(function(b){var c={};if($(b.id+"-swatch")!=null)c={swatch:b.id+"-swatch"};var d=new Control.ColorPicker(b.id,c);$("button-enviar")!=null&&Event.observe($("button-enviar"),"click",function(e){d.isOpen&&d.close(e)})})}
var ReadMoreWidget=Class.create({initialize:function(a){this.element=$(a);a=this.element.getAttribute("data-seq");if(this.more=this.element.select("#display-more-more-"+a)[0]){this.less=this.element.select("#display-more-less-"+a)[0];this.less.observe("click",this.doLess.bindAsEventListener(this));this.more.observe("click",this.doMore.bindAsEventListener(this));this.display=this.element.select("#display-more-"+a)[0];this.teaser=this.element.select("#display-more-teaser-"+a)[0];this.body=this.element.select("#display-more-body-"+
a)[0]}},doMore:function(){this.display.getHeight();this.more.hide();this.display.update(this.body.innerHTML);this.less.show()},doLess:function(){this.less.hide();this.display.update(this.teaser.innerHTML);this.more.show()}}),ExampleTextInput=Class.create({initialize:function(a){this.button=a.select('input[type="button"]')[0];this.input=a.select('input[type="text"]')[0];this.input.addClassName("example-text-focused");this.button.disabled=true;this.text=this.input.value;this.input.observe("focus",this.focus.bindAsEventListener(this));
this.input.observe("blur",this.blur.bindAsEventListener(this))},focus:function(){if(this.button.disabled){this.input.value="";this.input.hasClassName("example-text-focused")&&this.input.removeClassName("example-text-focused");this.button.disabled=false}},blur:function(){if(this.input.value==null||this.input.value!=null&&this.input.value.strip()==""){this.button.disabled=true;this.input.value=this.text;this.input.hasClassName("example-text-focused")||this.input.addClassName("example-text-focused")}}}),
WidgetsPluginClass=Class.create(BligooPluginClass,{onBarLeafReplaced:function(){$$("div.options-button-container").each(function(a){new BarOptionsSubmitButton(a)})},onWindowContentReplaced:function(a){a.memo.window.select(".bligoo-tabbed-pane").each(function(b){new BligooTabbedPane(b)});$$(".limited-checkeables-inputs").each(function(b){new LimitedCheckeables(b)})},onPageLoaded:function(){$("bligoo-login-submit-button")!=null&&new HoverClass($("bligoo-login-submit-button"),"login-button-hover");$$(".dropdown-menu").each(function(a){new DropDownMenuClass(a)});
$$(".open-bligoo-window-link").each(function(a){new BligooWindowLink(a)});$$(".read-more-widget").each(function(a){new ReadMoreWidget(a)})},onDashboardLoaded:function(){$$(".open-bligoo-window-link").each(function(a){new BligooWindowLink(a)})},onDashboardPageChanged:function(){$$(".open-bligoo-window-link").each(function(a){new BligooWindowLink(a)})},onWizardStepLoaded:function(){$$(".bligoo-example-text-input").each(function(a){new ExampleTextInput(a)})}});PluginManager.add(new WidgetsPluginClass);
var BlidgetsPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){this.loadAjaxBlidgets()},loadAjaxBlidgets:function(){var a=$A(),b="";$$(".blidget-placeholder").each(function(c){a.push(c.getAttribute("data-id")+"|"+c.getAttribute("data-module")+"|"+c.getAttribute("data-name"));b=c.getAttribute("data-path")}.bind(this));a.length>0&&new Ajax.Request("/bligoo/ajaxproxy",{method:"getAjaxBlidgets",parameters:{ids:a,"ajax-path":b},onComplete:function(c){c.responseText.evalJSON().each(function(d){$("blidget-placeholder-"+
d.id).update(d.content)})}})}});PluginManager.add(new BlidgetsPluginClass);var AdsPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){$("advertising-explanation")!=null&&$("advertising-explanation").observe("click",function(){(new BligooWindow("ads-explanation",{first:"windowAdvertisingExplanation",module:"Ads",width:500,height:250})).show()})}});PluginManager.add(new AdsPluginClass);
function enableExtraInfoLink(a){$(a)!=null&&$(a).observe("click",function(b){(new BligooWindow("ads-explanation",{first:"windowAdvertisingHowToBuy",module:"Ads",width:500,height:250})).show()})}function enableMorePlansLink(a,b){$(a)!=null&&$(a).observe("click",function(c){$(b)!=null&&$(b).toggle()})}
var ImageEditor=Class.create({initialize:function(a,b,c,d,e,f,g){this.imageId=a;this.endFunction=b;this.imageWidth=c;this.imageHeight=d;this.imageUrl=e;this.imageType=f;this.isWaiting=false;this.params=Object.extend({recWidth:470,recHeight:1E3,maxWidth:c,maxHeight:d,minWidth:20,minHeight:20},g||{});this.createBligooWindow()},createBligooWindow:function(){this.window=new BligooWindow("image-editor",{first:"windowImageEditor",module:"ImageUpload",parameters:{imageUrl:this.imageUrl,imageType:this.imageType,
recWidth:this.params.recWidth,recHeight:this.params.recHeight},onComplete:this.initTools.bind(this),finalFunction:this.afterSaveImage.bind(this),width:600,height:400})},initTools:function(){this.startPageUpdater();this.imageEditorContainer=$("image-editor-outer-container");this.resizer=new ResizeTool(this.imageId,this.window,this);this.postOnLoad=this.resizer.setPreferredWidth.bind(this.resizer,this.params.recWidth);this.selectionTool=new SelectionTool(this.imageId,this.window,this);this.saveButton=
$("image-editor-button-save");this.saveButton!=null&&this.saveButton.observe("click",this.saveImage.bind(this));this.cancel=$$("#bligoo-window-content-image-editor .bligoo-button-close").first();this.cancel!=null&&this.cancel.observe("click",this.onBeforeClose.bindAsEventListener(this));this.image=$("image-for-edit");if(this.imageWidth==0)this.imageWidth=this.image.getWidth();if(this.imageHeight==0)this.imageHeight=this.image.getHeight()},onBeforeClose:function(){this.endPeriodical();this.selectionTool.onBeforeClose();
this.resizer.onBeforeClose()},stopSpinner:function(){this.imageEditorContainer.stopWaiting()},startSpinner:function(){this.imageEditorContainer.startWaiting("bigBlackWaiting")},recreateImage:function(a){this.selectionTool!=null&&this.selectionTool.cleanAll();this.resizer!=null&&this.resizer.cleanAll();a="<img src='"+a+"?v="+(new Date).valueOf()+"' id='image-for-edit'/>";$("image-editor-container").update(a);this.image=$("image-for-edit")},setImageDirty:function(a){if(a.width!=null&&a.width>0)this.imageWidth=
a.width;if(a.height!=null&&a.height>0)this.imageHeight=a.height;this.selectionTool.update(a);this.resizer.update(a);this.stopSpinner()},cleanImgSrc:function(a){return a.split("?")[0]},afterSaveImage:function(){this.onBeforeClose();this.endFunction!=null&&this.endFunction()},startPageUpdater:function(){if(this.periodical==null){this.periodical=new PeriodicalExecuter(this.scrollMainWindow.bind(this),1);var a=$$("#"+this.window.content.id+" .bligoo-button-close").first();a!=null&&a.observe("click",this.endPeriodical.bind(this))}},
scrollMainWindow:function(){this.selectionTool!=null&&$(document.body).scrollTo()},endPeriodical:function(){this.periodical!=null&&this.periodical.stop()}}),SelectionTool=Class.create({initialize:function(a,b,c){this.window=b;this.imageId=a;this.editor=c;this.image=$(a);this.imageSrc=this.image.src;this.selectAllButton=$("image-editor-selection-tool-maximize-button");this.restoreSelectionButton=$("image-editor-selection-tool-restore-button");this.x1=$("image-editor-selection-tool-x1");this.y1=$("image-editor-selection-tool-y1");
this.x2=$("image-editor-selection-tool-x2");this.y2=$("image-editor-selection-tool-y2");(this.selectAllLink=$("bligoo-image-editor-select-all-link"))&&this.selectAllLink.observe("click",this.selectAll.bind(this));this.enableCropper();this.selectAllButton&&this.selectAllButton.observe("click",this.selectAll.bind(this));this.restoreSelectionButton&&this.restoreSelectionButton.observe("click",this.restoreRecommendedSelection.bind(this))},selectAll:function(){this.cropper.setAreaCoords({x1:0,y1:0,x2:this.editor.imageWidth,
y2:this.editor.imageHeight},false,false,null);this.cropper.drawArea()},restoreRecommendedSelection:function(){this.cropper.setAreaCoords({x1:0,y1:0,x2:this.editor.params.recWidth,y2:this.editor.params.recHeight},false,false,null);this.cropper.drawArea()},enableCropper:function(){this.cropper&&this.cropper.remove();this.cropper=new Cropper.Img(this.imageId,{onEndCrop:this.onEndCrop.bind(this),scrollWrapper:this.editor.imageEditorContainer,onloadCoords:{x1:0,y1:0,x2:this.editor.params.recWidth,y2:this.editor.params.recHeight},
minWidth:this.editor.params.minWidth,minHeight:this.editor.params.minHeight,maxWidth:this.editor.params.maxWidth,maxHeight:this.editor.params.maxHeight,displayOnInit:true,postOnLoad:this.editor.postOnLoad},this.editor.imageWidth,this.editor.imageHeight)},onEndCrop:function(a,b){this.x1.value=a.x1;this.y1.value=a.y1;this.x2.value=a.x2;this.y2.value=a.y2;this.width=b.width;this.height=b.height},cleanAll:function(){this.cropper!=null&&this.cropper.remove()},update:function(a){a.preview?this.cropper.setImageSize(a.width,
a.height):this.enableCropper()},onBeforeClose:function(){this.cropper!=null&&this.cropper.remove()}}),ResizeTool=Class.create({initialize:function(a,b,c){this.window=b;this.imageId=a;this.editor=c;this.image=$(a);this.slider=null;this.imageSrc=this.image.src;this.imageRatio=true;this.resizeWidth=$("image-editor-resizer-tool-width");this.resizeHeight=$("image-editor-resizer-tool-height");this.resizeWidth.value=this.editor.imageWidth;this.originalHeight=this.resizeHeight.value=this.editor.imageHeight;
this.originalWidth=this.editor.imageWidth;this.originalAspectRatio=this.originalWidth/this.originalHeight;this.resizeToolArea=$("image-editor-resizer-tool");this.resizeToolAreaSlider=$("resize-tool-slider");this.minSliderVal=this.editor.imageWidth<this.editor.imageHeight?this.editor.params.minWidth:Math.ceil(this.editor.params.minWidth/(this.editor.imageHeight/this.editor.imageWidth));this.addSlider();this.enableImageRatioFunctions()},addSlider:function(){if(!this.slider){this.slider=Builder.node("div",
{id:"resizer-tool-id",style:"width: 140px; height: 9px; background: transparent url(/static/images/slider-images-track-right.png) no-repeat scroll right top;float:left;margin-top:9px;margin-right:5px;"});this.slider.appendChild(Builder.node("div",{id:"resizer-tool-id-left"}));var a=Builder.node("div",{id:"resizer-tool-id-handle","class":"selected",style:"width: 19px; height: 20px; left: 0px; position: relative;"});a.appendChild(Builder.node("img",{style:"float: left;",alt:"",src:"/static/images/slider-images-handle.png"}));
this.slider.appendChild(a);this.resizeToolAreaSlider.insert({top:this.slider});this.sliderControl=new Control.Slider("resizer-tool-id-handle","resizer-tool-id",{onSlide:function(b){this.scalePreview(b)}.bind(this),range:$R(this.minSliderVal,this.editor.imageWidth),values:$R(this.minSliderVal,this.editor.imageWidth),sliderValue:this.editor.imageWidth,increment:1})}},setPreferredWidth:function(a){if(a<this.originalWidth){this.resizeWidth.value=a;this.scalePreview(this.resizeWidth.value,0)}},scalePreview:function(a,
b){if(a==0)a=Math.ceil(b*this.image.getWidth()/this.image.getHeight());if(a<this.minSliderVal)a=this.minSliderVal;this.sliderControl.setValue(a);this.image.setStyle("width: "+a+"px;");b=this.image.getHeight();this.resizeWidth.value=a;this.resizeHeight.value=b;this.editor.setImageDirty({width:a,height:b,preview:true})},onBeforeClose:function(){},enableImageRatioFunctions:function(){this.resizeWidth.observe("blur",this.adjustImageHeight.bind(this));this.resizeHeight.observe("blur",this.adjustImageWidth.bind(this));
this.resizeWidth.observe("keydown",this.adjustImageHeightKey.bind(this));this.resizeHeight.observe("keydown",this.adjustImageHeightKey.bind(this))},adjustImageHeightKey:function(a){a.keyCode==13&&this.adjustImageHeight()},adjustImageWidthKey:function(a){a.keyCode==13&&this.adjustImageWidth()},adjustImageHeight:function(){if(parseInt(this.resizeWidth.value)>parseInt(this.originalWidth))this.resizeWidth.value=this.originalWidth;this.scalePreview(this.resizeWidth.value,0)},adjustImageWidth:function(){if(parseInt(this.resizeHeight.value)>
parseInt(this.originalHeight))this.resizeHeight.value=this.originalHeight;this.scalePreview(0,this.resizeHeight.value)},update:function(a){if(a.width!=null&&a.width>0)this.resizeWidth.value=a.width;if(a.height!=null&&a.height>0)this.resizeHeight.value=a.height;if(a.width!=null&&a.width>0&&a.height!=null&&a.height>0)this.originalAspectRatio=a.width/a.height},cleanAll:function(){}}),globalImageHelper,ImageUploadHelper=Class.create({initialize:function(a){this.editor=a;this.imageListPage=1;this.blogFilter=
0;globalImageHelper=this;this.editor.selection.getNode()!=null&&this.editor.selection.getNode().nodeName=="IMG"?this.openConfigWindow(this.editor.selection.getNode()):this.openUploadWindow()},openConfigWindow:function(a){this.editingNode=a;this.window=new BligooWindow("image-config",{first:"windowImageConfig",module:"ImageUpload",width:450,height:400,parameters:{align:this.getAttrib(a,"align"),border:this.getAttrib(a,"border"),width:this.getAttrib(a,"width"),height:this.getAttrib(a,"height"),vmargin:this.getAttrib(a,
"vspace"),hmargin:this.getAttrib(a,"hspace"),url:this.getAttrib(a,"src"),title:this.getAttrib(a,"title"),alt:this.getAttrib(a,"alt")},onComplete:this.initImageConfig.bind(this)})},getAttrib:function(a,b){var c=this.editor,d=c.dom,e;if(c.settings.inline_styles)switch(b){case "align":if(e=d.getStyle(a,"float"))return e;if(e=d.getStyle(a,"vertical-align"))return e;break;case "hspace":e=d.getStyle(a,"margin-left");c=d.getStyle(a,"margin-right");if(e&&e==c)return parseInt(e.replace(/[^0-9]/g,""));break;
case "vspace":e=d.getStyle(a,"margin-top");c=d.getStyle(a,"margin-bottom");if(e&&e==c)return parseInt(e.replace(/[^0-9]/g,""));break;case "border":e=0;tinymce.each(["top","right","bottom","left"],function(f){f=d.getStyle(a,"border-"+f+"-width");if(!f||f!=e&&e!==0){e=0;return false}if(f)e=f});if(e)return parseInt(e.replace(/[^0-9]/g,""));break}if(e=d.getAttrib(a,b))return e;return""},initImageConfig:function(){this.imageEditSrc=$("image-config-url");this.imageEditDesc=$("image-config-desc");this.imageEditAlign=
$("image-config-align");this.imageEditWidth=$("image-config-size-width");this.imageEditHeight=$("image-config-size-height");this.imageEditBorder=$("image-config-border");this.imageEditVMargin=$("image-config-vmargin");this.imageEditHMargin=$("image-config-hmargin");this.imageEditAlt=$("image-config-alt");this.applyConfigChangesButton=$("bligoo-image-config-apply-button");this.applyConfigChangesButton.observe("click",this.applyConfigChanges.bind(this))},serializeStyle:function(a){var b="";$H(a).each(function(c){if(c.key!=
""&&c.value!=""){value=c.value;switch(c.key){case "margin-left":case "margin-right":case "margin-top":case "margin-bottom":case "margin":case "border":case "float":case "vertical-align":b+=(b?" ":"")+c.key+": "+value+";";break}}});return b},applyConfigChanges:function(){args={};var a=[];if(this.imageEditHMargin.value!=""){a["margin-left"]=this.imageEditHMargin.value+"px";a["margin-right"]=this.imageEditHMargin.value+"px"}if(this.imageEditVMargin.value!=""){a["margin-top"]=this.imageEditVMargin.value+
"px";a["margin-bottom"]=this.imageEditVMargin.value+"px"}if(this.imageEditBorder.value!=""&&!isNaN(this.imageEditBorder.value))a.border=this.imageEditBorder.value=="0"?"0":this.imageEditBorder.value+"px solid black";if(this.imageEditAlign.value!="none")if(this.imageEditAlign.value=="left"||this.imageEditAlign.value=="right")a["float"]=this.imageEditAlign.value;else a["vertical-align"]=this.imageEditAlign.value;a=this.editor.dom.parseStyle(this.serializeStyle(a));args.style=this.serializeStyle(a);
if(this.imageEditWidth.value!="")args.width=this.imageEditWidth.value;if(this.imageEditHeight.value!="")args.height=this.imageEditHeight.value;if(this.imageEditSrc.value!="")args.src=this.imageEditSrc.value;args.title=this.imageEditDesc.value;args.alt=this.imageEditAlt.value;this.editor.dom.setAttribs(this.editingNode,args);this.window.close()},openUploadWindow:function(){this.window=new BligooWindow("tmce-image-uploader",{first:"windowImageInsert",module:"ImageUpload",parameters:{},target:"window_target_upload",
action:"/bligoo/bligoo?path=image/save",encType:"multipart/form-data",onComplete:this.init.bind(this),width:450,height:250})},init:function(){this.openGalleryLink=$("open-image-gallery-link");this.galleryArea=$("bligoo-image-insert-uploaded");this.uploadArea=$("bligoo-image-insert-default");this.openGalleryLink.observe("click",function(){this.uploadArea.hide();this.galleryArea.show()}.bind(this));this.initButtons();this.updateImageList()},initButtons:function(){$("bligoo-window-submit-extern")&&$("bligoo-window-submit-extern").observe("click",
this.insertExtern.bindAsEventListener(this));$("bligoo-window-submit-upload")&&$("bligoo-window-submit-upload").observe("click",this.insertUploadImage.bindAsEventListener(this))},insertUploadImage:function(){uploadChecker!=null&&uploadChecker.stop();uploadChecker=new UploadCheckerClass;uploadChecker.start();this.window.submit()},insertExtern:function(){var a=$("image-url").value;this.insert(a,a)},edit:function(a,b,c,d){this.window.close();new ImageEditor("image-for-edit",this.insert.bind(this,a,b),
c,d,a,"image-upload")},editAndBack:function(a,b,c,d){this.window.close();new ImageEditor("image-for-edit",this.openUploadWindow.bind(this),c,d,a,"image-edit")},getFileName:function(a){if(a==""||a==null)return"";var b=a.lastIndexOf("/");if(b>-1&&b<a.length-1)return a.substring(b+1);return a},insert:function(a,b,c){a={src:a+"?v="+(new Date).valueOf(),title:"",alt:this.getFileName(a),style:"margin-left: 4px; margin-right: 4px; margin-top: 4px; margin-bottom: 4px; border: 0"};if(c!=null){if(c.width>0)a.width=
c.width;if(c.height>0)a.height=c.height}this.editor.execCommand("mceInsertContent",false,'<img id="__mce_tmp" src="javascript:;" />',{skip_undo:1});this.editor.dom.setAttribs("__mce_tmp",a);this.editor.dom.setAttrib("__mce_tmp","id","");this.editor.undoManager.add();this.window.close()},updateImageList:function(){if($("bligoo-image-insert-list")){$("bligoo-image-insert-list").startWaiting("bigWaiting");new Ajax.Updater("bligoo-image-insert-list","/bligoo/ajaxproxy",{method:"updateImageList",parameters:{page:this.imageListPage,
blogFilter:this.blogFilter},onComplete:this.postUpdateList.bind(this)})}},postUpdateList:function(){this.openUploadLink=$("open-image-upload-options");this.openUploadLink.observe("click",function(){this.galleryArea.hide();this.uploadArea.show()}.bind(this));$("image-upload-image-list-pager-prev")!=null&&$("image-upload-image-list-pager-prev").observe("click",this.imageListPrevPage.bind(this));$("image-upload-image-list-pager-next")!=null&&$("image-upload-image-list-pager-next").observe("click",this.imageListNextPage.bind(this));
$("image-upload-image-list-blog-filter")!=null&&$("image-upload-image-list-blog-filter").observe("change",this.updateBlogFilter.bind(this));$("bligoo-image-insert-list").select(".insertable-image").each(function(a){var b=a.select(".image-info-id").first().value,c=a.select(".image-info-src").first().value,d=a.select(".image-info-width").first().value,e=a.select(".image-info-height").first().value,f=a.select(".image-link-insert").first(),g=a.select("img").first(),k=a.select(".image-link-delete").first();
a=a.select(".image-link-edit").first();f.observe("click",this.insert.bind(this,c,c,{width:d,height:e}));g.observe("click",this.insert.bind(this,c,c,{width:d,height:e}));k.observe("click",this.deleteImage.bind(this,b));a.observe("click",this.editAndBack.bind(this,c,c,d,e,b))}.bind(this));$("bligoo-image-insert-list").stopWaiting()},deleteImage:function(a){confirm(tr("ImageUploadBean.message.image.delete.confirm"))&&new Ajax.Request("/bligoo/ajaxproxy",{method:"imageDelete",parameters:{imageId:a},onComplete:this.postDeleteImage.bind(this,
a)})},postDeleteImage:function(a){$("insertable-image-"+a)!=null&&this.updateImageList()},updateBlogFilter:function(){if($("image-upload-image-list-blog-filter").value!=this.blogFilter){this.imageListPage=1;this.blogFilter=$("image-upload-image-list-blog-filter").value}this.updateImageList()},imageListNextPage:function(){this.imageListPage++;this.updateImageList()},imageListPrevPage:function(){this.imageListPage--;this.updateImageList()}}),ImageEditorHelperClass=Class.create({initialize:function(){},
edit:function(a,b,c,d){new ImageEditor("image-for-edit",null,a,b,c,"image-save",d)}}),ImageEditorHelper=new ImageEditorHelperClass,AvatarUploadHelper=Class.create({initialize:function(a){if(a!=null){this.window=a;this.enableWindowButtons()}},enableWindowButtons:function(){this.uploadButton=$("bligoo-window-submit-upload-avatar");this.uploadButton.observe("click",this.uploadAvatar.bind(this))},uploadAvatar:function(){this.uploadButton.startWaiting("waiting");this.window.submit()}}),ImageUploadPluginClass=
Class.create(BligooPluginClass,{init:function(){},onFileUpload:function(a){if(a.memo.id=="bar-upload-image")if(a.memo.error!=null&&$("upload-messages")!=null){$("upload-messages").update(a.memo.error);$("upload-messages").show()}else{if(a.memo.message!=null&&$("upload-messages")!=null){BligooBar.panel.stopWaiting();$("upload-messages").update(a.memo.message);$("upload-messages").show();$("bligoo-quota-percent").update(a.memo.quotaPercent);$("bligoo-quota-used").update(a.memo.quotaUsed);$("bligoo-quota-total").update(a.memo.quotaTotal);
$("bligoo-bar-progress-bar-ammount").setStyle({width:a.memo.quotaPercent+"%"})}}else if(a.memo.id=="tmce-upload-image")if(a.memo.error!=null&&$("upload-messages")!=null){$("upload-messages").update(a.memo.error);$("upload-messages").show()}else a.memo.image==true&&globalImageHelper.edit(a.memo.url,a.memo.filename,a.memo.width,a.memo.height);else if(a.memo.id=="upload-avatar"){if(a.memo.error!=null)alert(a.memo.error);else if($("bligoo-window-edit-avatar-picture")!=null)if(a.memo.editable)new ImageEditor("image-for-edit",
this.refreshAvatar.bind(this,a.memo.url),a.memo.width,a.memo.height,a.memo.url,"avatar",{recWidth:84,recHeight:84,maxWidth:84,minWidth:84,maxHeight:84,minHeight:84});else this.refreshAvatar(a.memo.url);$("bligoo-window-submit-upload-avatar")!=null&&$("bligoo-window-submit-upload-avatar").stopWaiting()}else if(a.memo.id=="avatar-tmp-upload"){if(a.memo.error!=null)alert(a.memo.error);else{a=a.memo.avatar;if($("bligoo-window-tmp-avatar-picture")!=null)$("bligoo-window-tmp-avatar-picture").src=a}enableButtons()}},
onWindowContentReplaced:function(a){$("bligoo-window-submit-upload-avatar")!=null&&new AvatarUploadHelper(a.memo)},refreshAvatar:function(a){if(a.indexOf("?ver")>-1)$("bligoo-window-edit-avatar-picture").src=a;else $("bligoo-window-edit-avatar-picture").src=a+"?ver="+(new Date).valueOf()},onPageLoaded:function(){$("edit-content-form")&&new InsertImageButton($("content-form-tinymce-image"))}});PluginManager.add(new ImageUploadPluginClass);
var InsertImageButton=Class.create(TmcePlugin,{initialize:function(a){this.item=a;this.width=400;this.height=300;this.item.observe("click",this.openWindow.bindAsEventListener(this))},openWindow:function(){this.editor=this.findEditor();this.helper=new ImageUploadHelper(this.editor)}});function confirmFileDelete(a,b){a=confirm(a);b=b;if(a)a=new Ajax.Request("/bligoo/ajaxproxy",{method:"get",parameters:"method=fileDelete&fileId="+b,onComplete:function(c){new Effect.Fade("file-info-"+b)}})}
document.observe("bligoo:file-uploaded",function(a){if(a.memo.id=="bar-upload-file"){if(a.memo.error!=null&&$("upload-messages")!=null){$("upload-messages").update(a.memo.error);$("upload-messages").show()}else if(a.memo.message!=null&&$("upload-messages")!=null){$("upload-messages").update(a.memo.message);$("upload-messages").show();$("bligoo-quota-percent").update(a.memo.quotaPercent);$("bligoo-quota-used").update(a.memo.quotaUsed);$("bligoo-quota-total").update(a.memo.quotaTotal)}BligooBar.panel.stopWaiting()}});
var globalFileHelper=null,FileUploadHelper=Class.create({initialize:function(a){this.editor=a;this.page=1;this.blogFilter=0;globalFileHelper=this;this.openUploadWindow()},openUploadWindow:function(){this.window=new BligooWindow("tmce-file-uploader",{first:"windowFileInsert",module:"FileUpload",parameters:{},target:"window_target_upload",action:"/bligoo/bligoo?path=file/save/callback",encType:"multipart/form-data",onComplete:this.init.bind(this),width:450,height:250})},init:function(){this.openGalleryLink=
$("open-file-gallery-link");this.galleryArea=$("bligoo-file-insert-uploaded");this.uploadArea=$("bligoo-file-insert-upload");this.openGalleryLink.observe("click",function(){this.uploadArea.hide();this.galleryArea.show()}.bind(this));$("bligoo-window-submit-upload")&&$("bligoo-window-submit-upload").observe("click",this.upload.bindAsEventListener(this));this.updateList()},upload:function(){uploadChecker!=null&&uploadChecker.stop();uploadChecker=new UploadCheckerClass;uploadChecker.start();this.window.submit()},
updateList:function(){if($("bligoo-file-insert-list")){this.fileListArea=$("bligoo-file-insert-list");this.fileListArea.startWaiting("bigWaiting");new Ajax.Updater("bligoo-file-insert-list","/bligoo/ajaxproxy",{method:"updateFileList",parameters:{page:this.page,blogFilter:this.blogFilter},onComplete:this.postUpdateList.bind(this)})}},postUpdateList:function(){this.openUploadLink=$("open-file-upload-link");this.openUploadLink.observe("click",function(){this.galleryArea.hide();this.uploadArea.show()}.bind(this));
$("file-upload-file-list-pager-prev")!=null&&$("file-upload-file-list-pager-prev").observe("click",this.prevPage.bind(this));$("file-upload-file-list-pager-next")!=null&&$("file-upload-file-list-pager-next").observe("click",this.nextPage.bind(this));$("file-upload-file-list-blog-filter")!=null&&$("file-upload-file-list-blog-filter").observe("change",this.updateBlogFilter.bind(this));this.fileListArea.select(".insertable-file").each(function(a){var b=a.getAttribute("data-file-id"),c=a.getAttribute("data-file-src"),
d=a.getAttribute("data-file-desc"),e=a.select(".file-link-insert").first();a=a.select(".file-link-delete").first();e.observe("click",this.insert.bind(this,c,d));a.observe("click",this.deleteFile.bind(this,b))}.bind(this));this.fileListArea.stopWaiting()},updateBlogFilter:function(){if($("file-upload-file-list-blog-filter").value!=this.blogFilter){this.page=1;this.blogFilter=$("file-upload-file-list-blog-filter").value}this.updateList()},nextPage:function(){this.page++;this.updateList()},prevPage:function(){this.page--;
this.updateList()},deleteFile:function(a){confirm(tr("FileUploadBean.message.delete.confirm"))&&new Ajax.Request("/bligoo/ajaxproxy",{method:"fileDelete",parameters:{fileId:a},onComplete:function(){this.updateList()}.bind(this)})},insert:function(a,b){var c=this.getFileName(a);if(b!=""&&b!=null)c=b;this.editor.execCommand("mceInsertContent",true,'<a href="'+a+'" alt="'+c+'">'+c+"</a>");this.window.close()},getFileName:function(a){if(a==""||a==null)return"";var b=a.lastIndexOf("/");if(b>-1&&b<a.length-
1)return a.substring(b+1);return a}}),InsertFileButton=Class.create(TmcePlugin,{initialize:function(a){this.item=a;this.item.observe("click",this.openWindow.bindAsEventListener(this))},openWindow:function(){this.editor=this.findEditor();this.helper=new FileUploadHelper(this.editor,null)}}),globalFlashHelper=null,FlashUploadHelper=Class.create({initialize:function(a,b){this.editor=a;this.node=b;this.page=1;this.blogFilter=0;if(this.node!=null)this.openEditWindow();else{globalFlashHelper=this;this.openUploadWindow()}},
getEncodedData:function(){var a=$("content-form-tinymce-flash");this.title=a.getAttribute("data-title");this.okLabel=a.getAttribute("data-txt-ok");this.cancelLabel=a.getAttribute("data-txt-cancel");this.closeLabel=a.getAttribute("data-txt-close");this.confirmText=a.getAttribute("data-txt-confirm");this.width=a.getAttribute("data-width");this.height=a.getAttribute("data-height");this.widthLabel=a.getAttribute("data-label-width");this.heightLabel=a.getAttribute("data-label-height");this.urlLabel=a.getAttribute("data-label-url")},
openEditWindow:function(){this.getEncodedData();this.window=new BligooWindow("flash-edit-plugin",{width:this.width,height:this.height});this.content=this.window.getContent();this.content.update("");var a=Builder.node("div",{"class":"bligoo-window-upper","data-header-enabled":"true"});this.url=drawFieldText("flash-url","flash-url","",this.editor.dom.getAttrib(this.node,"alt"),this.urlLabel,255,20);a.appendChild(this.url);this.fewidth=drawFieldText("fewidth","fewidth","",this.editor.dom.getAttrib(this.node,
"width"),this.widthLabel,6,4);this.feheight=drawFieldText("feheight","feheight","",this.editor.dom.getAttrib(this.node,"height"),this.heightLabel,6,4);a.appendChild(this.fewidth);a.appendChild(this.feheight);this.content.appendChild(a);this.window.addButton("ok",this.okLabel,BligooWindow.BUTTON_TYPE_OK).observe("click",this.close.bindAsEventListener(this));this.window.addButton("cancel",this.cancelLabel,BligooWindow.BUTTON_TYPE_CANCEL).observe("click",this.cancel.bindAsEventListener(this));this.window.setTitle(this.title);
this.window.setSize(this.width,this.height)},close:function(){this.insert(this.url.select("input").first().value,"",this.fewidth.select("input").first().value,this.feheight.select("input").first().value)},cancel:function(){globalFlashHelper=null;this.window.destroy()},openUploadWindow:function(){this.window=new BligooWindow("tmce-file-uploader",{first:"windowFlashInsert",module:"FileUpload",parameters:{},target:"window_target_upload",action:"/bligoo/bligoo?path=file/save/callback",encType:"multipart/form-data",
onComplete:this.init.bind(this),width:450,height:250})},init:function(){$("bligoo-window-submit-upload")&&$("bligoo-window-submit-upload").observe("click",this.upload.bindAsEventListener(this));this.openGalleryLink=$("open-flash-gallery-link");this.galleryArea=$("bligoo-flash-insert-uploaded");this.uploadArea=$("bligoo-flash-insert-upload-area");this.openGalleryLink.observe("click",function(){this.uploadArea.hide();this.galleryArea.show()}.bind(this));this.flashUploadW=450;this.flashUploadH=300;this.updateList()},
upload:function(){uploadChecker!=null&&uploadChecker.stop();uploadChecker=new UploadCheckerClass;uploadChecker.start();this.fwidth=this.flashUploadW;this.fheight=this.flashUploadH;this.window.submit()},updateList:function(){if($("bligoo-flash-insert-list")){this.fileListArea=$("bligoo-flash-insert-list");this.fileListArea.startWaiting("bigWaiting");new Ajax.Updater("bligoo-flash-insert-list","/bligoo/ajaxproxy",{method:"updateFlashList",parameters:{page:this.page,blogFilter:this.blogFilter},onComplete:this.postUpdateList.bind(this)})}},
postUpdateList:function(){this.openUploadLink=$("open-flash-upload-link");this.openUploadLink.observe("click",function(){this.galleryArea.hide();this.uploadArea.show()}.bind(this));$("flash-upload-flash-list-pager-prev")!=null&&$("flash-upload-flash-list-pager-prev").observe("click",this.prevPage.bind(this));$("flash-upload-flash-list-pager-next")!=null&&$("flash-upload-flash-list-pager-next").observe("click",this.nextPage.bind(this));$("flash-upload-flash-list-blog-filter")!=null&&$("flash-upload-flash-list-blog-filter").observe("change",
this.updateBlogFilter.bind(this));this.fileListArea.select(".insertable-file").each(function(a){var b=a.getAttribute("data-file-id"),c=a.getAttribute("data-file-src"),d=a.getAttribute("data-file-desc"),e=a.select(".file-link-insert").first(),f=a.select(".file-link-delete").first(),g=a.getAttribute("data-flash-width");a=a.getAttribute("data-flash-height");e.observe("click",this.insert.bind(this,c,d,g,a));f.observe("click",this.deleteFile.bind(this,b))}.bind(this));this.fileListArea.stopWaiting()},
updateBlogFilter:function(){if($("flash-upload-flash-list-blog-filter").value!=this.blogFilter){this.page=1;this.blogFilter=$("flash-upload-flash-list-blog-filter").value}this.updateList()},nextPage:function(){this.page++;this.updateList()},prevPage:function(){this.page--;this.updateList()},deleteFile:function(a){confirm(tr("FileUploadBean.message.delete.confirm"))&&new Ajax.Request("/bligoo/ajaxproxy",{method:"fileDelete",parameters:{fileId:a},onComplete:function(){this.updateList()}.bind(this)})},
insert:function(a,b,c,d){b=this.fwidth;var e=this.fheight;if(c!=null&&c!="")b=c;if(d!=null&&d!="")e=d;if(b==""||b==null)b=425;if(e==""||e==null)e=350;c=this.editor.baseURI.path+"/plugins/flash/img/trans.gif";this.editor.execCommand("mceInsertContent",false,'<img class="mceFlash mceItem" src="'+c+'" mce_src="'+c+'" width="'+b+'" height="'+e+'" border="0" alt="'+a+'" title="'+a+'" />');this.window.destroy()},getFileName:function(a){if(a==""||a==null)return"";var b=a.lastIndexOf("/");if(b>-1&&b<a.length-
1)return a.substring(b+1);return a}}),InsertFlashButton=Class.create(TmcePlugin,{initialize:function(a){this.item=a;this.item.observe("click",this.openWindow.bindAsEventListener(this))},openWindow:function(){this.editor=this.findEditor();this.helper=new FlashUploadHelper(this.editor,null)}}),FilePluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){if($("edit-content-form")){new InsertFileButton($("content-form-tinymce-files"));new InsertFlashButton($("content-form-tinymce-flash"))}},
onFileUpload:function(a){if(a.memo.id=="tmce-upload-file")if(a.memo.error!=null&&$("upload-messages")!=null){$("upload-messages").update(a.memo.error);$("upload-messages").show()}else{var b=a.memo.url;b.toLowerCase().indexOf(".swf")!=-1&&globalFlashHelper!=null?globalFlashHelper.insert(b,a.memo.description,null,null):globalFileHelper.insert(b,a.memo.description)}}});PluginManager.add(new FilePluginClass);
var UploadCheckerClass=Class.create({initialize:function(){this.updater=null},start:function(){$("upload-messages").innerHTML="";$("upload-messages").show();this.updater=new Ajax.PeriodicalUpdater("upload-messages","/bligoo/ajaxproxy",{asynchronous:true,frequency:2,method:"checkUploadStatus",onFailure:this.error.bind(this)})},stop:function(a){this.updater!=null&&this.updater.stop();if(a!=null&&a!=""){$("upload-messages").update(a);$("upload-messages").show()}else{$("upload-messages").update("");$("upload-messages").hide()}},
error:function(){this.stop("Error communicating with server. Please try again.")}}),uploadChecker=null;function fireUpload(a){if(uploadChecker!=null){uploadChecker.stop();uploadChecker=null}this.document.fire("bligoo:file-uploaded",a)}
var CaptchaClass=Class.create({initialize:function(a){this.element=a;this.image=this.element.select(".captcha-image")[0];this.link=this.element.select("a.reset-captcha")[0];this.link.observe("click",this.click.bindAsEventListener(this))},click:function(){this.image.src="/bligoo/captcha?"+(new Date).getTime()}}),CaptchaPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){$$(".captcha-item").each(function(a){new CaptchaClass(a)})},onWindowContentReplaced:function(a){$$("#"+a.memo.window.id+
" .captcha-item").each(function(b){new CaptchaClass(b)})},onBarLeafReplaced:function(){$$("#bligoo-bar-item-content .captcha-item").each(function(a){new CaptchaClass(a)})}});PluginManager.add(new CaptchaPluginClass);
var GoogleAddressSelector=Class.create({initialize:function(a){this.element=a;google.load("maps","3",{other_params:"sensor=false&language="+userLanguage,callback:function(){this.afterGoogleLoad()}.bind(this)})},afterGoogleLoad:function(){this.geocoder=new google.maps.Geocoder;this.element.observe("keyup",this.onKeyUp.bindAsEventListener(this));this.element.observe("keydown",this.onKeyDown.bindAsEventListener(this));this.element.insert({after:'<div class="bligoo-option-list-selector" id="option-list-'+
this.element.id+'"></div>'});this.elementxy=$(this.element.id+"-xy");this.elementIndicator=$("bligoo-address-selector-wapper-"+this.element.id);this.elementIndicator.observe("click",this.openMiniGoogleMaps.bind(this));this.list=$("option-list-"+this.element.id);this.list.setStyle({left:"0px"});this.list.hide();this.index=-1;this.disabled=false;this.element.enable()},disable:function(){this.disabled=true;this.element.disable();this.element.value="";this.elementxy.value="";this.elementIndicator.removeClassName("not-found");
this.elementIndicator.addClassName("not-found")},enable:function(){this.disabled=false;this.element.enable();this.elementIndicator.removeClassName("not-found");this.elementIndicator.addClassName("not-found");this.elementIndicator.stopObserving("click")},openHelpMap:function(){this.helpWindow=null},onKeyDown:function(a){a.keyCode==13&&a.stop()},onKeyUp:function(a){a.keyCode==13&&a.stop();this.periodical&&this.periodical.stop();this.elementIndicator.removeClassName("not-found");this.elementIndicator.addClassName("not-found");
this.periodical=new PeriodicalExecuter(this.getGoogleGEOCode.bind(this),1)},hideList:function(){this.list.hide();this.index=-1;this.list.update("")},nothingFound:function(){this.elementIndicator.removeClassName("not-found");this.elementIndicator.addClassName("not-found");this.elementIndicator.removeClassName("working")},setResponseFromGoogle:function(a,b){if(b!=google.maps.GeocoderStatus.OK)this.nothingFound();else{b="<ul>";this.validItems=a;for(j=0;j<a.length;j++){var c=a[j];b+='<li id="autocomplete-item-'+
j+'" class="geotype-'+c.types[0]+'">'+c.formatted_address+"</li>"}b+="</ul>";this.list.innerHTML=b;var d=this.element,e=this.elementIndicator,f=this.elementxy;this.element.cumulativeOffset();a=this.element.ancestors()[0];this.list.setStyle({position:"absolute",top:a.getHeight()+"px",width:a.getWidth()+"px"});this.list.show();var g=true;var k=this.index=0,o=0,v=this.list;a=this;$$("#"+this.list.id+" li").each(function(r){o==k?r.addClassName("selected-item"):r.addClassName("unselected-item");o++;g?
r.addClassName("even"):r.addClassName("odd");g=!g;r.observe("mouseover",function(q){q.target.removeClassName("unselected-item");q.target.addClassName("selected-item")});r.observe("mouseout",function(q){q.target.removeClassName("selected-item");q.target.addClassName("unselected-item")});r.observe("click",function(q){for(q=$(q.target);q.tagName!="LI";)q=q.ancestors()[0];var B=q.id.split("-")[2];d.value=q.innerHTML;e.removeClassName("not-found");e.removeClassName("working");q=this.validItems[B].geometry.location;
f.value=q.lng()+","+q.lat();v.hide()}.bind(this))}.bind(this))}},getGoogleGEOCode:function(a){a.stop();this.elementIndicator.removeClassName("not-found");this.elementIndicator.addClassName("working");this.elementxy.value="";this.hideList();this.element.value.strip()!=""&&this.geocoder?this.geocoder.geocode({address:this.element.value.strip()},this.setResponseFromGoogle.bind(this)):this.nothingFound()},openMiniGoogleMaps:function(){new GoogleMiniMap(this)}}),GoogleMiniMap=Class.create({initialize:function(a){this.opener=
a;this.elementxy="";this.geocoder=new google.maps.Geocoder;this.window=new BligooWindow("mini-google-maps",{first:"windowMiniMap",module:"Menu",parameters:{userSearch:this.opener.element.value.strip()},onComplete:this.postInitiliaze.bind(this),width:490,height:510})},postInitiliaze:function(){this.windowContent=this.window.getContent();this.acceptButton=$("minimap_search_acceptbutton");this.acceptButton.disable();this.acceptButton.observe("click",this.acceptButtonClick.bind(this));this.minimapCanvas=
$("minimap_canvas");this.minimapSearch=$("minimap_search_field");this.minimapSearch.insert({after:'<div class="bligoo-option-list-selector" id="option-list-'+this.minimapSearch.id+'"></div>'});this.list=$("option-list-"+this.minimapSearch.id);this.list.setStyle({left:"0px"});this.list.hide();this.minimapSearchContainer=$("minimap_search_container");this.minimapSearch.observe("keyup",this.onKeyUp.bindAsEventListener(this));this.minimapSearch.observe("keydown",this.onKeyDown.bindAsEventListener(this));
this.minimapCanvas.setStyle("width: 100%;height:90%;");var a=this.opener.element.value.strip(),b=new google.maps.LatLng(14.1001326,13.6915377),c=1;if(a!=null&&this.opener.elementxy.value!=""){a=this.opener.elementxy.value.split(",");b=new google.maps.LatLng(a[1],a[0]);c=12}this.minimap=new google.maps.Map(this.minimapCanvas,{zoom:c,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false});if(this.opener.elementxy.value!=""){a=this.opener.elementxy.value.split(",");this.updateMap(a[0],
a[1],null);this.acceptButton.enable()}},onKeyUp:function(a){a.keyCode==13&&a.stop();this.periodical&&this.periodical.stop();this.minimapSearchContainer.removeClassName("not-found");this.minimapSearchContainer.addClassName("not-found");this.periodical=new PeriodicalExecuter(this.getGoogleGEOCode.bind(this),1)},onKeyDown:function(a){a.keyCode==13&&a.stop()},getGoogleGEOCode:function(a){a.stop();this.minimapSearchContainer.removeClassName("not-found");this.minimapSearchContainer.addClassName("working");
this.elementxy="";this.hideList();this.minimapSearch.value.strip()!=""&&this.geocoder?this.geocoder.geocode({address:this.minimapSearch.value.strip()},this.setResponseFromGoogle.bind(this)):this.nothingFound()},setResponseFromGoogle:function(a,b){if(b!=google.maps.GeocoderStatus.OK)this.nothingFound();else{b="<ul>";this.validItems=a;for(j=0;j<a.length;j++){var c=a[j];b+='<li id="autocomplete-item-'+j+'" class="geotype-'+c.types[0]+'">'+c.formatted_address+"</li>"}b+="</ul>";this.list.innerHTML=b;
var d=this.minimapSearch,e=this.minimapSearchContainer,f=this.elementxy;this.minimapSearch.cumulativeOffset();a=this.minimapSearch.ancestors()[0];this.list.setStyle({position:"absolute",top:a.getHeight()+"px",width:a.getWidth()+"px"});this.list.show();var g=true;var k=this.index=0,o=0,v=this.list;a=this;$$("#"+this.list.id+" li").each(function(r){o==k?r.addClassName("selected-item"):r.addClassName("unselected-item");o++;g?r.addClassName("even"):r.addClassName("odd");g=!g;r.observe("mouseover",function(q){q.target.removeClassName("unselected-item");
q.target.addClassName("selected-item")});r.observe("mouseout",function(q){q.target.removeClassName("selected-item");q.target.addClassName("unselected-item")});r.observe("click",function(q){for(var B=$(q.target);B.tagName!="LI";)B=B.ancestors()[0];q=B.id.split("-")[2];d.value=B.innerHTML;e.removeClassName("not-found");e.removeClassName("working");B=this.validItems[q].geometry.location;f=B.lng()+","+B.lat();v.hide();this.updateMap(B.lng(),B.lat(),this.validItems[q].geometry.viewport)}.bind(this))}.bind(this))}},
updateMap:function(a,b,c){this.acceptButton.enable();var d=new google.maps.LatLng(b,a);this.elementxy=a+","+b;this.minimap.setCenter(d);c!=null&&this.minimap.fitBounds(c);if(this.marker==null){this.marker=new google.maps.Marker({position:d,map:this.minimap,draggable:true,title:this.minimapSearch.value,icon:new google.maps.MarkerImage("/static/images/event-marker.png",new google.maps.Size(20,27),new google.maps.Point(0,0),new google.maps.Point(10,27)),shadow:new google.maps.MarkerImage("/static/images/event-marker-shadow.png",
new google.maps.Size(22,20),new google.maps.Point(0,0),new google.maps.Point(6,20))});google.maps.event.addListener(this.marker,"dragend",function(){this.minimapSearch.disable();this.geocodePosition(this.marker.getPosition())}.bind(this))}else{this.marker.setPosition(d);this.marker.setTitle(this.minimapSearch.value)}},geocodePosition:function(a){this.geocoder.geocode({latLng:a},function(b){if(b&&b.length>0){this.minimapSearch.enable();this.minimapSearch.value=b[0].formatted_address;this.marker.setTitle(b[0].formatted_address);
this.elementxy=b[0].geometry.location.lng()+","+b[0].geometry.location.lat();this.marker.setPosition(b[0].geometry.location);this.minimap.setCenter(b[0].geometry.location);this.minimap.fitBounds(b[0].geometry.viewport);this.acceptButton.enable()}else{this.minimapSearch.value="";this.marker.setTitle("");this.elementxy=""}}.bind(this))},nothingFound:function(){this.minimapSearchContainer.removeClassName("not-found");this.minimapSearchContainer.addClassName("not-found");this.minimapSearchContainer.removeClassName("working")},
hideList:function(){this.list.hide();this.index=-1;this.list.update("")},acceptButtonClick:function(){if(this.elementxy!=""){this.opener.element.value=this.minimapSearch.value;this.opener.elementxy.value=this.elementxy;this.destroy()}},destroy:function(){this.window.destroy()}}),GoogleEventAddressController=Class.create({initialize:function(a){this.button=a;this.minimapSearchContainer=$("event-map-address-container");this.address=$("event-address");this.addressxy=$("event-address-xy");this.canvas=
$("event-map-canvas");this.canvas.setStyle("width: 100%;height:290px;");this.opened=false;if(this.eventAddAddressLink=$("event-add-address")){this.changeTxt=this.eventAddAddressLink.getAttribute("data-text-change");this.eventAddAddressLink.observe("click",function(){this.button.openWindow()}.bind(this))}},open:function(){this.canvas.startWaiting();google.load("maps","3",{other_params:"sensor=false&language="+userLanguage,callback:function(){this.postInitialize()}.bind(this)})},postInitialize:function(){this.marker=
null;this.geocoder=new google.maps.Geocoder;this.address.enable();this.address.insert({after:'<div class="bligoo-option-list-selector bligoo-dropdown-list" id="option-list-'+this.address.id+'"></div>'});this.list=$("option-list-"+this.address.id);this.list.setStyle({left:"0px"});this.list.hide();this.address.observe("keyup",this.onKeyUp.bindAsEventListener(this));this.address.observe("keydown",this.onKeyDown.bindAsEventListener(this));this.canvas.setStyle("width: 100%;height:290px;");var a=google.loader.ClientLocation,
b=new google.maps.LatLng(29.5328037,-34.508523);if(a!=null)b=new google.maps.LatLng(a.latitude,a.longitude);var c=1;if(this.address.value!=""&&this.addressxy.value!=""){b=this.addressxy.value.split(",");b=new google.maps.LatLng(b[1],b[0]);c=12}else if(a!=null){this.address.value=a.address.city+", "+a.address.country;this.addressxy.value=a.longitude+","+a.latitude}a={zoom:c,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false};this.canvas.stopWaiting();this.minimap=new google.maps.Map(this.canvas,
a);this.addInitialMarker(b)},addInitialMarker:function(a){if(this.marker==null){this.marker=new google.maps.Marker({position:a,map:this.minimap,draggable:true,title:this.address.value,icon:new google.maps.MarkerImage("/static/images/event-marker.png",new google.maps.Size(20,27),new google.maps.Point(0,0),new google.maps.Point(10,27)),shadow:new google.maps.MarkerImage("/static/images/event-marker-shadow.png",new google.maps.Size(22,20),new google.maps.Point(0,0),new google.maps.Point(6,20))});google.maps.event.addListener(this.marker,
"dragend",function(){this.address.disable();this.geocodePosition(this.marker.getPosition())}.bind(this))}else{this.marker.setPosition(a);this.marker.setTitle(this.address.value)}},onKeyUp:function(a){a.keyCode==13&&a.stop();this.periodical&&this.periodical.stop();this.address.removeClassName("not-found");this.address.addClassName("not-found");this.periodical=new PeriodicalExecuter(this.getGoogleGEOCode.bind(this),1)},onKeyDown:function(a){a.keyCode==13&&a.stop()},getGoogleGEOCode:function(a){a.stop();
this.address.removeClassName("not-found");this.address.addClassName("working");this.addressxy.value="";this.hideList();this.address.value.strip()!=""&&this.geocoder?this.geocoder.geocode({address:this.address.value.strip()},this.setResponseFromGoogle.bind(this)):this.nothingFound()},setResponseFromGoogle:function(a,b){if(b!=google.maps.GeocoderStatus.OK)this.nothingFound();else{b="<ul>";this.validItems=a;for(j=0;j<a.length;j++){var c=a[j];b+='<li id="autocomplete-item-'+j+'" class="geotype-'+c.types[0]+
'">'+c.formatted_address+"</li>"}b+="</ul>";this.list.innerHTML=b;var d=this.address,e=this.addressxy;this.address.cumulativeOffset();a=this.address.ancestors()[0];this.list.setStyle({position:"absolute",top:a.getHeight()+"px",width:a.getWidth()+"px"});this.list.show();var f=true;var g=this.index=0,k=0,o=this.list;a=this;$$("#"+this.list.id+" li").each(function(v){k==g?v.addClassName("selected-item"):v.addClassName("unselected-item");k++;f?v.addClassName("even"):v.addClassName("odd");f=!f;v.observe("mouseover",
function(r){r.target.removeClassName("unselected-item");r.target.addClassName("selected-item")});v.observe("mouseout",function(r){r.target.removeClassName("selected-item");r.target.addClassName("unselected-item")});v.observe("click",function(r){for(var q=$(r.target);q.tagName!="LI";)q=q.ancestors()[0];r=q.id.split("-")[2];d.value=q.innerHTML;d.removeClassName("not-found");d.removeClassName("working");q=this.validItems[r].geometry.location;e=q.lng()+","+q.lat();o.hide();this.updateMap(q.lng(),q.lat(),
this.validItems[r].geometry.viewport)}.bind(this))}.bind(this))}},updateMap:function(a,b,c){this.address.enable();var d=new google.maps.LatLng(b,a);this.addressxy.value=a+","+b;this.minimap.setCenter(d);c!=null&&this.minimap.fitBounds(c);if(this.marker==null){this.marker=new google.maps.Marker({position:d,map:this.minimap,draggable:true,title:this.address.value,icon:new google.maps.MarkerImage("/static/images/event-marker.png",new google.maps.Size(20,27),new google.maps.Point(0,0),new google.maps.Point(10,
27)),shadow:new google.maps.MarkerImage("/static/images/event-marker-shadow.png",new google.maps.Size(22,20),new google.maps.Point(0,0),new google.maps.Point(6,20))});google.maps.event.addListener(this.marker,"dragend",function(){this.address.disable();this.geocodePosition(this.marker.getPosition())}.bind(this))}else{this.marker.setPosition(d);this.marker.setTitle(this.address.value)}},geocodePosition:function(a){this.geocoder.geocode({latLng:a},function(b){if(b&&b.length>0){this.address.enable();
this.address.value=b[0].formatted_address;this.marker.setTitle(b[0].formatted_address);this.addressxy.value=b[0].geometry.location.lng()+","+b[0].geometry.location.lat();this.marker.setPosition(b[0].geometry.location);this.minimap.setCenter(b[0].geometry.location);this.minimap.fitBounds(b[0].geometry.viewport)}else{this.address.value="";this.marker.setTitle("");this.addressxy.value=""}}.bind(this))},nothingFound:function(){this.address.removeClassName("not-found");this.address.addClassName("not-found");
this.address.removeClassName("working")},hideList:function(){this.list.hide();this.index=-1;this.list.update("")},parentClose:function(){if(this.addressxy.value!=""&&this.address.value!=""&&this.eventAddAddressLink!=null)this.eventAddAddressLink.innerHTML=this.address.value+" "+this.changeTxt}});function manualEnableAddressSelector(){$("bligoo-address-selector-input-address")!=null&&new GoogleAddressSelector($("bligoo-address-selector-input-address"))}
var GoogleCitySelectorPluginClass=Class.create(BligooPluginClass,{onWindowContentReplaced:function(){$("bligoo-address-selector-input-content-map-address")!=null&&new GoogleAddressSelector($("bligoo-address-selector-input-content-map-address"));$("bligoo-address-selector-input-profile-geolocalization_link")!=null&&new GoogleAddressController($("bligoo-address-selector-input-profile-geolocalization_link"));$("bligoo-address-selector-input-content-map-address_link")!=null&&new GoogleAddressController($("bligoo-address-selector-input-content-map-address_link"))},
onPageLoaded:function(){$("bligoo-address-selector-input-profile-geolocalization")!=null&&new GoogleAddressSelector($("bligoo-address-selector-input-profile-geolocalization"));$("bligoo-address-selector-input-profile-geolocalization_link")!=null&&new GoogleAddressController($("bligoo-address-selector-input-profile-geolocalization_link"))}});PluginManager.add(new GoogleCitySelectorPluginClass);
var GoogleAddressController=Class.create({initialize:function(a){this.link=a;this.idSeed=a.id.split("_")[0];this.hiddenAddress=$(this.idSeed+"-address");this.hiddenDescription=$(this.idSeed+"-description");this.hiddenxy=$(this.idSeed+"-xy");this.label=$(this.idSeed+"_span");this.opened=false;this.getLabels();this.link.observe("click",this.openWindow.bind(this))},getLabels:function(){this.cancelLabel=this.link.getAttribute("data-cancel-label");this.okLabel=this.link.getAttribute("data-close-label");
this.title=this.link.getAttribute("data-title");this.windowDescription="";this.windowDescriptionWidth=120;this.width=400;this.height=450},openWindow:function(){this.window=new BligooWindow("video-plugin",{width:this.width,height:this.height});this.content=this.window.getContent();this.content.update("");var a=Builder.node("div",{"class":"bligoo-window-upper","data-header-enabled":"true"});this.mapAddressContainer=new Element("div",{id:"google-map-address-container","class":"bligoo-dropdown-list-wrapper",
style:"position: relative;"});this.address=new Element("input",{size:"20",maxlength:"255","class":"text-field",type:"text"});this.address.value=this.hiddenAddress.value;this.mapAddressContainer.appendChild(this.address);a.appendChild(this.mapAddressContainer);this.addressxy=new Element("input",{id:"google-map-address-xy",type:"hidden"});this.addressxy.value=this.hiddenxy.value;a.appendChild(this.addressxy);this.canvas=new Element("div",{id:"event-map-canvas",style:"width: 100%;height:290px;"});a.appendChild(this.canvas);
if(this.hiddenDescription){var b=new Element("div",{"class":"google-map-description description"});b.update(this.hiddenDescription.value);a.appendChild(b)}this.content.appendChild(a);this.window.addButton("cancel",this.cancelLabel,BligooWindow.BUTTON_TYPE_CANCEL).observe("click",this.cancel.bindAsEventListener(this));this.window.addButton("ok",this.okLabel,BligooWindow.BUTTON_TYPE_OK).observe("click",this.close.bindAsEventListener(this));this.window.setTitle(this.title);this.window.setHelp(this.windowDescription,
this.windowDescriptionWidth*2);this.window.setSize(this.width,this.height);this.enableMap()},cancel:function(){this.opened=false;this.marker=null;this.window.destroy()},close:function(){if(this.addressxy.value!=""&&this.address.value!=""){this.hiddenAddress.value=this.address.value;this.hiddenxy.value=this.addressxy.value;this.label.innerHTML=this.address.value+" - ";this.window.destroy();this.opened=false;this.marker=null}else this.cancel()},enableMap:function(){this.canvas.startWaiting();google.load("maps",
"3",{other_params:"sensor=false",callback:function(){this.postInitialize()}.bind(this)})},postInitialize:function(){this.geocoder=new google.maps.Geocoder;this.address.insert({after:'<div class="bligoo-dropdown-list bligoo-option-list-selector" id="option-list-'+this.address.id+'"></div>'});this.list=$("option-list-"+this.address.id);this.list.setStyle({left:"0px"});this.list.hide();this.address.observe("keyup",this.onKeyUp.bindAsEventListener(this));this.address.observe("keydown",this.onKeyDown.bindAsEventListener(this));
var a=google.loader.ClientLocation,b=new google.maps.LatLng(29.5328037,-34.508523);if(a!=null)b=new google.maps.LatLng(a.latitude,a.longitude);var c=1;if(this.address.value!=""&&this.addressxy.value!=""){b=this.addressxy.value.split(",");b=new google.maps.LatLng(b[1],b[0]);c=12}else if(a){this.address.value=a.address.city+", "+a.address.country;this.addressxy.value=a.longitude+","+a.latitude}a={zoom:c,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false};this.canvas.stopWaiting();
this.minimap=new google.maps.Map(this.canvas,a);this.addInitialMarker(b)},addInitialMarker:function(a){if(this.marker==null){this.marker=new google.maps.Marker({position:a,map:this.minimap,draggable:true,title:this.address.value,icon:new google.maps.MarkerImage("/static/images/event-marker.png",new google.maps.Size(20,27),new google.maps.Point(0,0),new google.maps.Point(10,27)),shadow:new google.maps.MarkerImage("/static/images/event-marker-shadow.png",new google.maps.Size(22,20),new google.maps.Point(0,
0),new google.maps.Point(6,20))});google.maps.event.addListener(this.marker,"dragend",function(){this.address.disable();this.geocodePosition(this.marker.getPosition())}.bind(this))}else{this.marker.setPosition(a);this.marker.setTitle(this.address.value)}},onKeyUp:function(a){a.keyCode==13&&a.stop();this.periodical&&this.periodical.stop();this.address.removeClassName("not-found");this.address.addClassName("not-found");this.periodical=new PeriodicalExecuter(this.getGoogleGEOCode.bind(this),1)},onKeyDown:function(a){a.keyCode==
13&&a.stop()},getGoogleGEOCode:function(a){a.stop();this.address.removeClassName("not-found");this.address.addClassName("working");this.addressxy.value="";this.hideList();this.address.value.strip()!=""&&this.geocoder?this.geocoder.geocode({address:this.address.value.strip()},this.setResponseFromGoogle.bind(this)):this.nothingFound()},setResponseFromGoogle:function(a,b){if(b!=google.maps.GeocoderStatus.OK)this.nothingFound();else{b="<ul>";this.validItems=a;for(j=0;j<a.length;j++){var c=a[j];b+='<li id="autocomplete-item-'+
j+'" class="geotype-'+c.types[0]+'">'+c.formatted_address+"</li>"}b+="</ul>";this.list.innerHTML=b;var d=this.address,e=this.addressxy;this.address.cumulativeOffset();a=this.address.ancestors()[0];this.list.setStyle({position:"absolute",top:a.getHeight()+"px",width:a.getWidth()+"px"});this.list.show();var f=true;var g=this.index=0,k=0,o=this.list;a=this;$$("#"+this.list.id+" li").each(function(v){k==g?v.addClassName("selected-item"):v.addClassName("unselected-item");k++;f?v.addClassName("even"):v.addClassName("odd");
f=!f;v.observe("mouseover",function(r){r.target.removeClassName("unselected-item");r.target.addClassName("selected-item")});v.observe("mouseout",function(r){r.target.removeClassName("selected-item");r.target.addClassName("unselected-item")});v.observe("click",function(r){for(var q=$(r.target);q.tagName!="LI";)q=q.ancestors()[0];r=q.id.split("-")[2];d.value=q.innerHTML;d.removeClassName("not-found");d.removeClassName("working");q=this.validItems[r].geometry.location;e=q.lng()+","+q.lat();o.hide();
this.updateMap(q.lng(),q.lat(),this.validItems[r].geometry.viewport)}.bind(this))}.bind(this))}},updateMap:function(a,b,c){var d=new google.maps.LatLng(b,a);this.addressxy.value=a+","+b;this.minimap.setCenter(d);c!=null&&this.minimap.fitBounds(c);if(this.marker==null){this.marker=new google.maps.Marker({position:d,map:this.minimap,draggable:true,title:this.address.value,icon:new google.maps.MarkerImage("/static/images/event-marker.png",new google.maps.Size(20,27),new google.maps.Point(0,0),new google.maps.Point(10,
27)),shadow:new google.maps.MarkerImage("/static/images/event-marker-shadow.png",new google.maps.Size(22,20),new google.maps.Point(0,0),new google.maps.Point(6,20))});google.maps.event.addListener(this.marker,"dragend",function(){this.address.disable();this.geocodePosition(this.marker.getPosition())}.bind(this))}else{this.marker.setPosition(d);this.marker.setTitle(this.address.value)}},geocodePosition:function(a){this.geocoder.geocode({latLng:a},function(b){this.address.enable();if(b&&b.length>0){this.address.value=
b[0].formatted_address;this.marker.setTitle(b[0].formatted_address);this.addressxy.value=b[0].geometry.location.lng()+","+b[0].geometry.location.lat();this.marker.setPosition(b[0].geometry.location);this.minimap.setCenter(b[0].geometry.location);this.minimap.fitBounds(b[0].geometry.viewport)}else{this.address.value="";this.marker.setTitle("");this.addressxy.value=""}}.bind(this))},nothingFound:function(){this.address.removeClassName("not-found");this.address.addClassName("not-found");this.address.removeClassName("working")},
hideList:function(){this.list.hide();this.index=-1;this.list.update("")}}),DomainChecker=new Class.create({initialize:function(a){this.domain=a;this.button=$("button-go");this.button.startWaiting();this.button.observe("click",this.close.bindAsEventListener(this));this.periodical=new PeriodicalExecuter(this.checkDnsReady.bind(this),10)},checkDnsReady:function(){this.periodical.stop();new Ajax.Request("/bligoo/ajaxproxy",{method:"isOPENSRSDnsReady",parameters:{domain:this.domain},onSuccess:this.parseRequest.bind(this)})},
parseRequest:function(a){if(a.responseText.evalJSON().status=="ok")setTimeout("showDomainReadyButton()",6E4);else this.periodical=new PeriodicalExecuter(this.checkDnsReady.bind(this),5)},close:function(){if(window.opener){window.opener.document.location.href="http://"+this.domain+"/jsredirect/editor/config";window.close()}else document.location.href="http://"+this.domain+"/jsredirect/editor/config"}}),WizardDomainChecker=new Class.create({initialize:function(a){this.domain=a;this.button=$("button-go");
this.button.startWaiting();this.button.observe("click",this.close.bindAsEventListener(this));this.periodical=new PeriodicalExecuter(this.checkDnsReady.bind(this),10)},checkDnsReady:function(){this.periodical.stop();new Ajax.Request("/bligoo/ajaxproxy",{method:"isOPENSRSDnsReady",parameters:{domain:this.domain},onSuccess:this.parseRequest.bind(this)})},parseRequest:function(a){if(a.responseText.evalJSON().status=="ok")setTimeout("showDomainReadyButton()",6E4);else this.periodical=new PeriodicalExecuter(this.checkDnsReady.bind(this),
5)},close:function(){window.opener.location.reload();window.close()}});function showDomainReadyButton(){$("button-go").stopWaiting()}
var BlogPluginClass=Class.create(BligooPluginClass,{onWindowContentReplaced:function(a){if(a.memo.window.id=="bligoo-window-theme-choose"||a.memo.window.id=="bligoo-window-new-blog-wizard"){this.observeRadio(a.memo.window,".edit-site-theme-details");this.observeRadio(a.memo.window,".layout-item");a.memo.window.id=="bligoo-window-new-blog-wizard"&&a.memo.window.select("#theme-layout-selector .layout-item-image").each(function(b){b.observe("click",function(c){c=c.target;var d=c.getAttribute("bligooLayout");
$("new-blog-layout").value=d;$$("#theme-layout-selector .layout-item-image").each(function(e){e.removeClassName("layout-item-"+e.getAttribute("bligooLayout")+"-active");e.addClassName("layout-item-"+e.getAttribute("bligooLayout")+"-inactive")});c.removeClassName("layout-item-"+d+"-inactive");c.addClassName("layout-item-"+d+"-active");$$("#theme-layout-selector .layout-description").each(function(e){e.id=="layout-description-"+d?e.show():e.hide()})})})}},observeRadio:function(a,b){a.select(b).each(function(c){var d;
c.select("input").each(function(e){d=e});d!=null&&c.observe("click",function(){d.checked=true;a.select(b).each(function(e){e.up().removeClassName("selected")});$(c).up().addClassName("selected")})}.bind(this))},onBarInit:function(a){var b=Class.create();b.prototype={initialize:function(c,d,e){this.div=d;this.divContent=this.div.select("#bligoo-bar-blog-jumpto-links-content").first();this.divContentBotL=this.div.select(".bligoo-bar-applet-links-dl").first();this.divContentBotR=this.div.select(".bligoo-bar-applet-links-dr").first();
this.link=c;this.bar=e;if(d!=null)if(d.select("a").length>0){this.link.observe("click",this.toggle.bindAsEventListener(this));document.observe("click",this.close.bindAsEventListener(this))}this.alreadyOpened=false},close:function(c){if(c.target.id!=this.link.id&&$(c.target).up()!=null&&this.link.id!=$(c.target).up().id){this.div.hide();this.link.removeClassName("bligoo-bar-jumpto-applet-pushed")}},toggle:function(){if(this.link.hasClassName("bligoo-bar-jumpto-applet-pushed"))this.link.removeClassName("bligoo-bar-jumpto-applet-pushed");
else{this.bar.closePanel();this.link.addClassName("bligoo-bar-jumpto-applet-pushed");var c=this.link.getWidth()-2;this.divContentBotL.setStyle("width:"+c+"px;float:left;");this.divContentBotR.setStyle("width:"+(150-c)+"px;float:left;background-position: "+("-"+(416-(150-c))+"px -356px")+";")}this.div.toggle();this.div.visible()&&!this.alreadyOpened&&this.getMoreLinks()},goTo:function(c,d){if(d!=undefined)document.location.href=d},getMoreLinks:function(){this.loadingDiv=Builder.node("div",{id:"bligoo-bar-jumpto-links-waiting"});
this.loadingDiv.setStyle("height: 20px; width: 100%;");this.divContent.insert({top:this.loadingDiv});$("bligoo-bar-jumpto-links-waiting").startWaiting("blackWaiting");new Ajax.Request("/bligoo/ajaxproxy",{method:"getJumptoAppletLinks",onSuccess:function(c){c=c.responseText.evalJSON();this.alreadyOpened=true;$("bligoo-bar-jumpto-links-waiting").stopWaiting();this.loadingDiv.remove();c.myBlogs!=null&&this.divContent.insert({top:c.myBlogs});c.mySubscriptions!=null&&this.divContent.insert({top:c.mySubscriptions})}.bind(this),
onFailure:function(){}.bind(this)})}};$("bligoo-bar-applet-blog-jumpto")&&new b($("bligoo-bar-applet-blog-jumpto"),$("bligoo-bar-blog-jumpto-links"),a.memo)}});PluginManager.add(new BlogPluginClass);var ContactFormPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){$$(".contact-form-block").each(function(a){a.observe("click",function(b){b.stop();document.location.href="/contact#contact-form"})})}});PluginManager.add(new ContactFormPluginClass);
var ContactSelector=Class.create({initialize:function(a){this.element=a;this.uploadCsvListener=this.uploadCsv.bindAsEventListener(this);this.uploadedCsv=this.csvUploaded.bindAsEventListener(this);document.observe("bligoo:file-uploaded",this.uploadedCsv);document.observe("bligoowindow:content-replaced",this.initCsvContent.bind(this));this.parseConfig();this.acceptEmails=this.setting("emails")=="true";this.limit=parseInt(this.setting("limit"));var b=this.element.ancestors()[0];b.setStyle({cursor:"text",
border:"1px solid #999"});b.observe("click",function(){a.focus()});this.wrapper=b;this.elements=this.counter=0;this.element.observe("keyup",this.onKeyUp.bindAsEventListener(this));this.element.observe("keydown",this.onKeyDown.bindAsEventListener(this));this.element.size=this.element.value.length+2;this.list=Builder.node("div",{id:"option-list-"+this.element.id,"class":"bligoo-dropdown-list bligoo-contact-selector-option-list"});this.list.setStyle({left:"0px"});this.list.hide();this.element.insert({after:this.list});
this.fieldName=this.element.id.substring(30);this.index=-1;if(this.setting("popup")=="true"){$$(".bligoo-select-contacts-"+this.element.id).each(function(c){c.observe("click",this.openPopup.bindAsEventListener(this,c))}.bind(this));(b=$("bligoo-email-selector-csv-"+this.element.id))&&b.observe("click",this.openCsvPopup.bindAsEventListener(this))}this.parseDefaultValues()},openPopup:function(a,b){this.window=new BligooWindow(this.element.id,{first:b.getAttribute("data-next"),module:b.getAttribute("data-module"),
endFunction:this.selectEmails.bind(this),width:400,height:150});this.window.show()},parseConfig:function(){var a=this.element.ancestors()[1],b=new Hash;$$("#"+a.id+" .bligoo-contact-selector-config").each(function(c){b.set(c.name,c.value)});this.config=b},parseDefaultValues:function(){var a=this.element.ancestors()[1];a=$$("#"+a.id+" .bligoo-contact-select-default-value");for(var b=0;b<a.length;b++)this.addTag(a[b].value,a[b].name)},openCsvPopup:function(){this.csvWindow=new BligooWindow(this.element.id,
{first:"windowUserUploadCsv",module:"UserInterface",width:400,height:330,target:"window_target_upload",encType:"multipart/form-data",action:"/file/csv/upload",onComplete:this.initCsvUpload.bind(this)});this.csvWindow.show()},initCsvUpload:function(){if($("upload-csv-file")){$("upload-csv-file").stopObserving("click",this.uploadCsvListener);$("upload-csv-file").observe("click",this.uploadCsvListener)}},uploadCsv:function(){uploadChecker!=null&&uploadChecker.stop();uploadChecker=new UploadCheckerClass;
uploadChecker.start();this.csvWindow.submit()},csvUploaded:function(a){if(a.memo.id=="upload-csv")if(a.memo.error!=null&&$("upload-messages")!=null){$("upload-messages").update(a.memo.error);$("upload-messages").show()}else this.csvWindow&&this.csvWindow.goNext()},initCsvContent:function(a){if($(a.memo).content)if($(a.memo).content.select("#csv-content").first()){this.updateCsvContent();$("use-selected-emails").observe("click",this.useSelectedCsvEmails.bindAsEventListener(this));$("csv-select-all").observe("click",
this.selectAllCsv.bindAsEventListener(this))}},selectAllCsv:function(){$$("#"+this.csvWindow.getForm().id+" input").each(function(a){a.checked=true})},useSelectedCsvEmails:function(){var a=this.element.value;$$("#"+this.csvWindow.getForm().id+" input").each(function(b){b.checked&&this.addTag(b.value,b.value)}.bind(this));this.csvWindow.close();this.element.value=a},updateCsvContent:function(){new Ajax.Request("/bligoo/ajaxproxy",{method:"csvContent",parameters:{},onSuccess:this.processCsvContent.bind(this)})},
processCsvContent:function(a){a=a.responseText.evalJSON();$("csv-content").update(a.content);this.initCsvPage(a.page)},initCsvPage:function(a){var b=$("csv-pager-left"),c=$("csv-pager-right");b&&b.observe("click",this.csvPage.bindAsEventListener(this,a-1));c&&c.observe("click",this.csvPage.bindAsEventListener(this,a+1))},csvPage:function(a,b){new Ajax.Request("/bligoo/ajaxproxy",{method:"csvContent",parameters:{page:b},onSuccess:this.processCsvContent.bind(this)})},nextEmailStep:function(){this.next.toggle();
this.close.toggle();var a=this.window.getFormContent();this.window.setContent("actualizando");a=a.toQueryParams();a.method="windowUserContactEmailsSelect";var b=this.window,c=false;new Ajax.Request("/bligoo/ajaxproxy",{parameters:a,asynchronous:false,onSuccess:function(d){if(d.responseText.startsWith("error:")){b.setContent(d.responseText.substring(6));c=true}else b.setContent(d.responseText)}});c||this.choose.toggle();this.close.toggle()},selectEmails:function(){var a=this,b=this.element.value;$$("#"+
this.window.getForm().id+" input").each(function(c){c.checked&&a.addTag(c.value,c.value)});this.closeWindow();this.element.value=b},closeWindow:function(){this.window.close()},addTag:function(a,b){if(!(b==null||b==""||b.strip()=="")){b=b.replace("/,/g","").strip().stripTags().stripScripts();this.element.value="";this.hideList();if(b.length>0&&this.elements<this.limit){var c="cross-"+this.element.id+"-"+this.counter,d="tag-wrap-"+c,e=Builder.node("img");c=Builder.node("span",{"class":"cross",id:c});
c.appendChild(e);b=Builder.node("span",{"class":"value"},b);a=Builder.node("input",{"class":"bligoo-contact-selector-value",value:a,name:"edit["+this.fieldName+"]",type:"hidden"});d=Builder.node("span",{"class":"label",id:d});d.appendChild(b);d.appendChild(a);d.appendChild(c);this.element.insert({before:d});new CrossImage(e);e.observe("click",this.closeTagHandler.bindAsEventListener(this));this.counter++;this.elements++;this.element.size=2;this.index=-1;this.updateTextFieldVisibility()}}},setting:function(a){return this.config.get(a)},
updateTextFieldVisibility:function(){this.element.ancestors();if(this.elements>=this.limit){this.limit==1&&this.wrapper.setStyle({border:"0"});this.element.hide()}else{this.limit==1&&this.wrapper.setStyle({border:"1px solid #999"});this.element.show()}},onKeyDown:function(a){a.keyCode==13&&a.stop()},onKeyUp:function(a){if(a.keyCode!=Event.KEY_TAB)if(a.keyCode==188||a.keyCode==13||a.keyCode==32){a.stop();if(a.keyCode==188){a=this.element.value;a=a.substring(0,a.length-1);this.element.value=a}if(this.acceptEmails&&
isEmail(this.element.value))this.addTag(this.element.value,this.element.value);else this.index>-1&&this.addTag(this.keys[this.index],this.values[this.index])}else if(a.keyCode==38){if(this.index>0){this.index--;this.updateSelected()}}else if(a.keyCode==40){if(this.keys&&this.index<this.keys.length-1){this.index++;this.updateSelected()}}else{this.periodical&&this.periodical.stop();this.periodical=new PeriodicalExecuter(this.updateOptions.bind(this),1);this.wrapper.hasClassName("bligoo-input-working")||
this.wrapper.addClassName("bligoo-input-working");this.wrapper.hasClassName("working")||this.wrapper.addClassName("working")}if(this.element.value.length>0)this.element.size=this.element.value.length},updateSelected:function(){var a=0,b=this.index;$$("#"+this.list.id+" li").each(function(c){if(a==b){c.removeClassName("unselected-item");c.addClassName("selected-item")}else{c.removeClassName("selected-item");c.addClassName("unselected-item")}a++})},hideList:function(){this.list.hide();this.index=-1;
this.list.update("")},closeTagHandler:function(a){this.removeTag(a.target.ancestors()[1].id);this.elements--;this.updateTextFieldVisibility()},removeTag:function(a){$(a).remove()},updateOptions:function(a){a.stop();this.wrapper.removeClassName("bligoo-input-working");this.wrapper.removeClassName("working");if(this.element.value.strip()!="")if(isEmail(this.element.value))this.hideList();else if(this.setting("autocomplete")!="false"){var b;new Ajax.Request("/bligoo/ajaxproxy",{method:"userFindAsType",
parameters:{pattern:this.element.value.strip(),alternateFunction:this.setting("alternateFunction"),alternateParameter:this.setting("alternateParameter")},asynchronous:false,onComplete:function(g){b=g.responseText.evalJSON()}});if(b==null||b.keys==null||b.keys.length<1)this.hideList();else{this.keys=b.keys;this.values=b.values;this.avatars=b.avatars;a=0;var c=this.element.value;if(this.values&&c!=""&&c!=null){for(c=Builder.node("ul");a<this.values.length;a++){var d=this.values[a],e=Builder.node("li",
{id:"autocomplete-item-"+a});e.appendChild(Builder.node("img",{src:this.avatars[a],title:this.values[a]}));e.appendChild(Builder.node("div",{"class":"contact-name"},d));e.appendChild(Builder.node("div",{"class":"clear"}));c.appendChild(e)}this.list.update(c);this.element.cumulativeOffset();this.element.ancestors();a=this.list.ancestors()[0];this.list.setStyle({position:"absolute",top:a.getHeight()+"px",width:a.getWidth()+"px"});this.list.show();document.observe("click",function(){this.list.hide()}.bind(this));
var f=true;this.index=0;$$("#"+this.list.id+" li").each(function(g,k){k==this.index?g.addClassName("selected-item"):g.addClassName("unselected-item");k++;f?g.addClassName("even"):g.addClassName("odd");f=!f;g.observe("mouseover",function(o){o.target.removeClassName("unselected-item");o.target.addClassName("selected-item")});g.observe("mouseout",function(o){o.target.removeClassName("selected-item");o.target.addClassName("unselected-item")});g.observe("click",this.clickElement.bindAsEventListener(this))}.bind(this))}}}},
clickElement:function(a){var b=$(a.target);for(a.stop();b.tagName!="LI";)b=b.ancestors()[0];this.element.value=b.innerHTML;a=b.id.split("-")[2];this.list.hide();this.addTag(this.keys[a],this.values[a])},insertEmails:function(a){if(a)for(var b=0;b<a.length;b++)this.addTag(a[b],a[b])}}),ContactSelectorPluginClass=Class.create(BligooPluginClass,{init:function(){},onPageLoaded:function(){this.initContactSelectors("body")},onWindowContentReplaced:function(a){this.initContactSelectors("#"+a.memo.window.id)},
onBarLeafReplaced:function(){this.initContactSelectors("#bligoo-bar-item-header");this.initContactSelectors("#bligoo-bar-item-content")},initContactSelectors:function(a){$$(a+" .bligoo-contact-selector-input").each(function(b){new ContactSelector(b)})}});PluginManager.add(new ContactSelectorPluginClass);
function googleSearchInit(a,b,c){var d=new google.search.SearchControl,e=new google.search.SearcherOptions;e.setNoResultsString(a);a=new google.search.WebSearch;a.setSiteRestriction(b);d.addSearcher(a,e);b=new google.search.DrawOptions;b.setDrawMode(google.search.SearchControl.DRAW_MODE_TABBED);d.setResultSetSize(google.search.Search.LARGE_RESULTSET);d.draw(document.getElementById("google-search"),b);d.setLinkTarget(google.search.Search.LINK_TARGET_SELF);d.execute(c)}
function addContentGeoLocalizationAutoData(){var a=google.loader.ClientLocation;if(a!=null){$("geolocAddress").value=a.address.country_code+", "+a.address.country+", "+a.address.region+", "+a.address.city;$("geolocCountryCode").value=a.address.country_code;$("geolocLatitude").value=a.latitude;$("geolocLongitude").value=a.longitude}}
var ContentGeolocalizatedMap=Class.create({initialize:function(a,b,c,d){this.contentId=a;this.baseUrl=d;this.pinx=b;this.piny=c;this.contentBody=$("body-"+a);this.mapDisplay=$("content-geolocalization-"+a);this.mapViewLink=this.contentBody.select("a.view-map-link")[0];this.mapViewLink.observe("click",this.goToMapPin.bindAsEventListener(this))},goToMapPin:function(){var a="http://www.bligoo.com/bligoo/map",b=this.pinx+"|"+this.piny,c=new Date;$("content-geolocalizated-map-"+this.contentId)!=null&&
$("content-geolocalizated-map-"+this.contentId).remove();a+="?action=nextEventBlidgetsMap&pins="+b+"&configId="+this.blidgetId+"&ver="+c.valueOf();this.mapDisplay.insert({after:"<iframe id='content-geolocalizated-map-"+this.contentId+"' src='"+a+"' frameborder='0' class='content-geolocalizated-map'></iframe>"})}}),ContentPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){this.addMP3Players()},addMP3Players:function(){var a=0;$$("#bligoo-site-wrapper .content-body a").each(function(b){var c=
/\.mp3$/i.exec(b.href);if(c!=null&&c.length>0){c=new Element("span");c.update('<object class="bligoo-mp3-button-player" type="application/x-shockwave-flash" width="20" height="20" data="/static/swf/musicplayer.swf?song_url='+b.href+'"><param name="movie" value="/static/swf/musicplayer.swf?song_url='+b.href+'" /><param name="wmode" value="transparent"></param><embed class="bligoo-mp3-button-player" src="/static/swf/musicplayer.swf?song_url='+b.href+'" wmode="transparent" type="application/x-shockwave-flash" width="20" height="20"></embed></object>');
b.insert({before:c});a++}})}});function enableContentMap(a,b,c,d){new ContentGeolocalizatedMap(a,b,c,d)}PluginManager.add(new ContentPluginClass);
var SpreadAppletClass=Class.create({initialize:function(a){a.observe("click",function(){(new BligooWindow("diffusion-site",{first:"windowDiffusionSite",module:"Diffusion",width:520,height:150})).show()})}}),DiffusionPluginClass=Class.create(BligooPluginClass,{onBarLeafReplaced:function(a){a.memo=="mybligoo"&&this.observeClick($("mybligoo-action-spread"))},observeClick:function(a){a!=null&&a.observe("click",function(){(new BligooWindow("diffusion-site",{first:"windowDiffusionSite",module:"Diffusion",
width:520,height:150})).show()})},onBarInit:function(a){$("bligoo-bar-applet-diffusion-spread")&&new SpreadAppletClass($("bligoo-bar-applet-diffusion-spread"),a.memo)},onPageLoaded:function(){$$(".diffusion-site-block").each(function(a){a.observe("click",function(b){b.stop();document.location.href="/diffusion/site#diffusion-form"})})},onWindowContentReplaced:function(a){if(a.memo.window.id=="bligoo-window-diffusion-post"){$("annon-facebook-share")&&$("annon-facebook-share").observe("click",this.openExternalWindow.bindAsEventListener(this,
$("annon-facebook-share").getAttribute("data-url")));$("annon-twitter-share")&&$("annon-twitter-share").observe("click",this.openExternalWindow.bindAsEventListener(this,$("annon-twitter-share").getAttribute("data-url")))}},openExternalWindow:function(a,b){this.window=window.open(b,"externalservice","width=780,height=400")}});PluginManager.add(new DiffusionPluginClass);
function openDiffusionSiteWindow(){(new BligooWindow("diffusion-site",{first:"windowDiffusionSite",module:"Diffusion",width:520,height:150})).show()}
function copyValuesFromStartToEndDate(){$("end-date-disabled-combo").toggle();$("end-date-combo").toggle();$("has-end-date").value="true";var a=$("start-date-combo").getElementsBySelector('[name="edit[start-date-month]"]')[0],b=$("start-date-combo").getElementsBySelector('[name="edit[start-date-day]"]')[0],c=$("start-date-combo").getElementsBySelector('[name="edit[start-date-year]"]')[0],d=$("start-date-combo").getElementsBySelector('[name="edit[start-date-hour]"]')[0],e=$("start-date-combo").getElementsBySelector('[name="edit[start-date-minute]"]')[0],
f=$("end-date-combo").getElementsBySelector('[name="edit[end-date-month]"]')[0],g=$("end-date-combo").getElementsBySelector('[name="edit[end-date-day]"]')[0],k=$("end-date-combo").getElementsBySelector('[name="edit[end-date-year]"]')[0],o=$("end-date-combo").getElementsBySelector('[name="edit[end-date-hour]"]')[0],v=$("end-date-combo").getElementsBySelector('[name="edit[end-date-minute]"]')[0];f.value=a.value;g.value=b.value;k.value=c.value;if(d.value<23){a=parseInt(d.value)+1;o.value=a;v.value=e.value}else{o.value=
d.value;v.value=59}return false}function disableEndDateCombo(){$("end-date-disabled-combo").toggle();$("end-date-combo").toggle();$("has-end-date").value="false";return false}
var EventOnBlidget=Class.create({initialize:function(a,b,c,d,e){this.blidgetId=a;this.baseUrl=e;this.pinx=b;this.piny=c;this.block=$("block-"+a);this.eventDiv=d;this.eventDiv.observe("click",this.goToMapPin.bindAsEventListener(this))},goToMapPin:function(){var a="http://www.bligoo.com/bligoo/map",b=this.pinx+"|"+this.piny,c=new Date;$("next-event-blidget-"+this.blidgetId+"-map")!=null&&$("next-event-blidget-"+this.blidgetId+"-map").remove();a+="?action=nextEventBlidgetsMap&pins="+b+"&configId="+this.blidgetId+
"&ver="+c.valueOf();this.eventDiv.insert({after:"<iframe id='next-event-blidget-"+this.blidgetId+"-map' src='"+a+"' frameborder='0'></iframe>"});this.enableThisEventDiv()},enableThisEventDiv:function(){var a=this.block.select(".event-row");if(a!=null)for(i=0;i<a.length;i++){var b=a[i];b.id=="pin:"+this.pinx+"|"+this.piny?b.select("a.view-map-link")[0].hide():b.select("a.view-map-link")[0].show()}}});
function enableNextEventsMapNavigation(a,b){var c=$("block-"+a);c!=null&&c.select("div.event-row a.view-map-link").each(function(d){var e=d.id.split(":")[1].split("|");new EventOnBlidget(a,e[0],e[1],d,b)})}
var NextEventsBligooBlockClass=Class.create({initialize:function(a,b){this.divArea=a;this.posibleLocationsArea=b;this.eventCount=this.divArea.getAttribute("bligoo-event-count");this.divArea.setStyle("height: 300px; width: 100%;");this.map=new GMap2(this.divArea,{mapTypes:[G_NORMAL_MAP]});this.map.setCenter(new GLatLng(34,0),1);this.map.addControl(new GSmallMapControl);if(a!=null){if(a.getAttribute("bligoo-google-location")!=null){this.param=a.getAttribute("bligoo-google-location");this.mode="googlelocation"}if(a.getAttribute("bligoo-tag")!=
null){this.param=a.getAttribute("bligoo-tag");this.mode="tag"}if(a.getAttribute("bligoo-country")!=null){this.param=a.getAttribute("bligoo-country");this.mode="country"}this.initWork()}},initWork:function(){if(this.mode=="country"||this.mode=="tag"){geocoder=new GClientGeocoder;geocoder.getLocations(this.param,this.parseBligooResponse.bind(this))}else{auxLocations=this.param.split(",");this.mapCenterLatitude=auxLocations[0];this.mapCenterLongitude=auxLocations[1];this.mapZoom=this.calculateZoom(auxLocations[2]);
this.drawMap()}},parseBligooResponse:function(a){if(!a||a.Status.code!=200)this.drawWorldView();else if(this.mode=="country"){for(var b=0;b<a.Placemark.length;b++){var c=a.Placemark[b];if(c.AddressDetails.Accuracy==1){this.mapCenterLatitude=c.Point.coordinates[1];this.mapCenterLongitude=c.Point.coordinates[0];this.mapZoom=3;this.drawMap();return}}this.drawWorldView()}else if(this.mode=="tag"){var d=Builder.node("div",{id:"bligoo-next-event-posible-locations"}),e=true;this.tagLocationSelected=false;
for(b=0;b<a.Placemark.length;b++){c=a.Placemark[b];if(c.AddressDetails.Accuracy<=4){if(e==true){e=false;this.mapCenterLatitude=c.Point.coordinates[1];this.mapCenterLongitude=c.Point.coordinates[0];this.mapZoom=this.calculateZoom(c.AddressDetails.Accuracy);this.tagLocationSelected=true}link=Builder.node("a",{href:location.href+"&bligoo-tags-location="+c.Point.coordinates[1]+","+c.Point.coordinates[0]+","+c.AddressDetails.Accuracy},c.address);pageBreak=Builder.node("br",{"class":"clear"});d.appendChild(link);
d.appendChild(pageBreak)}}if(this.tagLocationSelected==true){this.posibleLocationsArea.appendChild(d);this.drawMap()}else this.drawWorldView()}},drawWorldView:function(){this.map.setCenter(new GLatLng(0,0),0);this.getGeolocalizedContentAround()},drawFailCountry:function(){alert("No encontre el pais! "+this.param)},drawMap:function(){this.map.setCenter(new GLatLng(this.mapCenterLatitude,this.mapCenterLongitude),this.mapZoom);this.getGeolocalizedContentAround()},calculateZoom:function(a){if(a==1)return 3;
else{if(a+3<=14)return a+3;return 14}},getGeolocalizedContentAround:function(){var a=this.map.getBounds(),b=a.getSouthWest(),c=a.getNorthEast();a=c.lng();c=c.lat();var d=b.lng();b=b.lat();new Ajax.Request("/bligoo/ajaxproxy",{method:"getGeolocalizedContent",parameters:{minLatitude:b,maxLatitude:c,minLongitude:d,maxLongitude:a,mapBlogId:0,mapContentType:"Event",mapTag:"",itemCount:this.eventCount},onComplete:this.addMarkers.bind(this)})},addMarkers:function(a){a=a.responseText.evalJSON();for(var b=
0;b<a.length;b++){var c=a[b];this.addPinToMap(c.x,c.y,c.title,false)}},addPinToMap:function(a,b,c,d){a=new GLatLng(a,b);d==1&&this.map.setCenter(a,11);d=new GIcon;d.image="/static/images/event-marker.png";d.shadow="/static/images/event-marker-shadow.png";d.iconSize=new GSize(20,27);d.shadowSize=new GSize(32,20);d.iconAnchor=new GPoint(6,20);d.infoWindowAnchor=new GPoint(5,1);var e=new GMarker(a,{icon:d});GEvent.addListener(e,"click",function(){var f=unescape(c);f=f.replace(/\+/g," ");f=f.replace(/http:\//g,
"http://");e.openInfoWindowHtml(f)});this.map.addOverlay(e)}}),EventPluginController=Class.create({initialize:function(a){this.button=a;this.title=$("event-title")},open:function(){},parentClose:function(){var a=$("input-title");if(a&&this.title&&a.value=="")a.value=this.title.value}}),EventsPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){$("bligoo-next-event-block")!=null&&new NextEventsBligooBlockClass($("bligoo-next-event-block"),$("bligoo-next-event-posiblelocations"))},onWindowContentReplaced:function(){}});
PluginManager.add(new EventsPluginClass);var SubscribeAppletClass=Class.create({initialize:function(a){a.observe("click",this.click.bindAsEventListener(this))},click:function(){Profile.communitySubscribe({email:"",url:"",userId:""})}});
function initPermits(){$$("#bligoo-bar-menu-item-people-groups-groups-edit .parent-permit-check").each(function(a){var b=a.id.substring(22);if($("parent-permit-"+b))a.checked?$("parent-permit-"+b).show():$("parent-permit-"+b).hide();a.observe("click",function(c){var d=c.target.id.substring(20);$("parent-permit-"+d)&&$("parent-permit-"+d).toggle();c.target.checked?$$(".child-permit-check-"+d).each(function(e){e.disabled=false}):$$(".child-permit-check-"+d).each(function(e){e.checked=false;e.disabled=
true})})})}
var MembersManager=Class.create({initialize:function(){$("bligoo-filter-mark-all")!=null&&$("bligoo-filter-mark-all").observe("click",this.markAll.bindAsEventListener(this));$("bligoo-filter-mark-none")!=null&&$("bligoo-filter-mark-none").observe("click",this.markNone.bindAsEventListener(this))},markAll:function(){$$(".manage-member-user-list-item input").each(function(a){a.checked=true})},markNone:function(){$$(".manage-member-user-list-item input").each(function(a){a.checked=false})}}),CommunityPeopleSearch=
Class.create({initialize:function(a,b){this.itemsList=$$("#bligoo-bar-item-content .bligoo-bar-user-itemwrapper");this.items=[];this.userSelectables=a;if(this.itemsList!=null){var c=0;this.itemsList.each(function(d){this.items[c]=new CommunityPeopleItem(d,this.userSelectables,b);c++}.bind(this))}}}),CommunityPeopleItem=Class.create({initialize:function(a,b,c){this.item=a;this.bligooBar=c;this.userSelectables=b;this.userId=a.getAttribute("bligooUserId");this.enableCheckbox();this.selected=this.item.hasClassName("bligoo-bar-user-itemwrapper-selected");
this.searchForLinks();this.searchForIcon();if(this.userSelectables&&this.addChk!=null&&this.remChk!=null){this.item.observe("mouseover",this.over.bind(this));this.item.observe("mouseout",this.out.bind(this));this.item.observe("click",this.click.bind(this))}this.busy=false},searchForIcon:function(){var a=this.item.select(".members-user-item-icon").first();if(a!=null){this.icon=a;this.selected&&this.icon.show()}},enableCheckbox:function(){var a=this.item.select("input.add").first();this.addChk=a!=null?
a:null;a=this.item.select("input.remove").first();this.remChk=a!=null?a:null},out:function(){this.item.removeClassName("bligoo-bar-user-itemwrapper-over")},over:function(){this.item.addClassName("bligoo-bar-user-itemwrapper-over")},click:function(){if(this.selected){this.selected=false;this.item.removeClassName("bligoo-bar-user-itemwrapper-selected");if(this.addChk!=null)this.addChk.checked=false;if(this.remChk!=null)this.remChk.checked=true;this.icon!=null&&this.icon.hide()}else{this.selected=true;
this.item.addClassName("bligoo-bar-user-itemwrapper-selected");if(this.addChk!=null)this.addChk.checked=true;if(this.remChk!=null)this.remChk.checked=false;this.icon!=null&&this.icon.show()}},searchForLinks:function(){this.item.select(".profile-view-actions .members-user-item-action").each(function(a){a.hasClassName("members-user-action-contact-remove")&&a.observe("click",this.removeContact.bind(this));a.hasClassName("members-user-action-contact-add")&&a.observe("click",this.addContact.bind(this));
a.hasClassName("members-user-action-write-message")&&a.observe("click",this.composeMessage.bind(this));a.hasClassName("members-user-action-view-profile")&&a.observe("click",this.viewProfile.bindAsEventListener(this,a))}.bind(this))},removeContact:function(){if(!this.busy){this.busy=true;this.item.startWaiting("waiting");new Ajax.Request("/bligoo/ajaxproxy",{method:"userContactRemove",parameters:{userId:this.userId},onSuccess:this.refreshActions.bind(this)})}},addContact:function(){if(!this.busy){this.busy=
true;this.item.startWaiting("waiting");new Ajax.Request("/bligoo/ajaxproxy",{method:"userContactAdd",parameters:{userId:this.userId},onSuccess:this.refreshActions.bind(this)})}},composeMessage:function(){BligooBar.openPath("messages",$H({"reply-userId":this.userId,"return-to":"people/search"}))},refreshActions:function(a){actionsArea=this.item.select(".profile-view-actions").first();actionsArea!=null&&actionsArea.update(a.responseText);this.searchForLinks();this.item.stopWaiting();new Effect.Highlight(this.item,
{startcolor:"#88b6da",endcolor:"#ffffff",afterFinish:function(){this.busy=false}.bind(this)})},viewProfile:function(a,b){this.bligooBar.panel.startWaiting();location.href=b.getAttribute("urlLink")}}),GroupPluginClass=Class.create(BligooPluginClass,{onBarLeafReplaced:function(a){if(a.memo=="people/groups/groups/edit")initPermits();else if(a.memo=="people/groups/groups")new DeleteItemHelperClass("bligoo-bar-menu-item-people-groups-groups","people/groups/groups/delete");else if(a.memo=="mybligoo")if($("mybligoo-action-community-subscribe")!=
null)$("mybligoo-action-community-subscribe").observe("click",function(){Profile.communitySubscribe({email:"",url:"",userId:""})});else $("mybligoo-action-community-unsubscribe")!=null&&$("mybligoo-action-community-unsubscribe").observe("click",function(){var b=$("mybligoo-action-community-unsubscribe").getAttribute("bligooText"),c=$("mybligoo-action-community-unsubscribe").getAttribute("bligooOkButton");(new BligooWindow("community-unsubscribe",{first:"communityUnsubscribeWindow",module:"Group",
width:460,height:300,finalFunction:function(){new BligooSiteReloaderClass("/",60,b,c,"")}})).show()});else if(a.memo=="people/search")new CommunityPeopleSearch(false,BligooBar);else if(a.memo=="people/manage/suspended"||a.memo=="people/manage/authors"||a.memo=="people/manage/editors"||a.memo=="people/manage/administrators")new CommunityPeopleSearch(true,BligooBar)},onBarInit:function(a){$("bligoo-bar-applet-subscribe")&&new SubscribeAppletClass($("bligoo-bar-applet-subscribe"),a.memo)}});PluginManager.add(new GroupPluginClass);
var LogoutAppletClass=Class.create({initialize:function(a){a.observe("click",function(){document.location.href="/bligoo/bligoo?path=logout"})}}),BligooCTA=Class.create({initialize:function(a){this.element=a;this.language=a.getAttribute("bligooLang");this.imageId=a.getAttribute("bligooImageId");this.prefix=a.getAttribute("bligooPrefix");this.element.observe("mouseover",this.mouseOver.bindAsEventListener(this));this.element.observe("mouseout",this.mouseOut.bindAsEventListener(this))},mouseOver:function(){this.element.removeClassName(this.prefix+
"-"+this.imageId+"-"+this.language);this.element.addClassName(this.prefix+"-"+this.imageId+"-"+this.language+"-hover")},mouseOut:function(){this.element.removeClassName(this.prefix+"-"+this.imageId+"-"+this.language+"-hover");this.element.addClassName(this.prefix+"-"+this.imageId+"-"+this.language)}}),MenuPluginClass=Class.create(BligooPluginClass,{onBarInit:function(a){$("bligoo-bar-applet-logout")&&new LogoutAppletClass($("bligoo-bar-applet-logout"),a.memo)},onPageLoaded:function(){$$(".country-selector-menu-item").each(function(b){new HoverClass(b,
"country-selector-menu-item-over")});$("bligoo-login-banner-cta")&&new BligooCTA($("bligoo-login-banner-cta"));$("bligoo-login-banner-register-cta")&&new BligooCTA($("bligoo-login-banner-register-cta"));var a=$$(".bligoo-explore-side-menu").first();a!=null&&this.markSelectedExploraMenu(a);$("bligoo-footer-container")&&this.drawExploraFooter($("bligoo-footer-container"))},drawExploraFooter:function(a){new Ajax.Request("/bligoo/ajaxproxy",{method:"drawTranslation",parameters:{key:"MenuBean.text.explore.footer",
lang:userLanguage},onSuccess:function(b){a.update(b.responseText)}.bindAsEventListener(this,a)})},onBarLeafReplaced:function(a){a.memo=="mybligoo"&&$$(".mybligoo-action").each(function(b){new HoverClass(b,"mybligoo-action-hover")})},markSelectedExploraMenu:function(a){var b=location.pathname;a.select("li a").each(function(c){c.pathname==b&&c.addClassName("selected")}.bind(this))}});PluginManager.add(new MenuPluginClass);
var Menu=Class.create({initialize:function(a,b){if($(a)!=null){this.type="menu";this.closingMenuItem=this.closeDelayTimer=null;this.closeDelayTime=b;this.quickCollapse=this.collapseBorders=true;this.rootContainer=new MenuContainer(a,this);this.openChild&&this.openChild.openItemBack()}}}),MenuContainer=Class.create({initialize:function(a,b){this.type="menuContainer";this.menuItems=[];this.init(a,b)},init:function(a,b){this.element=$(a);this.parent=b;this.parentMenu=this.type=="menuContainer"?b?b.parent:
null:b;this.root=b instanceof Menu?b:b.root;this.id=this.element.id;if(this.type=="menuContainer"){this.menuType=this.element.hasClassName("level1")?"horizontal":this.element.hasClassName("level2")?"dropdown":"flyout";if(this.menuType=="flyout"||this.menuType=="dropdown"){this.isOpen=false;Element.setStyle(this.element,{position:"absolute",top:"0px",left:"0px",visibility:"hidden"})}else this.isOpen=true}else this.isOpen=this.parentMenu.isOpen;a=this.element.childNodes;if(a!=null)for(b=0;b<a.length;b++){var c=
a[b];if(c.nodeType==1)if(this.type=="menuContainer")c.tagName.toLowerCase()=="li"&&this.menuItems.push(new MenuItem(c,this));else if(c.tagName.toLowerCase()=="ul")this.subMenu=new MenuContainer(c,this)}},getBorders:function(){for(var a=["Left","Top","Right","Bottom"],b={},c=0;c<a.length;++c){var d=this.element.currentStyle?parseInt(this.element.currentStyle["border"+a[c]+"Width"]):window.getComputedStyle?parseInt(window.getComputedStyle(this.element,"").getPropertyValue("border-"+a[c].toLowerCase()+
"-width")):parseInt(this.element.style["border"+a[c]]);b[a[c].toLowerCase()]=isNaN(d)?0:d}return b},open:function(){this.root.closeDelayTimer&&window.clearTimeout(this.root.closeDelayTimer);this.parentMenu.closeAll(this);this.isOpen=true;if(this.menuType=="dropdown")Element.setStyle(this.element,{left:Position.positionedOffset(this.parent.element)[0]+"px",top:Position.positionedOffset(this.parent.element)[1]+Element.getHeight(this.parent.element)+"px"});else if(this.menuType=="flyout"){var a=this.parentMenu?
this.parentMenu.getBorders():{},b=this.getBorders();Element.setStyle(this.element,{left:this.parentMenu.element.offsetWidth-a.left-(this.root.collapseBorders?Math.min(a.right,b.left):0)+"px"});this.menuItems[0]!=null&&this.menuItems[0].element!=null&&Element.setStyle(this.element,{top:this.parent.element.offsetTop-a.top-this.menuItems[0].element.offsetTop+"px"})}Element.setStyle(this.element,{visibility:"visible"})},close:function(){Element.setStyle(this.element,{visibility:"hidden"});this.isOpen=
false;this.closeAll()},closeAll:function(a){for(var b=0;b<this.menuItems.length;++b)this.menuItems[b].closeItem(a)},openBack:function(){this.open();if(this.parent)if(this.parent.type=="menuContainer")this.parent.openBack();else this.parent.type=="menuItem"&&this.parent.openItemBack()}}),MenuItem=Class.create(MenuContainer,{initialize:function(a,b){var c=this;this.type="menuItem";this.init(a,b);if(this.subMenu)this.element.onmouseover=function(){c.subMenu.open()};else this.root.quickCollapse&&this.element.observe("mouseover",
function(){this.parentMenu.closeAll()}.bind(this));if(a=this.element.getElementsByTagName("A")[0]){a.onfocus=this.element.onmouseover;this.link=a;this.text=a.text;this.checkCurrentUrl(a.href)}this.subMenu&&this.element.observe("mouseout",function(){c.root.openDelayTimer&&window.clearTimeout(c.root.openDelayTimer);c.root.closeDelayTimer&&window.clearTimeout(c.root.closeDelayTimer);c.root.closingMenuItem=this;c.root.closeDelayTimer=window.setTimeout(function(){this.subMenu.close()}.bind(this),c.root.closeDelayTime)}.bind(this))},
checkCurrentUrl:function(a){if(location.href==a){this.element.addClassName("menu-item-active");this.root.openChild=this.menuItem}},openItem:function(){this.isOpen=true;this.subMenu&&this.subMenu.open()},closeItem:function(a){this.isOpen=false;this.subMenu&&this.subMenu!=a&&this.subMenu.close()},openItemBack:function(){this.parent!=this.root?this.parent.openBack():this.element.addClassName("menu-item-selected")}}),VMenu=Class.create({initialize:function(a){if($(a)!=null){this.type="menu";this.closingMenuItem=
null;this.quickCollapse=this.collapseBorders=true;this.rootContainer=new VMenuContainer(a,this);this.openChild&&this.openChild.openItemBack()}}}),VMenuContainer=Class.create({initialize:function(a,b){this.type="menuContainer";this.menuItems=[];this.init(a,b)},init:function(a,b){this.element=$(a);this.parent=b;this.parentMenu=this.type=="menuContainer"?b?b.parent:null:b;this.root=b instanceof VMenu?b:b.root;this.id=this.element.id;if(this.type=="menuContainer"){this.menuType=this.element.hasClassName("level1")?
"firstLevel":"subLevel";if(this.menuType=="subLevel"){this.isOpen=false;this.element.hide()}else this.isOpen=true}else this.isOpen=this.parentMenu.isOpen;a=this.element.childNodes;if(a!=null)for(b=0;b<a.length;b++){var c=a[b];if(c.nodeType==1)if(this.type=="menuContainer")c.tagName.toLowerCase()=="li"&&this.menuItems.push(new VMenuItem(c,this));else if(c.tagName.toLowerCase()=="ul")this.subMenu=new VMenuContainer(c,this)}},openBack:function(){this.open();if(this.parent)if(this.parent.type=="menuContainer")this.parent.openBack();
else this.parent.type=="menuItem"&&this.parent.openItemBack()},open:function(){this.isOpen=true;this.menuType=="subLevel"&&this.element.show()},close:function(){this.element.hide();this.isOpen=false},closeAll:function(a){for(var b=0;b<this.menuItems.length;++b)this.menuItems[b].closeItem(a)}}),VMenuItem=Class.create(VMenuContainer,{initialize:function(a,b){this.menuItem=this;this.type="menuItem";this.init(a,b);this.subMenu&&this.openSign();if(a=this.element.getElementsByTagName("A")[0]){a.onfocus=
this.element.onmouseover;this.link=a;this.text=a.text;this.checkCurrentUrl(a.href)}},checkCurrentUrl:function(a){if(location.href==a){this.element.addClassName("vmenu-item-active");this.root.openChild=this.menuItem}},openSign:function(){this.element.stopObserving("click");this.element.removeClassName("vmenu-item-expanded");this.element.addClassName("vmenu-item-closed");this.element.observe("click",function(a){if(!($(a.target).tagName.toLowerCase()=="span"&&$(a.target).up().tagName.toLowerCase()==
"a")){a.stop();this.menuItem.subMenu.open();this.menuItem.closeSign()}}.bind(this))},closeSign:function(){this.element.stopObserving("click");this.element.addClassName("vmenu-item-expanded");this.element.removeClassName("vmenu-item-closed");this.element.observe("click",function(a){if(!($(a.target).tagName.toLowerCase()=="span"&&$(a.target).up().tagName.toLowerCase()=="a")){a.stop();this.menuItem.subMenu.close();this.menuItem.openSign()}}.bind(this))},openItemBack:function(){this.isOpen=true;this.subMenu&&
this.closeSign();this.parent.openBack()},openItem:function(){this.isOpen=true;this.subMenu&&this.subMenu.open()},closeItem:function(a){this.isOpen=false;this.sign&&this.openSign();this.subMenu&&this.subMenu!=a&&this.subMenu.close()}});
ProfileClass=Class.create({initialize:function(){},loadProfileBox:function(a,b){var c="placeholder-"+a;new Ajax.Request("/bligoo/ajaxproxy",{method:"getProfileBox",parameters:{configId:a,userId:b},onSuccess:function(d){if(d.responseText&&d.responsetText!=""){$(c).innerHTML=d.responseText;d.responseText.evalScripts();$(c).ancestors()[2].toggle()}}})},communitySubscribe:function(a){(new BligooWindow("community-subscribe",{first:"windowCommunitySubscribe",module:"Profile",width:400,height:400,parameters:a})).show()},
endSubscription:function(a){a&&new BligooWindow("community-subscribed",{first:"windowCommunitySubscribeEnd",module:"Profile",width:400,height:400,parameters:{code:a.code}})}});var Profile=new ProfileClass;function unconfirmedUserResendCode(){(new BligooWindow("new-user-wizard",{first:"windowUnconfirmedUserAskEmail",module:"Profile",width:450,height:400,parameters:{},finalFunction:function(){document.location.href="/home"}})).show()}
function activateCloseAndReload(){$$("div#bligoo-window-content-new-user-wizard .bligoo-button-close").first().observe("click",function(){document.location.href="/home"})}
var ProfileFormManagerClass=Class.create({initialize:function(){new DeleteItemHelperClass("bligoo-bar-field-list","people/profileform/delete");var a=this.moveDown.bindAsEventListener(this),b=this.moveUp.bindAsEventListener(this);$$(".profile-field-down a").each(function(c){c.observe("click",a)});$$(".profile-field-up a").each(function(c){c.observe("click",b)})},moveUp:function(a){a=a.target.id.split("-")[1];BligooBar.openCallBack("people/profileform/up",{profileFieldId:a})},moveDown:function(a){a=
a.target.id.split("-")[1];BligooBar.openCallBack("people/profileform/down",{profileFieldId:a})}}),ProfileFieldFormManagerClass=Class.create({initialize:function(){this.updateFilterCheckbox();var a=this.updateFilterCheckbox.bindAsEventListener(this);$$("select#profile-field-visibility").each(function(b){b.observe("change",a)})},updateFilterCheckbox:function(){$$("select#profile-field-visibility").each(function(a){$$("div#profile-field-filter").each(function(b){a.value==0?b.show():b.hide()})})}});
function refreshUserMenu(){if($("user-menu-wrapper")){$("user-menu-wrapper").startWaiting("bigWaiting");new Ajax.Updater("user-menu-wrapper","/bligoo/ajaxproxy",{method:"getUserMenu",onComplete:function(a){$$("#user-menu-wrapper .open-bligoo-window-link").each(function(b){new BligooWindowLink(b)});$("user-menu-wrapper").stopWaiting();new BligooUploadAvatarMessage($("bligoo-avatar-wrapper"),$("bligoo-change-avatar-link"))}})}if($("profile-view-account-avatar"))$("profile-view-account-avatar").src=
$("profile-view-account-avatar").src+"1";BligooWindowLink.lastWindow!=null&&BligooWindowLink.lastWindow.close()}
function refreshBligooAccount(){$("profile-bligoo-account").startWaiting("bigWaiting");new Ajax.Updater("profile-bligoo-account","/bligoo/ajaxproxy",{method:"profileBligooAccount",onComplete:function(a){$$(".open-bligoo-window-link").each(function(b){new BligooWindowLink(b)});$("profile-bligoo-account").stopWaiting()}});BligooWindowLink.lastWindow!=null&&BligooWindowLink.lastWindow.close()}
var BligooUploadAvatarMessage=Class.create({initialize:function(a,b){this.message=b;a.observe("mouseover",this.mouseOver.bindAsEventListener(this));a.observe("mouseout",this.mouseOut.bindAsEventListener(this))},mouseOver:function(){this.message.show()},mouseOut:function(){this.message.hide()}}),ProfilePluginClass=Class.create(BligooPluginClass,{onBarInit:function(a){var b=Class.create({initialize:function(c,d){this.bar=d;c.observe("click",this.open.bindAsEventListener(this))},open:function(){this.bar.openPath("unconfirmed")}});
$("bligoo-bar-applet-unconfirmed")&&new b($("bligoo-bar-applet-unconfirmed"),a.memo)},onWindowContentReplaced:function(a){if(a.memo.window.id=="bligoo-window-profile-edit-password"||a.memo.window.id=="bligoo-window-new-blog-wizard"||a.memo.window.id=="bligoo-window-new-user-wizard"||a.memo.window.id=="bligoo-window-community-subscribe")$("new-password-1")!=null&&new PasswordCheckerClass($("new-password-1"),$("new-password-2"));if(a.memo.window.id=="bligoo-window-new-blog-wizard"){var b=$("author-type-descriptions");
b&&new ArrowDescription("author-type-",$("new-blog-author-type-select"),b)}a.memo.window.id=="bligoo-window-welcome-window"&&$("close-welcome-window")&&$("close-welcome-window").observe("click",function(c,d){d.close()}.bindAsEventListener(this,a.memo));a.memo.window.id=="bligoo-window-community-subscribe"&&$("profile-geolocalization-googlexy")&&google.load("maps","3",{other_params:"sensor=false&language="+$("hidden-language").value,callback:function(){this.updateGoogleXY()}.bind(this)})},updateGoogleXY:function(){var a=
$("profile-geolocalization-googlexy"),b=google.loader.ClientLocation;if(b!=null)a.value=b.longitude+","+b.latitude},initSubscribeLinks:function(){$$(".register-link").each(function(a){a.observe("click",this.openRegisterWindow.bindAsEventListener())}.bind(this))},onPageLoaded:function(){this.initSuscribeBlocks();this.updateProfile();this.initSubscribeLinks();$("open-register-window")&&this.openRegisterWindow();$("bligoo-new-blog-button")!=null&&new BligooBlogForm($("new-blog-url"),$("new-blog-domain"),
$("bligoo-new-blog-button"),$("bligoo-register-validate-message"));$("bligoo-user-action-select")&&$("bligoo-user-action-select").observe("change",this.bligooActionChange.bindAsEventListener(this));$("bligoo-change-avatar-link")&&!$("bligoo-change-avatar-link").visible()&&new BligooUploadAvatarMessage($("bligoo-avatar-wrapper"),$("bligoo-change-avatar-link"));$("bligoo-unconfirmed-user-mark")!=null&&unconfirmedUserResendCode();if($("unconfirmed-user-resend-code-button")!=null){$("unconfirmed-user-resend-code-button").enable();
$("unconfirmed-user-resend-code-button").observe("click",function(){unconfirmedUserResendCode()})}$("explore-login-link")!=null&&$("explore-login-link").observe("click",this.openExploreLoginArea.bindAsEventListener(this,$("explore-login-link")));$$(".bligoo-ajax-box").each(function(a){this.getAjaxBox(a)}.bind(this))},getAjaxBox:function(a){var b=a.getAttribute("data-count"),c=a.getAttribute("data-method");c!=""&&b!=""&&new Ajax.Request("/bligoo/ajaxproxy",{method:c,parameters:{count:b},onSuccess:this.drawAjaxBox.bindAsEventListener(this,
a)})},drawAjaxBox:function(a,b){a=a.responseText.evalJSON();b.update(a.full)},openExploreLoginArea:function(a,b){if(a=$("login-menu"))if(a.visible()){b.removeClassName("active");a.hide()}else{b.addClassName("active");Effect.BlindDown(a,{duration:0.3})}},initSuscribeBlocks:function(){$$(".suscribe-block").each(function(a){a.observe("click",function(b){b.stop();document.location.href="community/sign"})})},updateProfile:function(){$("bligoo-profile-follow-info")&&new Ajax.Request("/bligoo/ajaxproxy",
{method:"getProfileFollowInfo",parameters:{userId:$("bligoo-profile-follow-info").getAttribute("data-user-id"),lang:$("bligoo-profile-follow-info").getAttribute("lang")},onComplete:this.postUpdateProfile.bind(this)});if($("profile-last-twitter")!=null){var a=$("profile-last-twitter"),b=a.getAttribute("data-user-twitterid");b!=null&&b!=""&&a.update(new Element("script",{src:"http://twitter.com/statuses/user_timeline/"+b+".json?callback=drawLastTwitter&amp;count=5"}))}},postUpdateProfile:function(a){$("bligoo-profile-follow-info").update(a.responseText);
$("find-followers-diffusion")&&$("find-followers-diffusion").observe("click",function(){(new BligooWindow("diffusion-site",{first:"windowDiffusionSite",module:"Diffusion",width:460,height:440})).show()})},bligooActionChange:function(a){if(!(a.target.value==0||a.target.value=="0"))document.location.href="/"+a.target.value},openRegisterWindow:function(a){(new BligooWindow("new-user-wizard",{first:"windowNewUserWizardStart",module:"Profile",width:400,height:150,cancelMessage:$("bligoo-register-cancel-message").value,
finalFunction:function(){document.location.href="/home"}})).show();a&&a.stop()}});
function drawLastTwitter(a){if(a.length>0){a=a[0];var b=a.text,c=a.created_at.split(" "),d=c[2],e="";e=monthToNumbers[c[1]];var f=c[5];c=c[3].split(":");d=Date.UTC(f,e,d,c[0],c[1],0);a=b+', <span class="last-twitter-date"><a href="http://www.twitter.com/'+a.user.screen_name+'">'+formatTimeAgo(d)+"</a></span>";$("profile-last-twitter").update(a);$("profile-last-twitter-wrapper").addClassName("enabled");$("profile-last-twitter-wrapper").show()}}
var ArrowDescription=Class.create({initialize:function(a,b,c){this.select=b;this.prefix=a;this.tips=c.select(".description-text-wrapper");this.select.observe("change",this.change.bindAsEventListener(this))},change:function(){var a=this.select.value;this.tips.each(function(b){b.id=="description-"+this.prefix+a?b.show():b.hide()}.bind(this))}}),BligooBlogForm=Class.create({initialize:function(a,b,c,d){this.input=a;this.select=b;this.button=c;this.message=d;this.input.focus();this.input.observe("keyup",
this.keyUp.bindAsEventListener(this));this.select.observe("change",this.keyUp.bindAsEventListener(this));this.button.observe("click",this.check.bindAsEventListener(this))},keyUp:function(a){if(a.keyCode==13)this.check();else{this.input.setStyle({background:"#ffffff"});this.button.enable();this.input.removeClassName("checking-field");this.message.update("")}},check:function(){this.input.removeClassName("checking-field");this.input.removeClassName("field-error");if(!(this.input.value==null||this.input.value.strip()==
"")){this.input.addClassName("checking-field");this.button.startWaiting();new Ajax.Request("/bligoo/ajaxproxy",{method:"testBlogAddress",parameters:{url:this.input.value,domain:this.select.value},onSuccess:this.processResponse.bind(this)})}},processResponse:function(a){this.button.stopWaiting();this.message.update("");this.input.removeClassName("checking-field");this.input.removeClassName("field-error");a=a.responseText.evalJSON();this.button.disable();if(a.error==null){this.newBlogWizardSkip(this);
this.button.enable()}else{this.message.update(a.error);this.input.addClassName("field-error")}},newBlogWizardSkip:function(){var a=this.input.value,b=this.select.value;(new BligooWindow("new-blog-wizard",{first:"windowNewBlogWizardRequiredInfo",module:"Blog",width:500,height:380,cancelMessage:$("bligoo-register-cancel-message").value,parameters:{"window-error-back-step":"windowNewBlogWizardBasicInfo","new-blog-url":a,"new-blog-domain":b},finalFunction:function(){document.location.href="/home"}})).show()}}),
profilePlugin=new ProfilePluginClass;PluginManager.add(profilePlugin);function manualOpenRegisterWindow(a){(new BligooWindow("new-user-wizard",{first:"windowNewUserWizardStart",module:"Profile",width:400,height:150,finalFunction:function(){document.location.href="/"}})).show()}function getFeedForBlidget(a,b,c){a=document.getElementById("rss-box-content-"+a);var d=new google.feeds.FeedControl;d.addFeed(b,"");d.setNumEntries(c);d.draw(a)}function updateEventDiv(a,b){if($(b)!=null)$(b).innerHTML=a}
var VocabularyHelperClass=Class.create({initialize:function(a,b){this.element=$(a);this.check=$("inFrontPage");if(this.element!=null&&this.check!=null){this.element.observe("change",this.change.bindAsEventListener(this));this.terms=b}},change:function(){for(var a=this.element.options,b=0;b<a.length;b++)for(var c=0;c<this.terms.length;c++)if(a[b].value==this.terms[c]&&a[b].selected){this.check.checked=true;return}}}),ContentCategoriesHelperClass=Class.create({initialize:function(a){this.confirmTxt=
a;this.listArea=$("bligoo-bar-category-list");this.enableSingleDeleteButtons()},enableSingleDeleteButtons:function(){this.listArea.select(".bligoo-bar-category-list-item .bligoo-bar-category-list-item-buttons img").each(function(a){new CrossImage(a,this.categoryDelete.bindAsEventListener(this))}.bindAsEventListener(this))},categoryDelete:function(a){if(confirm(this.confirmTxt)){a=$(a.target).id.split("-");BligooBar.openCallBack("content/category/delete",{categoryId:a[a.length-1]})}}}),ContentCategorieTermsHelperClass=
Class.create({initialize:function(a){this.confirmTxt=a;this.listArea=$("bligoo-bar-category-terms");this.enableSingleDeleteButtons()},enableSingleDeleteButtons:function(){this.listArea.select(".bligoo-bar-category-terms-term img").each(function(a){new CrossImage(a,this.termDelete.bindAsEventListener(this))}.bindAsEventListener(this))},termDelete:function(a){if(confirm(this.confirmTxt)){a=$(a.target).id.split("-");BligooBar.openCallBack("content/category/edit/deleteterm",{termId:a[a.length-1]})}}}),
TagImageCarrouselClass=Class.create({initialize:function(a,b,c,d){this.blockId=a;this.data=b;this.autoSlideDelay=c;this.height=d;this.contentContainer=$("carrousel-main-content-"+this.blockId);this.contentContainer.setStyle("height: "+this.height+"px;");this.leftArrow=$("carrousel-left-arrow-"+this.blockId);this.rightArrow=$("carrousel-right-arrow-"+this.blockId);this.imageIndex=$("carrousel-index-"+this.blockId);this.useArrows=true;if(this.imageIndex!=null)this.useArrows=false;this.contentContainerWidth=
this.contentContainer.getWidth();this.contentContainerHeight=d;this.currentContent=0;this.isBusy=false;if(b!=null){this.contentArray=[];this.processData();this.useArrows?this.enableArrows():this.enableIndex();if(b.length>0)if(this.autoSlideDelay>0){this.periodical=new PeriodicalExecuter(this.autoSlide.bind(this),this.autoSlideDelay);this.contentContainer.observe("mouseover",this.stopAutoSlide.bind(this));this.contentContainer.observe("mouseout",this.resetDelay.bind(this))}}},processData:function(){var a=
0;this.contentContainer.setStyle("overflow: hidden;position: relative;background:#000;");this.imageList=[];this.width=$("carrousel-content-"+this.blockId).getWidth();this.data.each(function(b){var c=Builder.node("div",{id:"carrousel-"+this.blockId+"-content-container"+b.contentId,"class":"carrousel-content-container carrousel-content-container"+this.blockId});c.setStyle("position: absolute;top: 0;background: #000;width:100%;overflow: hidden;height:100%;cursor:pointer;");if(a==0)c.setStyle("left: 0;");
else this.useArrows?c.setStyle("left:5000px;"):c.hide();var d=Builder.node("div",{"class":"carrousel-content-content"});d.setStyle("position: relative;height: 100%;width: 100%;");c.appendChild(d);var e=Builder.node("div",{"class":"carrousel-content-title"});e.setStyle("position: absolute;bottom: 0; left:0;width: 100%;background:#000;color:#fff; font-size: 1.1em;font-weight: bold;z-index:10;");e.setOpacity(0.7);var f=Builder.node("div",{"class":"carrousel-content-title-div"},b.title);f.setStyle("padding: 5px;");
e.appendChild(f);if(b.body!=null){f=Builder.node("div",{"class":"carrousel-content-subtitle-div"});f.update(b.body);f.setStyle("padding: 5px;font-size: 0.8em;");e.appendChild(f)}d.appendChild(e);e=Builder.node("div",{"class":"carrousel-content-image"});f=new Image;f.onload=this.placeImage.bindAsEventListener(this,e,f);f.src=b.imageUrl;e.setStyle("position:absolute; top: 0; left:0;height:100%;overflow:hidden;text-align: center;width:100%;");d.appendChild(e);this.contentContainer.appendChild(c);this.contentArray[a]=
c;this.contentArray[a].observe("click",this.openContent.bindAsEventListener(this,b.contentLink));a++}.bind(this));this.contentNumber=a-1},placeImage:function(a,b,c){a=Builder.node("img",{src:c.src});var d=c.width/this.width,e=c.height/this.height,f=c.height;if(d>1&&e>d){a.setAttribute("width",this.width);f=c.height/d}else if(e>1&&d>e){a.setAttribute("height",this.height);f=this.height}a.setStyle("margin-top: "+(this.height-f)/2+"px");b.appendChild(a)},openContent:function(a,b){location.href=b},enableArrows:function(){var a=
(this.contentContainerHeight-this.rightArrow.getHeight())/2;if(a==0)a=5;this.rightArrow.setStyle("position: absolute; top: "+a+"px; right: 5px;z-index: 5;cursor:pointer;");this.rightArrow.setOpacity(0.3);this.data.length>0&&this.rightArrow.observe("click",this.nextContent.bindAsEventListener(this));this.rightArrow.observe("mouseover",this.setMouseOver.bindAsEventListener(this,this.rightArrow));this.rightArrow.observe("mouseout",this.setMouseOut.bindAsEventListener(this,this.rightArrow));this.leftArrow.setStyle("position: absolute; top: "+
a+"px; left: 5px;z-index: 5;cursor:pointer;");this.leftArrow.setOpacity(0.3);this.data.length>0&&this.leftArrow.observe("click",this.prevContent.bindAsEventListener(this));this.leftArrow.observe("mouseover",this.setMouseOver.bindAsEventListener(this,this.leftArrow));this.leftArrow.observe("mouseout",this.setMouseOut.bindAsEventListener(this,this.leftArrow))},enableIndex:function(){this.imageIndex.setStyle("position: absolute;top:0;z-index:2;right: 0;");for(var a=[],b=0;b<=this.contentNumber;b++){var c=
null;if(b==0){c=Builder.node("div",{"class":"carrousel-index-item-selected",style:"float:left;cursor:pointer;"},b+1);c.setOpacity(1)}else{c=Builder.node("div",{"class":"carrousel-index-item",style:"float:left;cursor:pointer;"},b+1);c.setOpacity(0.5)}c.observe("mouseover",this.gotoPost.bindAsEventListener(this,b));a[b]=c;this.imageIndex.appendChild(c)}this.indexElementArray=a;this.imageIndex.appendChild(Builder.node("div",{"class":"clear"}))},gotoPost:function(a,b){b!=this.currentContent&&this.switchToPost(b,
0.3)},switchToPost:function(a,b){this.indexElementArray[this.currentContent].removeClassName("carrousel-index-item-selected");this.indexElementArray[this.currentContent].addClassName("carrousel-index-item");this.indexElementArray[this.currentContent].setOpacity(0.5);this.indexElementArray[a].addClassName("carrousel-index-item-selected");this.indexElementArray[a].setOpacity(1);new Effect.Fade(this.contentArray[this.currentContent],{duration:b});new Effect.Appear(this.contentArray[a],{duration:b});
this.currentContent=a},setMouseOver:function(a,b){b.setOpacity(0.7)},setMouseOut:function(a,b){b.setOpacity(0.3)},nextContent:function(a){a.stop();this.isBusy||this.slideNext()},slideNext:function(){this.isBusy=true;var a=this.currentContent+1;if(a>this.contentNumber)a=0;this.contentArray[a].setStyle("left: "+this.contentContainer.getWidth()+"px;");new Effect.Move(this.contentArray[a],{x:-this.contentContainer.getWidth(),y:0,mode:"relative",transition:Effect.Transitions.sinoidal,duration:0.5,queue:{position:"end",
scope:"carrousel-queue-2-"+this.blockId,limit:1}});new Effect.Move(this.contentArray[this.currentContent],{x:-this.contentContainer.getWidth(),y:0,mode:"relative",transition:Effect.Transitions.sinoidal,duration:0.5,queue:{position:"end",scope:"carrousel-queue-1-"+this.blockId,limit:1},afterFinish:function(){this.isBusy=false}.bind(this)});this.currentContent=a},prevContent:function(a){a.stop();if(!this.isBusy){this.isBusy=true;a=this.currentContent-1;if(a<0)a=this.contentNumber;this.contentArray[a].setStyle("left: -"+
this.contentContainer.getWidth()+"px;");new Effect.Move(this.contentArray[a],{x:this.contentContainer.getWidth(),y:0,mode:"relative",transition:Effect.Transitions.sinoidal,duration:0.5,queue:{position:"end",scope:"carrousel-queue-2-"+this.blockId,limit:1}});new Effect.Move(this.contentArray[this.currentContent],{x:this.contentContainer.getWidth(),y:0,mode:"relative",transition:Effect.Transitions.sinoidal,duration:0.5,queue:{position:"end",scope:"carrousel-queue-1-"+this.blockId,limit:1},afterFinish:function(){this.isBusy=
false}.bind(this)});this.currentContent=a}},resetDelay:function(){if(this.autoSlideDelay>0){this.periodical.stop();this.periodical=new PeriodicalExecuter(this.autoSlide.bind(this),this.autoSlideDelay)}},autoSlide:function(){if(!this.isBusy)if(this.useArrows)this.slideNext();else{var a=this.currentContent+1;if(a>this.contentNumber)a=0;this.switchToPost(a,1)}},stopAutoSlide:function(){this.periodical!=null&&this.periodical.stop()}}),TagPluginClass=Class.create(BligooPluginClass,{onPageLoaded:function(){$$(".youtube-video-container").each(this.initYoutube.bind(this))},
initYoutube:function(a){var b=a.getAttribute("data-config-id"),c=a.getAttribute("data-username");if(!(c==""||c==null)){var d=a.getAttribute("data-max");a.update(new Element("script",{src:"http://gdata.youtube.com/feeds/base/users/"+c+"/uploads?orderby=updated&callback=updateYoutube"+b+"&alt=json-in-script&max-results="+d}))}}});PluginManager.add(new TagPluginClass);
var swfobject=function(){function a(){if(z.readyState=="complete"){z.parentNode.removeChild(z);b()}}function b(){if(!W){if(F.ie&&F.win){var l=E("span");try{var n=p.getElementsByTagName("body")[0].appendChild(l);n.parentNode.removeChild(n)}catch(w){return}}W=true;if(G){clearInterval(G);G=null}l=J.length;for(n=0;n<l;n++)J[n]()}}function c(l){if(W)l();else J[J.length]=l}function d(l){if(typeof m.addEventListener!=D)m.addEventListener("load",l,false);else if(typeof p.addEventListener!=D)p.addEventListener("load",
l,false);else if(typeof m.attachEvent!=D)U(m,"onload",l);else if(typeof m.onload=="function"){var n=m.onload;m.onload=function(){n();l()}}else m.onload=l}function e(){for(var l=N.length,n=0;n<l;n++){var w=N[n].id;if(F.pv[0]>0){var A=I(w);if(A){N[n].width=A.getAttribute("width")?A.getAttribute("width"):"0";N[n].height=A.getAttribute("height")?A.getAttribute("height"):"0";if(t(N[n].swfVersion)){F.webkit&&F.webkit<312&&f(A);H(w,true)}else N[n].expressInstall&&!Z&&t("6.0.65")&&(F.win||F.mac)?g(N[n]):
k(A)}}else H(w,true)}}function f(l){var n=l.getElementsByTagName(y)[0];if(n){var w=E("embed"),A=n.attributes;if(A)for(var M=A.length,P=0;P<M;P++)A[P].nodeName=="DATA"?w.setAttribute("src",A[P].nodeValue):w.setAttribute(A[P].nodeName,A[P].nodeValue);if(n=n.childNodes){A=n.length;for(M=0;M<A;M++)n[M].nodeType==1&&n[M].nodeName=="PARAM"&&w.setAttribute(n[M].getAttribute("name"),n[M].getAttribute("value"))}l.parentNode.replaceChild(w,l)}}function g(l){Z=true;var n=I(l.id);if(n){if(l.altContentId){var w=
I(l.altContentId);if(w){K=w;L=l.altContentId}}else K=o(n);if(!/%$/.test(l.width)&&parseInt(l.width,10)<310)l.width="310";if(!/%$/.test(l.height)&&parseInt(l.height,10)<137)l.height="137";p.title=p.title.slice(0,47)+" - Flash Player Installation";w="MMredirectURL="+m.location+"&MMplayerType="+(F.ie&&F.win?"ActiveX":"PlugIn")+"&MMdoctitle="+p.title;var A=l.id;if(F.ie&&F.win&&n.readyState!=4){var M=E("div");A+="SWFObjectNew";M.setAttribute("id",A);n.parentNode.insertBefore(M,n);n.style.display="none";
U(m,"onload",function(){n.parentNode.removeChild(n)})}v({data:l.expressInstall,id:h,width:l.width,height:l.height},{flashvars:w},A)}}function k(l){if(F.ie&&F.win&&l.readyState!=4){var n=E("div");l.parentNode.insertBefore(n,l);n.parentNode.replaceChild(o(l),n);l.style.display="none";U(m,"onload",function(){l.parentNode.removeChild(l)})}else l.parentNode.replaceChild(o(l),l)}function o(l){var n=E("div");if(F.win&&F.ie)n.innerHTML=l.innerHTML;else if(l=l.getElementsByTagName(y)[0])if(l=l.childNodes)for(var w=
l.length,A=0;A<w;A++)!(l[A].nodeType==1&&l[A].nodeName=="PARAM")&&l[A].nodeType!=8&&n.appendChild(l[A].cloneNode(true));return n}function v(l,n,w){var A,M=I(w);if(M){if(typeof l.id==D)l.id=w;if(F.ie&&F.win){var P="";for(var T in l)if(l[T]!=Object.prototype[T])if(T.toLowerCase()=="data")n.movie=l[T];else if(T.toLowerCase()=="styleclass")P+=' class="'+l[T]+'"';else if(T.toLowerCase()!="classid")P+=" "+T+'="'+l[T]+'"';T="";for(var O in n)if(n[O]!=Object.prototype[O])T+='<param name="'+O+'" value="'+
n[O]+'" />';M.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+P+">"+T+"</object>";S[S.length]=l.id;A=I(l.id)}else if(F.webkit&&F.webkit<312){O=E("embed");O.setAttribute("type",u);for(P in l)if(l[P]!=Object.prototype[P])if(P.toLowerCase()=="data")O.setAttribute("src",l[P]);else if(P.toLowerCase()=="styleclass")O.setAttribute("class",l[P]);else P.toLowerCase()!="classid"&&O.setAttribute(P,l[P]);for(var X in n)n[X]!=Object.prototype[X]&&X.toLowerCase()!="movie"&&O.setAttribute(X,
n[X]);M.parentNode.replaceChild(O,M);A=O}else{O=E(y);O.setAttribute("type",u);for(var V in l)if(l[V]!=Object.prototype[V])if(V.toLowerCase()=="styleclass")O.setAttribute("class",l[V]);else V.toLowerCase()!="classid"&&O.setAttribute(V,l[V]);for(var Y in n)n[Y]!=Object.prototype[Y]&&Y.toLowerCase()!="movie"&&r(O,Y,n[Y]);M.parentNode.replaceChild(O,M);A=O}}return A}function r(l,n,w){var A=E("param");A.setAttribute("name",n);A.setAttribute("value",w);l.appendChild(A)}function q(l){var n=I(l);if(n&&(n.nodeName==
"OBJECT"||n.nodeName=="EMBED"))if(F.ie&&F.win)n.readyState==4?B(l):m.attachEvent("onload",function(){B(l)});else n.parentNode.removeChild(n)}function B(l){if(l=I(l)){for(var n in l)if(typeof l[n]=="function")l[n]=null;l.parentNode.removeChild(l)}}function I(l){var n=null;try{n=p.getElementById(l)}catch(w){}return n}function E(l){return p.createElement(l)}function U(l,n,w){l.attachEvent(n,w);Q[Q.length]=[l,n,w]}function t(l){var n=F.pv;l=l.split(".");l[0]=parseInt(l[0],10);l[1]=parseInt(l[1],10)||
0;l[2]=parseInt(l[2],10)||0;return n[0]>l[0]||n[0]==l[0]&&n[1]>l[1]||n[0]==l[0]&&n[1]==l[1]&&n[2]>=l[2]?true:false}function x(l,n){if(!(F.ie&&F.mac)){var w=p.getElementsByTagName("head")[0],A=E("style");A.setAttribute("type","text/css");A.setAttribute("media","screen");!(F.ie&&F.win)&&typeof p.createTextNode!=D&&A.appendChild(p.createTextNode(l+" {"+n+"}"));w.appendChild(A);if(F.ie&&F.win&&typeof p.styleSheets!=D&&p.styleSheets.length>0){w=p.styleSheets[p.styleSheets.length-1];typeof w.addRule==y&&
w.addRule(l,n)}}}function H(l,n){n=n?"visible":"hidden";if(W&&I(l))I(l).style.visibility=n;else x("#"+l,"visibility:"+n)}function R(l){return/[\\\"<>\.;]/.exec(l)!=null?encodeURIComponent(l):l}var D="undefined",y="object",u="application/x-shockwave-flash",h="SWFObjectExprInst",m=window,p=document,C=navigator,J=[],N=[],S=[],Q=[],z,G=null,K=null,L=null,W=false,Z=false,F=function(){var l=typeof p.getElementById!=D&&typeof p.getElementsByTagName!=D&&typeof p.createElement!=D,n=[0,0,0],w=null;if(typeof C.plugins!=
D&&typeof C.plugins["Shockwave Flash"]==y){if((w=C.plugins["Shockwave Flash"].description)&&!(typeof C.mimeTypes!=D&&C.mimeTypes[u]&&!C.mimeTypes[u].enabledPlugin)){w=w.replace(/^.*\s+(\S+\s+\S+$)/,"$1");n[0]=parseInt(w.replace(/^(.*)\..*$/,"$1"),10);n[1]=parseInt(w.replace(/^.*\.(.*)\s.*$/,"$1"),10);n[2]=/r/.test(w)?parseInt(w.replace(/^.*r(.*)$/,"$1"),10):0}}else if(typeof m.ActiveXObject!=D){var A=null,M=false;try{A=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(P){try{A=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");
n=[6,0,21];A.AllowScriptAccess="always"}catch(T){if(n[0]==6)M=true}if(!M)try{A=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(O){}}if(!M&&A)try{if(w=A.GetVariable("$version")){w=w.split(" ")[1].split(",");n=[parseInt(w[0],10),parseInt(w[1],10),parseInt(w[2],10)]}}catch(X){}}M=C.userAgent.toLowerCase();var V=C.platform.toLowerCase();w=/webkit/.test(M)?parseFloat(M.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false;A=V?/win/.test(V):/win/.test(M);M=V?/mac/.test(V):/mac/.test(M);return{w3cdom:l,
pv:n,webkit:w,ie:false,win:A,mac:M}}();(function(){if(F.w3cdom){c(e);if(F.ie&&F.win)try{p.write("<script id=__ie_ondomload defer=true src=//:><\/script>");(z=I("__ie_ondomload"))&&U(z,"onreadystatechange",a)}catch(l){}if(F.webkit&&typeof p.readyState!=D)G=setInterval(function(){/loaded|complete/.test(p.readyState)&&b()},10);typeof p.addEventListener!=D&&p.addEventListener("DOMContentLoaded",b,null);d(b)}})();(function(){F.ie&&F.win&&window.attachEvent("onunload",function(){for(var l=Q.length,n=0;n<
l;n++)Q[n][0].detachEvent(Q[n][1],Q[n][2]);l=S.length;for(n=0;n<l;n++)q(S[n]);for(var w in F)F[w]=null;F=null;for(var A in swfobject)swfobject[A]=null;swfobject=null})})();return{registerObject:function(l,n,w){if(!(!F.w3cdom||!l||!n)){var A={};A.id=l;A.swfVersion=n;A.expressInstall=w?w:false;N[N.length]=A;H(l,false)}},getObjectById:function(l){var n=null;if(F.w3cdom)if(l=I(l)){var w=l.getElementsByTagName(y)[0];if(!w||w&&typeof l.SetVariable!=D)n=l;else if(typeof w.SetVariable!=D)n=w}return n},embedSWF:function(l,
n,w,A,M,P,T,O,X){if(!(!F.w3cdom||!l||!n||!w||!A||!M)){w+="";A+="";if(t(M)){H(n,false);var V={};if(X&&typeof X===y)for(var Y in X)if(X[Y]!=Object.prototype[Y])V[Y]=X[Y];V.data=l;V.width=w;V.height=A;var ca={};if(O&&typeof O===y)for(var da in O)if(O[da]!=Object.prototype[da])ca[da]=O[da];if(T&&typeof T===y)for(var aa in T)if(T[aa]!=Object.prototype[aa])if(typeof ca.flashvars!=D)ca.flashvars+="&"+aa+"="+T[aa];else ca.flashvars=aa+"="+T[aa];c(function(){v(V,ca,n);V.id==n&&H(n,true)})}else if(P&&!Z&&t("6.0.65")&&
(F.win||F.mac)){Z=true;H(n,false);c(function(){var ba={};ba.id=ba.altContentId=n;ba.width=w;ba.height=A;ba.expressInstall=P;g(ba)})}}},getFlashPlayerVersion:function(){return{major:F.pv[0],minor:F.pv[1],release:F.pv[2]}},hasFlashPlayerVersion:t,createSWF:function(l,n,w){if(F.w3cdom)return v(l,n,w)},removeSWF:function(l){F.w3cdom&&q(l)},createCSS:function(l,n){F.w3cdom&&x(l,n)},addDomLoadEvent:c,addLoadEvent:d,getQueryParamValue:function(l){var n=p.location.search||p.location.hash;if(l==null)return R(n);
if(n){n=n.substring(1).split("&");for(var w=0;w<n.length;w++)if(n[w].substring(0,n[w].indexOf("="))==l)return R(n[w].substring(n[w].indexOf("=")+1))}return""},expressInstallCallback:function(){if(Z&&K){var l=I(h);if(l){l.parentNode.replaceChild(K,l);if(L){H(L,true);if(F.ie&&F.win)K.style.display="block"}L=K=null;Z=false}}}}}();
function voteContentDown(a,b,c){$("vote-links-content-"+b).innerHTML=c;new Ajax.Request("/bligoo/ajaxproxy",{method:"voteContentDown",parameters:{contentId:b},onSuccess:function(d){$("vote-links-content-"+b).up().innerHTML=d.responseText}})}function voteContentUp(a,b,c){$("vote-links-content-"+b).innerHTML=c;new Ajax.Request("/bligoo/ajaxproxy",{method:"voteContentUp",parameters:{contentId:b},onSuccess:function(d){$("vote-links-content-"+b).up().innerHTML=d.responseText}})}
function nullVoteContent(a,b,c){$("vote-links-content-"+b).innerHTML=c;new Ajax.Request("/bligoo/ajaxproxy",{method:"nullcontentvote",parameters:{contentId:b},onSuccess:function(d){$("vote-links-content-"+b).up().innerHTML=d.responseText}})}function voteCommentDown(a,b,c){$("vote-links-comment-"+b).innerHTML=c;new Ajax.Request("/bligoo/ajaxproxy",{method:"voteCommentDown",parameters:{commentId:b},onSuccess:function(d){$("vote-links-comment-"+b).up().innerHTML=d.responseText}})}
function voteCommentUp(a,b,c){$("vote-links-comment-"+b).innerHTML=c;new Ajax.Request("/bligoo/ajaxproxy",{method:"voteCommentUp",parameters:{commentId:b},onSuccess:function(d){$("vote-links-comment-"+b).up().innerHTML=d.responseText}})}function nullVoteComment(a,b,c){$("vote-links-comment-"+b).innerHTML=c;new Ajax.Request("/bligoo/ajaxproxy",{method:"nullcommentvote",parameters:{commentId:b},onSuccess:function(d){$("vote-links-comment-"+b).up().innerHTML=d.responseText}})}
var VotePluginClass=Class.create(BligooPluginClass,{init:function(){},onPageLoaded:function(){for(var a=$$("span.comment-to-collapse"),b=0;b<a.length;b++){var c=a[b].id.substring(19);$("comment-collapsed-"+c).show();var d=$("comment-"+c);d.select("div.comment")[0].hide();d.select("div.links")[0].hide();$("expand-"+c).observe("click",this.expandComment.bindAsEventListener(this,c))}},expandComment:function(a,b){a=$("comment-"+b);$("comment-collapsed-"+b).hide();a.select("div.comment")[0].show();a.select("div.links")[0].show()}});
PluginManager.add(new VotePluginClass);
var OnOffSwitchClass=Class.create({initialize:function(a){this.wrapper=a;this.item=this.wrapper.select(".bligoo-switch").first();this.wrapper.observe("click",this.click.bindAsEventListener(this));this.val=this.wrapper.select('input[type="hidden"]').first()},click:function(){if(this.item.hasClassName("bligoo-switch-false")){this.item.removeClassName("bligoo-switch-false");this.item.addClassName("bligoo-switch-true")}else{this.item.addClassName("bligoo-switch-false");this.item.removeClassName("bligoo-switch-true")}this.val.value=
this.val.value=="true"?"false":"true"}}),WizardSwitchPluginClass=Class.create(BligooPluginClass,{onWizardStepLoaded:function(){$$(".bligoo-switch-wrapper").each(function(a){new OnOffSwitchClass(a)})}});PluginManager.add(new WizardSwitchPluginClass);
